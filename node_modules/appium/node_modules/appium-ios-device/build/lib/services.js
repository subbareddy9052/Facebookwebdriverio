"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.startSyslogService = startSyslogService;
exports.startWebInspectorService = startWebInspectorService;
exports.startInstallationProxyService = startInstallationProxyService;
exports.startSimulateLocationService = startSimulateLocationService;
exports.startAfcService = startAfcService;
exports.startNotificationProxyService = startNotificationProxyService;
exports.startHouseArrestService = startHouseArrestService;

require("source-map-support/register");

var _utilities = require("./utilities");

var _syslog = require("./syslog");

var _simulatelocation = require("./simulatelocation");

var _webinspector = require("./webinspector");

var _installationProxy = require("./installation-proxy");

var _afc = require("./afc");

var _notificationProxy = require("./notification-proxy");

var _houseArrest = require("./house-arrest");

var _plistService = _interopRequireDefault(require("./plist-service"));

var _semver = _interopRequireDefault(require("semver"));

async function startSyslogService(udid, opts = {}) {
  const socket = await startService(udid, _syslog.SYSLOG_SERVICE_NAME, opts.socket);
  return new _syslog.SyslogService(socket);
}

async function startSimulateLocationService(udid, opts = {}) {
  const socket = await startService(udid, _simulatelocation.SIMULATE_LOCATION_SERVICE_NAME, opts.socket);
  return new _simulatelocation.SimulateLocationService(socket);
}

async function startWebInspectorService(udid, opts = {}) {
  const osVersion = opts.osVersion || (await (0, _utilities.getOSVersion)(udid, opts.socket));
  const isSimulator = !!opts.isSimulator;
  const verbose = !!opts.verbose;
  const verboseHexDump = !!opts.verboseHexDump;
  const socketChunkSize = opts.socketChunkSize;

  const semverVersion = _semver.default.coerce(osVersion);

  if (!semverVersion) {
    throw new Error(`Could not create a semver version out of '${osVersion}'`);
  }

  if (opts.socket) {
    return new _webinspector.WebInspectorService({
      majorOsVersion: semverVersion.major,
      isSimulator,
      socketChunkSize,
      verbose,
      verboseHexDump,
      socketClient: opts.socket
    });
  }

  const socket = await startService(udid, _webinspector.WEB_INSPECTOR_SERVICE_NAME, undefined);
  return new _webinspector.WebInspectorService({
    majorOsVersion: semverVersion.major,
    isSimulator,
    socketChunkSize,
    verbose,
    verboseHexDump,
    socketClient: socket
  });
}

async function startInstallationProxyService(udid, opts = {}) {
  const socket = await startService(udid, _installationProxy.INSTALLATION_PROXY_SERVICE_NAME, opts.socket);
  return new _installationProxy.InstallationProxyService(new _plistService.default(socket));
}

async function startAfcService(udid, opts = {}) {
  const socket = await startService(udid, _afc.AFC_SERVICE_NAME, opts.socket);
  return new _afc.AfcService(socket);
}

async function startNotificationProxyService(udid, opts = {}) {
  const socket = await startService(udid, _notificationProxy.NOTIFICATION_PROXY_SERVICE_NAME, opts.socket);
  return new _notificationProxy.NotificationProxyService(socket);
}

async function startHouseArrestService(udid, opts = {}) {
  const socket = await startService(udid, _houseArrest.HOUSE_ARREST_SERVICE_NAME, opts.socket);
  return new _houseArrest.HouseArrestService(socket);
}

async function startService(udid, serviceName, socket) {
  const lockdown = await (0, _utilities.startLockdownSession)(udid, socket);

  try {
    const service = await lockdown.startService(serviceName);

    if (service.EnableServiceSSL) {
      return await (0, _utilities.connectPortSSL)(udid, service.Port, socket);
    } else {
      return await (0, _utilities.connectPort)(udid, service.Port, socket);
    }
  } finally {
    lockdown.close();
  }
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6WyJzdGFydFN5c2xvZ1NlcnZpY2UiLCJ1ZGlkIiwib3B0cyIsInNvY2tldCIsInN0YXJ0U2VydmljZSIsIlNZU0xPR19TRVJWSUNFX05BTUUiLCJTeXNsb2dTZXJ2aWNlIiwic3RhcnRTaW11bGF0ZUxvY2F0aW9uU2VydmljZSIsIlNJTVVMQVRFX0xPQ0FUSU9OX1NFUlZJQ0VfTkFNRSIsIlNpbXVsYXRlTG9jYXRpb25TZXJ2aWNlIiwic3RhcnRXZWJJbnNwZWN0b3JTZXJ2aWNlIiwib3NWZXJzaW9uIiwiaXNTaW11bGF0b3IiLCJ2ZXJib3NlIiwidmVyYm9zZUhleER1bXAiLCJzb2NrZXRDaHVua1NpemUiLCJzZW12ZXJWZXJzaW9uIiwic2VtdmVyIiwiY29lcmNlIiwiRXJyb3IiLCJXZWJJbnNwZWN0b3JTZXJ2aWNlIiwibWFqb3JPc1ZlcnNpb24iLCJtYWpvciIsInNvY2tldENsaWVudCIsIldFQl9JTlNQRUNUT1JfU0VSVklDRV9OQU1FIiwidW5kZWZpbmVkIiwic3RhcnRJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UiLCJJTlNUQUxMQVRJT05fUFJPWFlfU0VSVklDRV9OQU1FIiwiSW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlIiwiUGxpc3RTZXJ2aWNlIiwic3RhcnRBZmNTZXJ2aWNlIiwiQUZDX1NFUlZJQ0VfTkFNRSIsIkFmY1NlcnZpY2UiLCJzdGFydE5vdGlmaWNhdGlvblByb3h5U2VydmljZSIsIk5PVElGSUNBVElPTl9QUk9YWV9TRVJWSUNFX05BTUUiLCJOb3RpZmljYXRpb25Qcm94eVNlcnZpY2UiLCJzdGFydEhvdXNlQXJyZXN0U2VydmljZSIsIkhPVVNFX0FSUkVTVF9TRVJWSUNFX05BTUUiLCJIb3VzZUFycmVzdFNlcnZpY2UiLCJzZXJ2aWNlTmFtZSIsImxvY2tkb3duIiwic2VydmljZSIsIkVuYWJsZVNlcnZpY2VTU0wiLCJQb3J0IiwiY2xvc2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7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ZXNDb250ZW50IjpbImltcG9ydCB7IGNvbm5lY3RQb3J0LCBjb25uZWN0UG9ydFNTTCwgc3RhcnRMb2NrZG93blNlc3Npb24sIGdldE9TVmVyc2lvbiB9IGZyb20gJy4vdXRpbGl0aWVzJztcbmltcG9ydCB7IFN5c2xvZ1NlcnZpY2UsIFNZU0xPR19TRVJWSUNFX05BTUUgfSBmcm9tICcuL3N5c2xvZyc7XG5pbXBvcnQgeyBTaW11bGF0ZUxvY2F0aW9uU2VydmljZSwgU0lNVUxBVEVfTE9DQVRJT05fU0VSVklDRV9OQU1FIH0gZnJvbSAnLi9zaW11bGF0ZWxvY2F0aW9uJztcbmltcG9ydCB7IFdlYkluc3BlY3RvclNlcnZpY2UsIFdFQl9JTlNQRUNUT1JfU0VSVklDRV9OQU1FIH0gZnJvbSAnLi93ZWJpbnNwZWN0b3InO1xuaW1wb3J0IHsgSW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlLCBJTlNUQUxMQVRJT05fUFJPWFlfU0VSVklDRV9OQU1FIH0gZnJvbSAnLi9pbnN0YWxsYXRpb24tcHJveHknO1xuaW1wb3J0IHsgQWZjU2VydmljZSwgQUZDX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vYWZjJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblByb3h5U2VydmljZSwgTk9USUZJQ0FUSU9OX1BST1hZX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vbm90aWZpY2F0aW9uLXByb3h5JztcbmltcG9ydCB7IEhvdXNlQXJyZXN0U2VydmljZSwgSE9VU0VfQVJSRVNUX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vaG91c2UtYXJyZXN0JztcbmltcG9ydCBQbGlzdFNlcnZpY2UgZnJvbSAnLi9wbGlzdC1zZXJ2aWNlJztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcblxuXG5hc3luYyBmdW5jdGlvbiBzdGFydFN5c2xvZ1NlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBzb2NrZXQgPSBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgU1lTTE9HX1NFUlZJQ0VfTkFNRSwgb3B0cy5zb2NrZXQpO1xuICByZXR1cm4gbmV3IFN5c2xvZ1NlcnZpY2Uoc29ja2V0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRTaW11bGF0ZUxvY2F0aW9uU2VydmljZSAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHNvY2tldCA9IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBTSU1VTEFURV9MT0NBVElPTl9TRVJWSUNFX05BTUUsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBTaW11bGF0ZUxvY2F0aW9uU2VydmljZShzb2NrZXQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydFdlYkluc3BlY3RvclNlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBvc1ZlcnNpb24gPSBvcHRzLm9zVmVyc2lvbiB8fCBhd2FpdCBnZXRPU1ZlcnNpb24odWRpZCwgb3B0cy5zb2NrZXQpO1xuICBjb25zdCBpc1NpbXVsYXRvciA9ICEhb3B0cy5pc1NpbXVsYXRvcjtcbiAgY29uc3QgdmVyYm9zZSA9ICEhb3B0cy52ZXJib3NlO1xuICBjb25zdCB2ZXJib3NlSGV4RHVtcCA9ICEhb3B0cy52ZXJib3NlSGV4RHVtcDtcbiAgY29uc3Qgc29ja2V0Q2h1bmtTaXplID0gb3B0cy5zb2NrZXRDaHVua1NpemU7XG4gIGNvbnN0IHNlbXZlclZlcnNpb24gPSBzZW12ZXIuY29lcmNlKG9zVmVyc2lvbik7XG4gIGlmICghc2VtdmVyVmVyc2lvbikge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGNyZWF0ZSBhIHNlbXZlciB2ZXJzaW9uIG91dCBvZiAnJHtvc1ZlcnNpb259J2ApO1xuICB9XG4gIGlmIChvcHRzLnNvY2tldCkge1xuICAgIHJldHVybiBuZXcgV2ViSW5zcGVjdG9yU2VydmljZSh7XG4gICAgICBtYWpvck9zVmVyc2lvbjogc2VtdmVyVmVyc2lvbi5tYWpvcixcbiAgICAgIGlzU2ltdWxhdG9yLFxuICAgICAgc29ja2V0Q2h1bmtTaXplLFxuICAgICAgdmVyYm9zZSxcbiAgICAgIHZlcmJvc2VIZXhEdW1wLFxuICAgICAgc29ja2V0Q2xpZW50OiBvcHRzLnNvY2tldCxcbiAgICB9KTtcbiAgfVxuICBjb25zdCBzb2NrZXQgPSBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgV0VCX0lOU1BFQ1RPUl9TRVJWSUNFX05BTUUsIHVuZGVmaW5lZCk7XG4gIHJldHVybiBuZXcgV2ViSW5zcGVjdG9yU2VydmljZSh7XG4gICAgbWFqb3JPc1ZlcnNpb246IHNlbXZlclZlcnNpb24ubWFqb3IsXG4gICAgaXNTaW11bGF0b3IsXG4gICAgc29ja2V0Q2h1bmtTaXplLFxuICAgIHZlcmJvc2UsXG4gICAgdmVyYm9zZUhleER1bXAsXG4gICAgc29ja2V0Q2xpZW50OiBzb2NrZXQsXG4gIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydEluc3RhbGxhdGlvblByb3h5U2VydmljZSAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHNvY2tldCA9IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBJTlNUQUxMQVRJT05fUFJPWFlfU0VSVklDRV9OQU1FLCBvcHRzLnNvY2tldCk7XG4gIHJldHVybiBuZXcgSW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlKG5ldyBQbGlzdFNlcnZpY2Uoc29ja2V0KSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0QWZjU2VydmljZSAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHNvY2tldCA9IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBBRkNfU0VSVklDRV9OQU1FLCBvcHRzLnNvY2tldCk7XG4gIHJldHVybiBuZXcgQWZjU2VydmljZShzb2NrZXQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydE5vdGlmaWNhdGlvblByb3h5U2VydmljZSAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHNvY2tldCA9IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBOT1RJRklDQVRJT05fUFJPWFlfU0VSVklDRV9OQU1FLCBvcHRzLnNvY2tldCk7XG4gIHJldHVybiBuZXcgTm90aWZpY2F0aW9uUHJveHlTZXJ2aWNlKHNvY2tldCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0SG91c2VBcnJlc3RTZXJ2aWNlICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qgc29ja2V0ID0gYXdhaXQgc3RhcnRTZXJ2aWNlKHVkaWQsIEhPVVNFX0FSUkVTVF9TRVJWSUNFX05BTUUsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBIb3VzZUFycmVzdFNlcnZpY2Uoc29ja2V0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRTZXJ2aWNlICh1ZGlkLCBzZXJ2aWNlTmFtZSwgc29ja2V0KSB7XG4gIGNvbnN0IGxvY2tkb3duID0gYXdhaXQgc3RhcnRMb2NrZG93blNlc3Npb24odWRpZCwgc29ja2V0KTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXJ2aWNlID0gYXdhaXQgbG9ja2Rvd24uc3RhcnRTZXJ2aWNlKHNlcnZpY2VOYW1lKTtcbiAgICBpZiAoc2VydmljZS5FbmFibGVTZXJ2aWNlU1NMKSB7XG4gICAgICByZXR1cm4gYXdhaXQgY29ubmVjdFBvcnRTU0wodWRpZCwgc2VydmljZS5Qb3J0LCBzb2NrZXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYXdhaXQgY29ubmVjdFBvcnQodWRpZCwgc2VydmljZS5Qb3J0LCBzb2NrZXQpO1xuICAgIH1cbiAgfSBmaW5hbGx5IHtcbiAgICBsb2NrZG93bi5jbG9zZSgpO1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIHN0YXJ0U3lzbG9nU2VydmljZSwgc3RhcnRXZWJJbnNwZWN0b3JTZXJ2aWNlLFxuICBzdGFydEluc3RhbGxhdGlvblByb3h5U2VydmljZSwgc3RhcnRTaW11bGF0ZUxvY2F0aW9uU2VydmljZSxcbiAgc3RhcnRBZmNTZXJ2aWNlLCBzdGFydE5vdGlmaWNhdGlvblByb3h5U2VydmljZSxcbiAgc3RhcnRIb3VzZUFycmVzdFNlcnZpY2Vcbn07XG4iXSwiZmlsZSI6ImxpYi9zZXJ2aWNlcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
