"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("./logger"));

var _tccDb = _interopRequireDefault(require("./tcc-db"));

var _shellQuote = require("shell-quote");

const STATUS_UNSET = 'unset';
const STATUS_YES = 'yes';
const STATUS_NO = 'no';
const WIX_SIM_UTILS = 'applesimutils';
const SERVICES = {
  calendar: 'kTCCServiceCalendar',
  camera: 'kTCCServiceCamera',
  contacts: 'kTCCServiceAddressBook',
  homekit: 'kTCCServiceWillow',
  microphone: 'kTCCServiceMicrophone',
  photos: 'kTCCServicePhotos',
  reminders: 'kTCCServiceReminders',
  medialibrary: 'kTCCServiceMediaLibrary',
  motion: 'kTCCServiceMotion',
  health: 'kTCCServiceMSO',
  siri: 'kTCCServiceSiri',
  speech: 'kTCCServiceSpeechRecognition'
};

function toInternalServiceName(serviceName) {
  if (_lodash.default.has(SERVICES, _lodash.default.toLower(serviceName))) {
    return SERVICES[_lodash.default.toLower(serviceName)];
  }

  throw new Error(`'${serviceName}' is unknown. Only the following service names are supported: ${JSON.stringify(_lodash.default.keys(SERVICES))}`);
}

function formatStatus(status) {
  return [STATUS_UNSET, STATUS_NO].includes(status) ? _lodash.default.toUpper(status) : status;
}

async function execWix(args) {
  try {
    await _appiumSupport.fs.which(WIX_SIM_UTILS);
  } catch (e) {
    throw new Error(`${WIX_SIM_UTILS} binary has not been found in your PATH. ` + `Please install it ('brew tap wix/brew && brew install wix/brew/applesimutils') to ` + `be able to change application permissions`);
  }

  _logger.default.debug(`Executing: ${WIX_SIM_UTILS} ${(0, _shellQuote.quote)(args)}`);

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(WIX_SIM_UTILS, args);

    _logger.default.debug(`Command output: ${stdout}`);

    return stdout;
  } catch (e) {
    throw new Error(`Cannot execute "${WIX_SIM_UTILS} ${(0, _shellQuote.quote)(args)}". Original error: ${e.stderr || e.message}`);
  }
}

class Permissions {
  constructor(xcodeVersion, sharedResourcesDir, udid) {
    this.tccDb = new _tccDb.default(xcodeVersion, sharedResourcesDir);
    this.udid = udid;
  }

  async setAccess(bundleId, permissionsMapping) {
    const permissionsArg = _lodash.default.toPairs(permissionsMapping).map(x => `${x[0]}=${formatStatus(x[1])}`).join(',');

    return await execWix(['--byId', this.udid, '--bundle', bundleId, '--setPermissions', permissionsArg]);
  }

  async getAccess(bundleId, serviceName) {
    serviceName = toInternalServiceName(serviceName);

    for (const [sqlValue, status] of [['0', STATUS_NO], ['1', STATUS_YES]]) {
      const count = await this.tccDb.execQuery(`SELECT count(*) FROM 'access' WHERE client='?' AND allowed=? AND service='?'`, bundleId, sqlValue, serviceName);

      if (parseInt(count.split('=')[1], 10) > 0) {
        return status;
      }
    }

    return STATUS_UNSET;
  }

}

var _default = Permissions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9wZXJtaXNzaW9ucy5qcyJdLCJuYW1lcyI6WyJTVEFUVVNfVU5TRVQiLCJTVEFUVVNfWUVTIiwiU1RBVFVTX05PIiwiV0lYX1NJTV9VVElMUyIsIlNFUlZJQ0VTIiwiY2FsZW5kYXIiLCJjYW1lcmEiLCJjb250YWN0cyIsImhvbWVraXQiLCJtaWNyb3Bob25lIiwicGhvdG9zIiwicmVtaW5kZXJzIiwibWVkaWFsaWJyYXJ5IiwibW90aW9uIiwiaGVhbHRoIiwic2lyaSIsInNwZWVjaCIsInRvSW50ZXJuYWxTZXJ2aWNlTmFtZSIsInNlcnZpY2VOYW1lIiwiXyIsImhhcyIsInRvTG93ZXIiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJrZXlzIiwiZm9ybWF0U3RhdHVzIiwic3RhdHVzIiwiaW5jbHVkZXMiLCJ0b1VwcGVyIiwiZXhlY1dpeCIsImFyZ3MiLCJmcyIsIndoaWNoIiwiZSIsImxvZyIsImRlYnVnIiwic3Rkb3V0Iiwic3RkZXJyIiwibWVzc2FnZSIsIlBlcm1pc3Npb25zIiwiY29uc3RydWN0b3IiLCJ4Y29kZVZlcnNpb24iLCJzaGFyZWRSZXNvdXJjZXNEaXIiLCJ1ZGlkIiwidGNjRGIiLCJUQ0NEQiIsInNldEFjY2VzcyIsImJ1bmRsZUlkIiwicGVybWlzc2lvbnNNYXBwaW5nIiwicGVybWlzc2lvbnNBcmciLCJ0b1BhaXJzIiwibWFwIiwieCIsImpvaW4iLCJnZXRBY2Nlc3MiLCJzcWxWYWx1ZSIsImNvdW50IiwiZXhlY1F1ZXJ5IiwicGFyc2VJbnQiLCJzcGxpdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxZQUFZLEdBQUcsT0FBckI7QUFDQSxNQUFNQyxVQUFVLEdBQUcsS0FBbkI7QUFDQSxNQUFNQyxTQUFTLEdBQUcsSUFBbEI7QUFDQSxNQUFNQyxhQUFhLEdBQUcsZUFBdEI7QUFDQSxNQUFNQyxRQUFRLEdBQUc7QUFDZkMsRUFBQUEsUUFB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S0FBS2MsSUFESSxFQUVuQixVQUZtQixFQUVQSSxRQUZPLEVBR25CLGtCQUhtQixFQUdDRSxjQUhELENBQUQsQ0FBcEI7QUFLRDs7QUFXRCxRQUFNSyxTQUFOLENBQWlCUCxRQUFqQixFQUEyQjlCLFdBQTNCLEVBQXdDO0FBQ3RDQSxJQUFBQSxXQUFXLEdBQUdELHFCQUFxQixDQUFDQyxXQUFELENBQW5DOztBQUVBLFNBQUssTUFBTSxDQUFDc0MsUUFBRCxFQUFXN0IsTUFBWCxDQUFYLElBQWlDLENBQUMsQ0FBQyxHQUFELEVBQU16QixTQUFOLENBQUQsRUFBbUIsQ0FBQyxHQUFELEVBQU1ELFVBQU4sQ0FBbkIsQ0FBakMsRUFBd0U7QUFDdEUsWUFBTXdELEtBQUssR0FBRyxNQUFNLEtBQUtaLEtBQUwsQ0FBV2EsU0FBWCxDQUFzQiw4RUFBdEIsRUFDbEJWLFFBRGtCLEVBQ1JRLFFBRFEsRUFDRXRDLFdBREYsQ0FBcEI7O0FBRUEsVUFBSXlDLFFBQVEsQ0FBQ0YsS0FBSyxDQUFDRyxLQUFOLENBQVksR0FBWixFQUFpQixDQUFqQixDQUFELEVBQXNCLEVBQXRCLENBQVIsR0FBb0MsQ0FBeEMsRUFBMkM7QUFDekMsZUFBT2pDLE1BQVA7QUFDRDtBQUNGOztBQUNELFdBQU8zQixZQUFQO0FBQ0Q7O0FBOUNlOztlQWlESHdDLFciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IFRDQ0RCIGZyb20gJy4vdGNjLWRiJztcbmltcG9ydCB7IHF1b3RlIH0gZnJvbSAnc2hlbGwtcXVvdGUnO1xuXG5jb25zdCBTVEFUVVNfVU5TRVQgPSAndW5zZXQnO1xuY29uc3QgU1RBVFVTX1lFUyA9ICd5ZXMnO1xuY29uc3QgU1RBVFVTX05PID0gJ25vJztcbmNvbnN0IFdJWF9TSU1fVVRJTFMgPSAnYXBwbGVzaW11dGlscyc7XG5jb25zdCBTRVJWSUNFUyA9IHtcbiAgY2FsZW5kYXI6ICdrVENDU2VydmljZUNhbGVuZGFyJyxcbiAgY2FtZXJhOiAna1RDQ1NlcnZpY2VDYW1lcmEnLFxuICBjb250YWN0czogJ2tUQ0NTZXJ2aWNlQWRkcmVzc0Jvb2snLFxuICBob21la2l0OiAna1RDQ1NlcnZpY2VXaWxsb3cnLFxuICBtaWNyb3Bob25lOiAna1RDQ1NlcnZpY2VNaWNyb3Bob25lJyxcbiAgcGhvdG9zOiAna1RDQ1NlcnZpY2VQaG90b3MnLFxuICByZW1pbmRlcnM6ICdrVENDU2VydmljZVJlbWluZGVycycsXG4gIG1lZGlhbGlicmFyeTogJ2tUQ0NTZXJ2aWNlTWVkaWFMaWJyYXJ5JyxcbiAgbW90aW9uOiAna1RDQ1NlcnZpY2VNb3Rpb24nLFxuICBoZWFsdGg6ICdrVENDU2VydmljZU1TTycsXG4gIHNpcmk6ICdrVENDU2VydmljZVNpcmknLFxuICBzcGVlY2g6ICdrVENDU2VydmljZVNwZWVjaFJlY29nbml0aW9uJyxcbn07XG5cbmZ1bmN0aW9uIHRvSW50ZXJuYWxTZXJ2aWNlTmFtZSAoc2VydmljZU5hbWUpIHtcbiAgaWYgKF8uaGFzKFNFUlZJQ0VTLCBfLnRvTG93ZXIoc2VydmljZU5hbWUpKSkge1xuICAgIHJldHVybiBTRVJWSUNFU1tfLnRvTG93ZXIoc2VydmljZU5hbWUpXTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYCcke3NlcnZpY2VOYW1lfScgaXMgdW5rbm93bi4gT25seSB0aGUgZm9sbG93aW5nIHNlcnZpY2UgbmFtZXMgYXJlIHN1cHBvcnRlZDogJHtKU09OLnN0cmluZ2lmeShfLmtleXMoU0VSVklDRVMpKX1gKTtcbn1cblxuZnVuY3Rpb24gZm9ybWF0U3RhdHVzIChzdGF0dXMpIHtcbiAgcmV0dXJuIFtTVEFUVVNfVU5TRVQsIFNUQVRVU19OT10uaW5jbHVkZXMoc3RhdHVzKSA/IF8udG9VcHBlcihzdGF0dXMpIDogc3RhdHVzO1xufVxuXG5hc3luYyBmdW5jdGlvbiBleGVjV2l4IChhcmdzKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMud2hpY2goV0lYX1NJTV9VVElMUyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7V0lYX1NJTV9VVElMU30gYmluYXJ5IGhhcyBub3QgYmVlbiBmb3VuZCBpbiB5b3VyIFBBVEguIGAgK1xuICAgICAgYFBsZWFzZSBpbnN0YWxsIGl0ICgnYnJldyB0YXAgd2l4L2JyZXcgJiYgYnJldyBpbnN0YWxsIHdpeC9icmV3L2FwcGxlc2ltdXRpbHMnKSB0byBgICtcbiAgICAgIGBiZSBhYmxlIHRvIGNoYW5nZSBhcHBsaWNhdGlvbiBwZXJtaXNzaW9uc2ApO1xuICB9XG5cbiAgbG9nLmRlYnVnKGBFeGVjdXRpbmc6ICR7V0lYX1NJTV9VVElMU30gJHtxdW90ZShhcmdzKX1gKTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoV0lYX1NJTV9VVElMUywgYXJncyk7XG4gICAgbG9nLmRlYnVnKGBDb21tYW5kIG91dHB1dDogJHtzdGRvdXR9YCk7XG4gICAgcmV0dXJuIHN0ZG91dDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGV4ZWN1dGUgXCIke1dJWF9TSU1fVVRJTFN9ICR7cXVvdGUoYXJncyl9XCIuIE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgfVxufVxuXG5jbGFzcyBQZXJtaXNzaW9ucyB7XG4gIGNvbnN0cnVjdG9yICh4Y29kZVZlcnNpb24sIHNoYXJlZFJlc291cmNlc0RpciwgdWRpZCkge1xuICAgIHRoaXMudGNjRGIgPSBuZXcgVENDREIoeGNvZGVWZXJzaW9uLCBzaGFyZWRSZXNvdXJjZXNEaXIpO1xuICAgIHRoaXMudWRpZCA9IHVkaWQ7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBwZXJtaXNzaW9ucyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIGJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSB0YXJnZXQgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwZXJtaXNzaW9uc01hcHBpbmcgLSBBbiBvYmplY3QsIHdoZXJlIGtleXMgYXIgIHNlcnZpY2UgbmFtZXNcbiAgICogYW5kIHZhbHVlcyBhcmUgY29ycmVzcG9uZGluZyBzdGF0ZSB2YWx1ZXMuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vd2l4L0FwcGxlU2ltdWxhdG9yVXRpbHNcbiAgICogZm9yIG1vcmUgZGV0YWlscyBvbiBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgY2hhbmdpbmcgcGVybWlzc2lvbnMuXG4gICAqL1xuICBhc3luYyBzZXRBY2Nlc3MgKGJ1bmRsZUlkLCBwZXJtaXNzaW9uc01hcHBpbmcpIHtcbiAgICBjb25zdCBwZXJtaXNzaW9uc0FyZyA9IF8udG9QYWlycyhwZXJtaXNzaW9uc01hcHBpbmcpXG4gICAgICAubWFwKCh4KSA9PiBgJHt4WzBdfT0ke2Zvcm1hdFN0YXR1cyh4WzFdKX1gKVxuICAgICAgLmpvaW4oJywnKTtcbiAgICByZXR1cm4gYXdhaXQgZXhlY1dpeChbXG4gICAgICAnLS1ieUlkJywgdGhpcy51ZGlkLFxuICAgICAgJy0tYnVuZGxlJywgYnVuZGxlSWQsXG4gICAgICAnLS1zZXRQZXJtaXNzaW9ucycsIHBlcm1pc3Npb25zQXJnLFxuICAgIF0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgY3VycmVudCBwZXJtaXNzaW9uIHN0YXR1cyBmb3IgdGhlIGdpdmVuIHNlcnZpY2UgYW5kIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBidW5kbGUgaWRlbnRpZmllciBvZiB0aGUgdGFyZ2V0IGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VydmljZU5hbWUgLSB0aGUgbmFtZSBvZiB0aGUgc2VydmljZS4gU2hvdWxkIGJlIG9uZSBvZlxuICAgKiBgU0VSVklDRVNgIGtleXMuXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IC0gVGhlIGN1cnJlbnQgc3RhdHVzOiB5ZXMvbm8vdW5zZXRcbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSByZXRyaWV2aW5nIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0QWNjZXNzIChidW5kbGVJZCwgc2VydmljZU5hbWUpIHtcbiAgICBzZXJ2aWNlTmFtZSA9IHRvSW50ZXJuYWxTZXJ2aWNlTmFtZShzZXJ2aWNlTmFtZSk7XG5cbiAgICBmb3IgKGNvbnN0IFtzcWxWYWx1ZSwgc3RhdHVzXSBvZiBbWycwJywgU1RBVFVTX05PXSwgWycxJywgU1RBVFVTX1lFU11dKSB7XG4gICAgICBjb25zdCBjb3VudCA9IGF3YWl0IHRoaXMudGNjRGIuZXhlY1F1ZXJ5KGBTRUxFQ1QgY291bnQoKikgRlJPTSAnYWNjZXNzJyBXSEVSRSBjbGllbnQ9Jz8nIEFORCBhbGxvd2VkPT8gQU5EIHNlcnZpY2U9Jz8nYCxcbiAgICAgICAgYnVuZGxlSWQsIHNxbFZhbHVlLCBzZXJ2aWNlTmFtZSk7XG4gICAgICBpZiAocGFyc2VJbnQoY291bnQuc3BsaXQoJz0nKVsxXSwgMTApID4gMCkge1xuICAgICAgICByZXR1cm4gc3RhdHVzO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gU1RBVFVTX1VOU0VUO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBlcm1pc3Npb25zO1xuIl0sImZpbGUiOiJsaWIvcGVybWlzc2lvbnMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
