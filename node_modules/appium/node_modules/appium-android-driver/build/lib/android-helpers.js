"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SETTINGS_HELPER_PKG_ID = exports.helpers = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _ioAppium = require("io.appium.settings");

var _bootstrap = _interopRequireDefault(require("./bootstrap"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumAdb = _interopRequireDefault(require("appium-adb"));

var _unlockHelpers = _interopRequireWildcard(require("./unlock-helpers"));

var _os = require("os");

var _semver = _interopRequireDefault(require("semver"));

const PACKAGE_INSTALL_TIMEOUT = 90000;
const CHROME_BROWSER_PACKAGE_ACTIVITY = {
  chrome: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  chromium: {
    pkg: 'org.chromium.chrome.shell',
    activity: '.ChromeShellActivity'
  },
  chromebeta: {
    pkg: 'com.chrome.beta',
    activity: 'com.google.android.apps.chrome.Main'
  },
  browser: {
    pkg: 'com.android.browser',
    activity: 'com.android.browser.BrowserActivity'
  },
  'chromium-browser': {
    pkg: 'org.chromium.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  'chromium-webview': {
    pkg: 'org.chromium.webview_shell',
    activity: 'org.chromium.webview_shell.WebViewBrowserActivity'
  },
  default: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  }
};
const SETTINGS_HELPER_PKG_ID = 'io.appium.settings';
exports.SETTINGS_HELPER_PKG_ID = SETTINGS_HELPER_PKG_ID;
const SETTINGS_HELPER_UNLOCK_ACTIVITY = '.Unlock';
const EMULATOR_PATTERN = /\bemulator\b/i;
let helpers = {};
exports.helpers = helpers;

helpers.createBaseADB = async function createBaseADB(opts = {}) {
  const {
    adbPort,
    suppressKillServer,
    remoteAdbHost,
    clearDeviceLogsOnStart,
    adbExecTimeout,
    useKeystore,
    keystorePath,
    keystorePassword,
    keyAlias,
    keyPassword,
    remoteAppsCacheLimit,
    buildToolsVersion,
    allowOfflineDevices
  } = opts;
  return await _appiumAdb.default.createADB({
    adbPort,
    suppressKillServer,
    remoteAdbHost,
    clearDeviceLogsOnStart,
    adbExecTimeout,
    useKeystore,
    keystorePath,
    keystorePassword,
    keyAlias,
    keyPassword,
    remoteAppsCacheLimit,
    buildToolsVersion,
    allowOfflineDevices
  });
};

helpers.prepareEmulator = async function prepareEmulator(adb, opts) {
  let {
    avd,
    avdArgs,
    language,
    locale,
    avdLaunchTimeout,
    avdReadyTimeout
  } = opts;

  if (!avd) {
    throw new Error('Cannot launch AVD without AVD name');
  }

  let avdName = avd.replace('@', '');
  let runningAVD = await adb.getRunningAVD(avdName);

  if (runningAVD !== null) {
    if (avdArgs && avdArgs.toLowerCase().indexOf('-wipe-data') > -1) {
      _logger.default.debug(`Killing '${avdName}' because it needs to be wiped at start.`);

      await adb.killEmulator(avdName);
    } else {
      _logger.default.debug('Not launching AVD because it is already running.');

      return;
    }
  }

  avdArgs = this.prepareAVDArgs(opts, adb, avdArgs);
  await adb.launchAVD(avd, avdArgs, language, locale, avdLaunchTimeout, avdReadyTimeout);
};

helpers.prepareAVDArgs = function prepareAVDArgs(opts, adb, avdArgs) {
  let args = avdArgs ? [avdArgs] : [];

  if (!_lodash.default.isUndefined(opts.networkSpeed)) {
    let networkSpeed = this.ensureNetworkSpeed(adb, opts.networkSpeed);
    args.push('-netspeed', networkSpeed);
  }

  if (opts.isHeadless) {
    args.push('-no-window');
  }

  return args.join(' ');
};

helpers.ensureNetworkSpeed = function ensureNetworkSpeed(adb, networkSpeed) {
  if (_lodash.default.values(adb.NETWORK_SPEED).indexOf(networkSpeed) !== -1) {
    return networkSpeed;
  }

  _logger.default.warn(`Wrong network speed param ${networkSpeed}, using default: full. Supported values: ${_lodash.default.values(adb.NETWORK_SPEED)}`);

  return adb.NETWORK_SPEED.FULL;
};

helpers.ensureDeviceLocale = async function ensureDeviceLocale(adb, language, country, script = null) {
  if (!_lodash.default.isString(language) && !_lodash.default.isString(country)) {
    _logger.default.warn(`setDeviceLanguageCountry requires language or country.`);

    _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

    return;
  }

  await adb.setDeviceLanguageCountry(language, country, script);

  if (!(await adb.ensureCurrentLocale(language, country, script))) {
    const message = script ? `language: ${language}, country: ${country} and script: ${script}` : `language: ${language} and country: ${country}`;
    throw new Error(`Failed to set ${message}`);
  }
};

helpers.getDeviceInfoFromCaps = async function getDeviceInfoFromCaps(opts = {}) {
  const adb = await helpers.createBaseADB(opts);
  let udid = opts.udid;
  let emPort = null;

  if (opts.avd) {
    await helpers.prepareEmulator(adb, opts);
    udid = adb.curDeviceId;
    emPort = adb.emulatorPort;
  } else {
    _logger.default.info('Retrieving device list');

    let devices = await adb.getDevicesWithRetry();

    if (udid) {
      if (!_lodash.default.includes(_lodash.default.map(devices, 'udid'), udid)) {
        _logger.default.errorAndThrow(`Device ${udid} was not in the list of connected devices`);
      }

      emPort = adb.getPortFromEmulatorString(udid);
    } else if (opts.platformVersion) {
      opts.platformVersion = `${opts.platformVersion}`.trim();
      const platformVersion = _semver.default.coerce(opts.platformVersion) || opts.platformVersion;

      _logger.default.info(`Looking for a device with Android '${platformVersion}'`);

      const availDevices = [];
      let partialMatchCandidate = null;

      for (const device of devices) {
        await adb.setDeviceId(device.udid);
        const rawDeviceOS = await adb.getPlatformVersion();
        availDevices.push(`${device.udid} (${rawDeviceOS})`);
        const deviceOS = _semver.default.coerce(rawDeviceOS) || rawDeviceOS;

        if (!deviceOS) {
          continue;
        }

        const bothVersionsCanBeCoerced = _semver.default.valid(deviceOS) && _semver.default.valid(platformVersion);

        const bothVersionsAreStrings = _lodash.default.isString(deviceOS) && _lodash.default.isString(platformVersion);

        if (bothVersionsCanBeCoerced && deviceOS.version === platformVersion.version || bothVersionsAreStrings && _lodash.default.toLower(deviceOS) === _lodash.default.toLower(platformVersion)) {
          udid = device.udid;
          break;
        } else if (!bothVersionsCanBeCoerced) {
          continue;
        }

        if ((!_lodash.default.includes(opts.platformVersion, '.') && platformVersion.major === deviceOS.major || platformVersion.major === deviceOS.major && platformVersion.minor === deviceOS.minor) && (partialMatchCandidate && _semver.default.gt(deviceOS, _lodash.default.values(partialMatchCandidate)[0]) || !partialMatchCandidate)) {
          partialMatchCandidate = {
            [device.udid]: deviceOS
          };
        }
      }

      if (!udid && partialMatchCandidate) {
        udid = _lodash.default.keys(partialMatchCandidate)[0];
        await adb.setDeviceId(udid);
      }

      if (!udid) {
        _logger.default.errorAndThrow(`Unable to find an active device or emulator ` + `with OS ${opts.platformVersion}. The following are available: ` + availDevices.join(', '));
      }

      emPort = adb.getPortFromEmulatorString(udid);
    } else {
      udid = devices[0].udid;
      emPort = adb.getPortFromEmulatorString(udid);
    }
  }

  _logger.default.info(`Using device: ${udid}`);

  return {
    udid,
    emPort
  };
};

helpers.createADB = async function createADB(opts = {}) {
  const {
    udid,
    emPort
  } = opts;
  const adb = await helpers.createBaseADB(opts);
  adb.setDeviceId(udid);

  if (emPort) {
    adb.setEmulatorPort(emPort);
  }

  return adb;
};

helpers.validatePackageActivityNames = function validatePackageActivityNames(opts) {
  for (const key of ['appPackage', 'appActivity', 'appWaitPackage', 'appWaitActivity']) {
    const name = opts[key];

    if (!name) {
      continue;
    }

    const match = /([^\w.*,])+/.exec(name);

    if (!match) {
      continue;
    }

    _logger.default.warn(`Capability '${key}' is expected to only include latin letters, digits, underscore, dot, comma and asterisk characters.`);

    _logger.default.warn(`Current value '${name}' has non-matching character at index ${match.index}: '${name.substring(0, match.index + 1)}'`);
  }
};

helpers.getLaunchInfo = async function getLaunchInfo(adb, opts) {
  let {
    app,
    appPackage,
    appActivity,
    appWaitPackage,
    appWaitActivity
  } = opts;

  if (!app) {
    _logger.default.warn('No app sent in, not parsing package/activity');

    return;
  }

  this.validatePackageActivityNames(opts);

  if (appPackage && appActivity) {
    return;
  }

  _logger.default.debug('Parsing package and activity from app manifest');

  let {
    apkPackage,
    apkActivity
  } = await adb.packageAndLaunchActivityFromManifest(app);

  if (apkPackage && !appPackage) {
    appPackage = apkPackage;
  }

  if (!appWaitPackage) {
    appWaitPackage = appPackage;
  }

  if (apkActivity && !appActivity) {
    appActivity = apkActivity;
  }

  if (!appWaitActivity) {
    appWaitActivity = appActivity;
  }

  _logger.default.debug(`Parsed package and activity are: ${apkPackage}/${apkActivity}`);

  return {
    appPackage,
    appWaitPackage,
    appActivity,
    appWaitActivity
  };
};

helpers.resetApp = async function resetApp(adb, opts = {}) {
  const {
    app,
    appPackage,
    fastReset,
    fullReset,
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;

  if (!appPackage) {
    throw new Error("'appPackage' option is required");
  }

  const isInstalled = await adb.isAppInstalled(appPackage);

  if (isInstalled) {
    try {
      await adb.forceStop(appPackage);
    } catch (ign) {}

    if (!fullReset && fastReset) {
      const output = await adb.clear(appPackage);

      if (_lodash.default.isString(output) && output.toLowerCase().includes('failed')) {
        throw new Error(`Cannot clear the application data of '${appPackage}'. Original error: ${output}`);
      }

      if (autoGrantPermissions) {
        try {
          await adb.grantAllPermissions(appPackage);
        } catch (error) {
          _logger.default.error(`Unable to grant permissions requested. Original error: ${error.message}`);
        }
      }

      _logger.default.debug(`Performed fast reset on the installed '${appPackage}' application (stop and clear)`);

      return;
    }
  }

  if (!app) {
    throw new Error("'app' option is required for reinstall");
  }

  _logger.default.debug(`Running full reset on '${appPackage}' (reinstall)`);

  if (isInstalled) {
    await adb.uninstallApk(appPackage);
  }

  await adb.install(app, {
    grantPermissions: autoGrantPermissions,
    timeout: androidInstallTimeout,
    allowTestPackages
  });
};

helpers.installApk = async function installApk(adb, opts = {}) {
  const {
    app,
    appPackage,
    fastReset,
    fullReset,
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages,
    enforceAppInstall
  } = opts;

  if (!app || !appPackage) {
    throw new Error("'app' and 'appPackage' options are required");
  }

  if (fullReset) {
    await this.resetApp(adb, opts);
    return;
  }

  const {
    appState,
    wasUninstalled
  } = await adb.installOrUpgrade(app, appPackage, {
    grantPermissions: autoGrantPermissions,
    timeout: androidInstallTimeout,
    allowTestPackages,
    enforceCurrentBuild: enforceAppInstall
  });
  const isInstalledOverExistingApp = !wasUninstalled && appState !== adb.APP_INSTALL_STATE.NOT_INSTALLED;

  if (fastReset && isInstalledOverExistingApp) {
    _logger.default.info(`Performing fast reset on '${appPackage}'`);

    await this.resetApp(adb, opts);
  }
};

helpers.installOtherApks = async function installOtherApks(otherApps, adb, opts) {
  let {
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;
  await _bluebird.default.all(otherApps.map(otherApp => {
    _logger.default.debug(`Installing app: ${otherApp}`);

    return adb.installOrUpgrade(otherApp, null, {
      grantPermissions: autoGrantPermissions,
      timeout: androidInstallTimeout,
      allowTestPackages
    });
  }));
};

helpers.uninstallOtherPackages = async function uninstallOtherPackages(adb, appPackages, filterPackages = []) {
  if (appPackages.includes('*')) {
    _logger.default.debug('Uninstall third party packages');

    appPackages = await this.getThirdPartyPackages(adb, filterPackages);
  }

  _logger.default.debug(`Uninstalling packages: ${appPackages}`);

  await _bluebird.default.all(appPackages.map(appPackage => adb.uninstallApk(appPackage)));
};

helpers.getThirdPartyPackages = async function getThirdPartyPackages(adb, filterPackages = []) {
  try {
    const packagesString = await adb.shell(['pm', 'list', 'packages', '-3']);
    const appPackagesArray = packagesString.trim().replace(/package:/g, '').split(_os.EOL);

    _logger.default.debug(`'${appPackagesArray}' filtered with '${filterPackages}'`);

    return _lodash.default.difference(appPackagesArray, filterPackages);
  } catch (err) {
    _logger.default.warn(`Unable to get packages with 'adb shell pm list packages -3': ${err.message}`);

    return [];
  }
};

helpers.initUnicodeKeyboard = async function initUnicodeKeyboard(adb) {
  _logger.default.debug('Enabling Unicode keyboard support');

  let defaultIME = await adb.defaultIME();

  _logger.default.debug(`Unsetting previous IME ${defaultIME}`);

  const appiumIME = `${SETTINGS_HELPER_PKG_ID}/.UnicodeIME`;

  _logger.default.debug(`Setting IME to '${appiumIME}'`);

  await adb.enableIME(appiumIME);
  await adb.setIME(appiumIME);
  return defaultIME;
};

helpers.setMockLocationApp = async function setMockLocationApp(adb, app) {
  try {
    if ((await adb.getApiLevel()) < 23) {
      await adb.shell(['settings', 'put', 'secure', 'mock_location', '1']);
    } else {
      await adb.shell(['appops', 'set', app, 'android:mock_location', 'allow']);
    }
  } catch (err) {
    _logger.default.warn(`Unable to set mock location for app '${app}': ${err.message}`);
  }
};

helpers.installHelperApp = async function installHelperApp(adb, apkPath, packageId) {
  await (0, _asyncbox.retry)(2, async function retryInstallHelperApp() {
    await adb.installOrUpgrade(apkPath, packageId, {
      grantPermissions: true
    });
  });
};

helpers.pushSettingsApp = async function pushSettingsApp(adb, throwError = false) {
  _logger.default.debug('Pushing settings apk to device...');

  try {
    await helpers.installHelperApp(adb, _ioAppium.path, SETTINGS_HELPER_PKG_ID, throwError);
  } catch (err) {
    if (throwError) {
      throw err;
    }

    _logger.default.warn(`Ignored error while installing '${_ioAppium.path}': ` + `'${err.message}'. Features that rely on this helper ` + 'require the apk such as toggle WiFi and getting location ' + 'will raise an error if you try to use them.');
  }

  if (await adb.processExists(SETTINGS_HELPER_PKG_ID)) {
    _logger.default.debug(`${SETTINGS_HELPER_PKG_ID} is already running. ` + `There is no need to reset its permissions.`);

    return;
  }

  if ((await adb.getApiLevel()) <= 23) {
    const perms = ['SET_ANIMATION_SCALE', 'CHANGE_CONFIGURATION', 'ACCESS_FINE_LOCATION'];

    _logger.default.info(`Granting permissions ${perms} to '${SETTINGS_HELPER_PKG_ID}'`);

    await adb.grantPermissions(SETTINGS_HELPER_PKG_ID, perms.map(x => `android.permission.${x}`));
  }

  try {
    await adb.requireRunningSettingsApp();
  } catch (err) {
    _logger.default.debug(err);

    if (throwError) {
      throw err;
    }
  }
};

helpers.pushStrings = async function pushStrings(language, adb, opts) {
  const remoteDir = '/data/local/tmp';
  const stringsJson = 'strings.json';

  const remoteFile = _path.default.posix.resolve(remoteDir, stringsJson);

  await adb.rimraf(remoteFile);
  let app;

  try {
    app = opts.app || (await adb.pullApk(opts.appPackage, opts.tmpDir));
  } catch (err) {
    _logger.default.info(`Failed to pull an apk from '${opts.appPackage}' to '${opts.tmpDir}'. Original error: ${err.message}`);
  }

  if (_lodash.default.isEmpty(opts.appPackage) || !(await _appiumSupport.fs.exists(app))) {
    _logger.default.debug(`No app or package specified. Returning empty strings`);

    return {};
  }

  const stringsTmpDir = _path.default.resolve(opts.tmpDir, opts.appPackage);

  try {
    _logger.default.debug('Extracting strings from apk', app, language, stringsTmpDir);

    const {
      apkStrings,
      localPath
    } = await adb.extractStringsFromApk(app, language, stringsTmpDir);
    await adb.push(localPath, remoteDir);
    return apkStrings;
  } catch (err) {
    _logger.default.warn(`Could not get strings, continuing anyway. Original error: ${err.message}`);

    await adb.shell('echo', [`'{}' > ${remoteFile}`]);
  } finally {
    await _appiumSupport.fs.rimraf(stringsTmpDir);
  }

  return {};
};

helpers.unlockWithUIAutomation = async function unlockWithUIAutomation(driver, adb, unlockCapabilities) {
  let unlockType = unlockCapabilities.unlockType;

  if (!_unlockHelpers.default.isValidUnlockType(unlockType)) {
    throw new Error(`Invalid unlock type ${unlockType}`);
  }

  let unlockKey = unlockCapabilities.unlockKey;

  if (!_unlockHelpers.default.isValidKey(unlockType, unlockKey)) {
    throw new Error(`Missing unlockKey ${unlockKey} capability for unlockType ${unlockType}`);
  }

  const unlockMethod = {
    [_unlockHelpers.PIN_UNLOCK]: _unlockHelpers.default.pinUnlock,
    [_unlockHelpers.PASSWORD_UNLOCK]: _unlockHelpers.default.passwordUnlock,
    [_unlockHelpers.PATTERN_UNLOCK]: _unlockHelpers.default.patternUnlock,
    [_unlockHelpers.FINGERPRINT_UNLOCK]: _unlockHelpers.default.fingerprintUnlock
  }[unlockType];
  await unlockMethod(adb, driver, unlockCapabilities);
};

helpers.unlockWithHelperApp = async function unlockWithHelperApp(adb) {
  _logger.default.info('Unlocking screen');

  let firstRun = true;
  await (0, _asyncbox.retry)(3, async function launchHelper() {
    if (firstRun) {
      firstRun = false;
    } else {
      try {
        if (!(await adb.isScreenLocked())) {
          return;
        }
      } catch (e) {
        _logger.default.warn(`Error in isScreenLocked: ${e.message}`);

        _logger.default.warn('"adb shell dumpsys window" command has timed out.');

        _logger.default.warn('The reason of this timeout is the delayed adb response. Resetting adb server can improve it.');
      }
    }

    _logger.default.info(`Launching ${SETTINGS_HELPER_UNLOCK_ACTIVITY}`);

    await adb.shell(['am', 'start', '-n', `${SETTINGS_HELPER_PKG_ID}/${SETTINGS_HELPER_UNLOCK_ACTIVITY}`, '-c', 'android.intent.category.LAUNCHER', '-a', 'android.intent.action.MAIN', '-f', '0x10200000']);
    await _bluebird.default.delay(1000);
  });
};

helpers.unlock = async function unlock(driver, adb, capabilities) {
  if (!(await adb.isScreenLocked())) {
    _logger.default.info('Screen already unlocked, doing nothing');

    return;
  }

  _logger.default.debug('Screen is locked, trying to unlock');

  if (_lodash.default.isUndefined(capabilities.unlockType)) {
    _logger.default.warn('Using app unlock, this is going to be deprecated!');

    await helpers.unlockWithHelperApp(adb);
  } else {
    await helpers.unlockWithUIAutomation(driver, adb, {
      unlockType: capabilities.unlockType,
      unlockKey: capabilities.unlockKey
    });
    await helpers.verifyUnlock(adb);
  }
};

helpers.verifyUnlock = async function verifyUnlock(adb) {
  await (0, _asyncbox.retryInterval)(2, 1000, async () => {
    if (await adb.isScreenLocked()) {
      throw new Error('Screen did not unlock successfully, retrying');
    }

    _logger.default.debug('Screen unlocked successfully');
  });
};

helpers.initDevice = async function initDevice(adb, opts) {
  if (opts.skipDeviceInitialization) {
    _logger.default.info(`'skipDeviceInitialization' is set. Skipping device initialization.`);
  } else {
    await adb.waitForDevice();
    const shouldThrowError = opts.language || opts.locale || opts.localeScript || opts.unicodeKeyboard || opts.disableWindowAnimation || !opts.skipUnlock;
    await helpers.pushSettingsApp(adb, shouldThrowError);
  }

  if (!opts.avd) {
    await helpers.setMockLocationApp(adb, SETTINGS_HELPER_PKG_ID);
  }

  if (opts.language || opts.locale) {
    await helpers.ensureDeviceLocale(adb, opts.language, opts.locale, opts.localeScript);
  }

  if (opts.skipLogcatCapture) {
    _logger.default.info(`'skipLogcatCapture' is set. Skipping starting logcat capture.`);
  } else {
    await adb.startLogcat();
  }

  if (opts.unicodeKeyboard) {
    return await helpers.initUnicodeKeyboard(adb);
  }
};

helpers.removeNullProperties = function removeNullProperties(obj) {
  for (let key of _lodash.default.keys(obj)) {
    if (_lodash.default.isNull(obj[key]) || _lodash.default.isUndefined(obj[key])) {
      delete obj[key];
    }
  }
};

helpers.truncateDecimals = function truncateDecimals(number, digits) {
  let multiplier = Math.pow(10, digits),
      adjustedNum = number * multiplier,
      truncatedNum = Math[adjustedNum < 0 ? 'ceil' : 'floor'](adjustedNum);
  return truncatedNum / multiplier;
};

helpers.isChromeBrowser = function isChromeBrowser(browser) {
  return _lodash.default.includes(Object.keys(CHROME_BROWSER_PACKAGE_ACTIVITY), (browser || '').toLowerCase());
};

helpers.getChromePkg = function getChromePkg(browser) {
  return CHROME_BROWSER_PACKAGE_ACTIVITY[browser.toLowerCase()] || CHROME_BROWSER_PACKAGE_ACTIVITY.default;
};

helpers.removeAllSessionWebSocketHandlers = async function removeAllSessionWebSocketHandlers(server, sessionId) {
  if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
    return;
  }

  const activeHandlers = await server.getWebSocketHandlers(sessionId);

  for (const pathname of _lodash.default.keys(activeHandlers)) {
    await server.removeWebSocketHandler(pathname);
  }
};

helpers.parseArray = function parseArray(cap) {
  let parsedCaps;

  try {
    parsedCaps = JSON.parse(cap);
  } catch (ign) {}

  if (_lodash.default.isArray(parsedCaps)) {
    return parsedCaps;
  } else if (_lodash.default.isString(cap)) {
    return [cap];
  }

  throw new Error(`must provide a string or JSON Array; received ${cap}`);
};

helpers.validateDesiredCaps = function validateDesiredCaps(caps) {
  if (caps.browserName) {
    if (caps.app) {
      _logger.default.warn(`The desired capabilities should generally not include both an 'app' and a 'browserName'`);
    }

    if (caps.appPackage) {
      _logger.default.errorAndThrow(`The desired should not include both of an 'appPackage' and a 'browserName'`);
    }
  }

  if (caps.uninstallOtherPackages) {
    try {
      this.parseArray(caps.uninstallOtherPackages);
    } catch (e) {
      _logger.default.errorAndThrow(`Could not parse "uninstallOtherPackages" capability: ${e.message}`);
    }
  }

  return true;
};

helpers.isEmulator = function isEmulator(adb, opts) {
  const possibleNames = [opts.udid, adb === null || adb === void 0 ? void 0 : adb.curDeviceId];
  return !!opts.avd || possibleNames.some(x => EMULATOR_PATTERN.test(x));
};

helpers.bootstrap = _bootstrap.default;
helpers.unlocker = _unlockHelpers.default;
var _default = helpers;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hbmRyb2lkLWhlbHBlcnMuanMiXSwibmFtZXMiOlsiUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQiLCJDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZIiwiY2hyb21lIiwicGtnIiwiYWN0aXZpdHkiLCJjaHJvbWl1bSIsImNocm9tZWJldGEiLCJicm93c2VyIiwiZGVmYXVsdCIsIlNFVFRJTkdTX0hFTFBFUl9QS0dfSUQiLCJTRVRUSU5HU19IRUxQRVJfVU5MT0NLX0FDVElWSVRZIiwiRU1VTEFUT1JfUEFUVEVSTiIsImhlbHBlcnMiLCJjcmVhdGVCYXNlQURCIiwib3B0cyIsImFkYlBvcnQiLCJzdXBwcmVzc0tpbGxTZXJ2ZXIiLCJyZW1vdGVBZGJIb3N0IiwiY2xlYXJEZXZpY2VMb2dzT25TdGFydCIsImFkYkV4ZWNUaW1lb3V0IiwidXNlS2V5c3RvcmUiLCJrZXlzdG9yZVBhdGgiLCJrZXlzdG9yZVBhc3N3b3JkIiwia2V5QWxpYXMiLCJrZXlQYXNzd29yZCIsInJlbW90ZUFwcHNDYWNoZUxpbWl0IiwiYnVpbGRUb29sc1ZlcnNpb24iLCJhbGxvd09mZmxpbmVEZXZpY2VzIiwiQURCIiwiY3JlYXRlQURCIiwicHJlcGFyZUVtdWxhdG9yIiwiYWRiIiwiYXZkIiwiYXZkQXJncyIsImxhbmd1YWdlIiwibG9jYWxlIiwiYXZkTGF1bmNoVGltZW91dCIsImF2ZFJlYWR5VGltZW91dCIsIkVycm9yIiwiYXZkTmFtZSIsInJlcGxhY2UiLCJydW5uaW5nQVZEIiwiZ2V0UnVubmluZ0FWRCIsInRvTG93ZXJDYXNlIiwiaW5kZXhPZiIsImxvZ2dlciIsImRlYnVnIiwia2lsbEVtdWxhdG9yIiwicHJlcGFyZUFWREFyZ3MiLCJsYXVuY2hBVkQiLCJhcmdzIiwiXyIsImlzVW5kZWZpbmVkIiwibmV0d29ya1NwZWVkIiwiZW5zdXJlTmV0d29ya1NwZWVkIiwicHVzaCIsImlzSGVhZGxlc3MiLCJqb2luIiwidmFsdWVzIiwiTkVUV09SS19TUEVFRCIsIndhcm4iLCJGVUxMIiwiZW5zdXJlRGV2aWNlTG9jYWxlIiwiY291bnRyeSIsInNjcmlwdCIsImlzU3RyaW5nIiwic2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IiwiZW5zdXJlQ3VycmVudExvY2FsZSIsIm1lc3NhZ2UiLCJnZXREZXZpY2VJbmZvRnJvbUNhcHMiLCJ1ZGlkIiwiZW1Qb3J0IiwiY3VyRGV2aWNlSWQiLCJlbXVsYXRvclBvcnQiLCJpbmZvIiwiZGV2aWNlcyIsImdldERldmljZXNXaXRoUmV0cnkiLCJpbmNsdWRlcyIsIm1hcCIsImVycm9yQW5kVGhyb3ciLCJnZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nIiwicGxhdGZvcm1WZXJzaW9uIiwidHJpbSIsInNlbXZlciIsImNvZXJjZSIsImF2YWlsRGV2aWNlcyIsInBhcnRpYWxNYXRjaENhbmRpZGF0ZSIsImRldmljZSIsInNldERldmljZUlkIiwicmF3RGV2aWNlT1MiLCJnZXRQbGF0Zm9ybVZlcnNpb24iLCJkZXZpY2VPUyIsImJvdGhWZXJzaW9uc0NhbkJlQ29lcmNlZCIsInZhbGlkIiwiYm90aFZlcnNpb25zQXJlU3RyaW5ncyIsInZlcnNpb24iLCJ0b0xvd2VyIiwibWFqb3IiLCJtaW5vciIsImd0Iiwia2V5cyIsInNldEVtdWxhdG9yUG9ydCIsInZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMiLCJrZXkiLCJuYW1lIiwibWF0Y2giLCJleGVjIiwiaW5kZXgiLCJzdWJzdHJpbmciLCJnZXRMYXVuY2hJbmZvIiwiYXBwIiwiYXBwUGFja2FnZSIsImFwcEFjdGl2aXR5IiwiYXBwV2FpdFBhY2thZ2UiLCJhcHBXYWl0QWN0aXZpdHkiLCJhcGtQYWNrYWdlIiwiYXBrQWN0aXZpdHkiLCJwYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QiLCJyZXNldEFwcCIsImZhc3RSZXNldCIsImZ1bGxSZXNldCIsImFuZHJvaWRJbnN0YWxsVGltZW91dCIsImF1dG9HcmFudFBlcm1pc3Npb25zIiwiYWxsb3dUZXN0UGFja2FnZXMiLCJpc0luc3RhbGxlZCIsImlzQXBwSW5zdGFsbGVkIiwiZm9yY2VTdG9wIiwiaWduIiwib3V0cHV0IiwiY2xlYXIiLCJncmFudEFsbFBlcm1pc3Npb25zIiwiZXJyb3IiLCJ1bmluc3RhbGxBcGsiLCJpbnN0YWxsIiwiZ3JhbnRQZXJtaXNzaW9ucyIsInRpbWVvdXQiLCJpbnN0YWxsQXBrIiwiZW5mb3JjZUFwcEluc3RhbGwiLCJhcHBTdGF0ZSIsIndhc1VuaW5zdGFsbGVkIiwiaW5zdGFsbE9yVXBncmFkZSIsImVuZm9yY2VDdXJyZW50QnVpbGQiLCJpc0luc3RhbGxlZE92ZXJFeGlzdGluZ0FwcCIsIkFQUF9JTlNUQUxMX1NUQVRFIiwiTk9UX0lOU1RBTExFRCIsImluc3RhbGxPdGhlckFwa3MiLCJvdGhlckFwcHMiLCJCIiwiYWxsIiwib3RoZXJBcHAiLCJ1bmluc3RhbGxPdGhlclBhY2thZ2VzIiwiYXBwUGFja2FnZXMiLCJmaWx0ZXJQYWNrYWdlcyIsImdldFRoaXJkUGFydHlQYWNrYWdlcyIsInBhY2thZ2VzU3RyaW5nIiwic2hlbGwiLCJhcHBQYWNrYWdlc0FycmF5Iiwic3BsaXQiLCJFT0wiLCJkaWZmZXJlbmNlIiwiZXJyIiwiaW5pdFVuaWNvZGVLZXlib2FyZCIsImRlZmF1bHRJTUUiLCJhcHBpdW1JTUUiLCJlbmFibGVJTUUiLCJzZXRJTUUiLCJzZXRNb2NrTG9jYXRpb25BcHAiLCJnZXRBcGlMZXZlbCIsImluc3RhbGxIZWxwZXJBcHAiLCJhcGtQYXRoIiwicGFja2FnZUlkIiwicmV0cnlJbnN0YWxsSGVscGVyQXBwIiwicHVzaFNldHRpbmdzQXBwIiwidGhyb3dFcnJvciIsInNldHRpbmdzQXBrUGF0aCIsInByb2Nlc3NFeGlzdHMiLCJwZXJtcyIsIngiLCJyZXF1aXJlUnVubmluZ1NldHRpbmdzQXBwIiwicHVzaFN0cmluZ3MiLCJyZW1vdGVEaXIiLCJzdHJpbmdzSnNvbiIsInJlbW90ZUZpbGUiLCJwYXRoIiwicG9zaXgiLCJyZXNvbHZlIiwicmltcmFmIiwicHVsbEFwayIsInRtcERpciIsImlzRW1wdHkiLCJmcyIsImV4aXN0cyIsInN0cmluZ3NUbXBEaXIiLCJhcGtTdHJpbmdzIiwibG9jYWxQYXRoIiwiZXh0cmFjdFN0cmluZ3NGcm9tQXBrIiwidW5sb2NrV2l0aFVJQXV0b21hdGlvbiIsImRyaXZlciIsInVubG9ja0NhcGFiaWxpdGllcyIsInVubG9ja1R5cGUiLCJ1bmxvY2tlciIsImlzVmFsaWRVbmxvY2tUeXBlIiwidW5sb2NrS2V5IiwiaXNWYWxpZEtleSIsInVubG9ja01ldGhvZCIsIlBJTl9VTkxPQ0siLCJwaW5VbmxvY2siLCJQQVNTV09SRF9VTkxPQ0siLCJwYXNzd29yZFVubG9jayIsIlBBVFRFUk5fVU5MT0NLIiwicGF0dGVyblVubG9jayIsIkZJTkdFUlBSSU5UX1VOTE9DSyIsImZpbmdlcnByaW50VW5sb2NrIiwidW5sb2NrV2l0aEhlbHBlckFwcCIsImZpcnN0UnVuIiwibGF1bmNoSGVscGVyIiwiaXNTY3JlZW5Mb2NrZWQiLCJlIiwiZGVsYXkiLCJ1bmxvY2siLCJjYXBhYmlsaXRpZXMiLCJ2ZXJpZnlVbmxvY2siLCJpbml0RGV2aWNlIiwic2tpcERldmljZUluaXRpYWxpemF0aW9uIiwid2FpdEZvckRldmljZSIsInNob3VsZFRocm93RXJyb3IiLCJsb2NhbGVTY3JpcHQiLCJ1bmljb2RlS2V5Ym9hcmQiLCJkaXNhYmxlV2luZG93QW5pbWF0aW9uIiwic2tpcFVubG9jayIsInNraXBMb2djYXRDYXB0dXJlIiwic3RhcnRMb2djYXQiLCJyZW1vdmVOdWxsUHJvcGVydGllcyIsIm9iaiIsImlzTnVsbCIsInRydW5jYXRlRGVjaW1hbHMiLCJudW1iZXIiLCJkaWdpdHMiLCJtdWx0aXBsaWVyIiwiTWF0aCIsInBvdyIsImFkanVzdGVkTnVtIiwidHJ1bmNhdGVkTnVtIiwiaXNDaHJvbWVCcm93c2VyIiwiT2JqZWN0IiwiZ2V0Q2hyb21lUGtnIiwicmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzIiwic2VydmVyIiwic2Vzc2lvbklkIiwiaXNGdW5jdGlvbiIsImdldFdlYlNvY2tldEhhbmRsZXJzIiwiYWN0aXZlSGFuZGxlcnMiLCJwYXRobmFtZSIsInJlbW92ZVdlYlNvY2tldEhhbmRsZXIiLCJwYXJzZUFycmF5IiwiY2FwIiwicGFyc2VkQ2FwcyIsIkpTT04iLCJwYXJzZSIsImlzQXJyYXkiLCJ2YWxpZGF0ZURlc2lyZWRDYXBzIiwiY2FwcyIsImJyb3dzZXJOYW1lIiwiaXNFbXVsYXRvciIsInBvc3NpYmxlTmFtZXMiLCJzb21lIiwidGVzdCIsImJvb3RzdHJhcCIsIkJvb3RzdHJhcCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBOztBQUNBOztBQUVBLE1BQU1BLHVCQUF1QixHQUFHLEtBQWhDO0FBQ0EsTUFBTUMsK0JBQStCLEdBQUc7QUFDdENDLEVBQUFBLE1BQU0sRUFBRTtBQUNOQyxJQUFBQSxHQUFHLEVBQUUsb0JBREM7QUFFTkMsSUFBQUEsUUFBUSxFQUFFO0FBRkosR0FEOEI7QUFLdENDLEVBQUFBLFFBQVEsRUFBRTtBQUNSRixJQUFBQSxHQUFHLEVBQUUsMkJBREc7QUFFUkMsSUFBQUEsUUFBUSxFQUFFO0FBRkYsR0FMNEI7QUFTdENFLEVBQUFBLFVBQVUsRUFBRTtBQUNWSCxJQUFBQSxHQUFHLEVBQUUsaUJBREs7QUFFVkMsSUFBQUEsUUFBUSxFQUFFO0FBRkEsR0FUMEI7QUFhdENHLEVBQUFBLE9BQU8sRUFBRTtBQUNQSixJQUFBQSxHQUFHLEVBQUUscUJBREU7QUFFUEMsSUFBQUEsUUFBUSxFQUFFO0FBRkgsR0FiNkI7QUFpQnRDLHNCQUFvQjtBQUNsQkQsSUFBQUEsR0FBRyxFQUFFLHFCQURhO0FBRWxCQyxJQUFBQSxRQUFRLEVBQUU7QUFGUSxHQWpCa0I7QUFxQnRDLHNCQUFvQjtBQUNsQkQsSUFBQUEsR0FBRyxFQUFFLDRCQURhO0FBRWxCQyxJQUFBQSxRQUFRLEVBQUU7QUFGUSxHQXJCa0I7QUF5QnRDSSxFQUFB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LGFBQWEsQ0FBQ0MsSUFBZCxDQUFvQnhGLENBQUQsSUFBT3RLLGdCQUFnQixDQUFDK1AsSUFBakIsQ0FBc0J6RixDQUF0QixDQUExQixDQUFyQjtBQUNELENBSEQ7O0FBS0FySyxPQUFPLENBQUMrUCxTQUFSLEdBQW9CQyxrQkFBcEI7QUFDQWhRLE9BQU8sQ0FBQzRMLFFBQVIsR0FBbUJBLHNCQUFuQjtlQUdlNUwsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IHJldHJ5LCByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBmcyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHBhdGggYXMgc2V0dGluZ3NBcGtQYXRoIH0gZnJvbSAnaW8uYXBwaXVtLnNldHRpbmdzJztcbmltcG9ydCBCb290c3RyYXAgZnJvbSAnLi9ib290c3RyYXAnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IEFEQiBmcm9tICdhcHBpdW0tYWRiJztcbmltcG9ydCB7XG4gIGRlZmF1bHQgYXMgdW5sb2NrZXIsIFBJTl9VTkxPQ0ssIFBBU1NXT1JEX1VOTE9DSyxcbiAgUEFUVEVSTl9VTkxPQ0ssIEZJTkdFUlBSSU5UX1VOTE9DSyB9IGZyb20gJy4vdW5sb2NrLWhlbHBlcnMnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuXG5jb25zdCBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCA9IDkwMDAwOyAvLyBtaWxsaXNlY29uZHNcbmNvbnN0IENIUk9NRV9CUk9XU0VSX1BBQ0tBR0VfQUNUSVZJVFkgPSB7XG4gIGNocm9tZToge1xuICAgIHBrZzogJ2NvbS5hbmRyb2lkLmNocm9tZScsXG4gICAgYWN0aXZpdHk6ICdjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbicsXG4gIH0sXG4gIGNocm9taXVtOiB7XG4gICAgcGtnOiAnb3JnLmNocm9taXVtLmNocm9tZS5zaGVsbCcsXG4gICAgYWN0aXZpdHk6ICcuQ2hyb21lU2hlbGxBY3Rpdml0eScsXG4gIH0sXG4gIGNocm9tZWJldGE6IHtcbiAgICBwa2c6ICdjb20uY2hyb21lLmJldGEnLFxuICAgIGFjdGl2aXR5OiAnY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4nLFxuICB9LFxuICBicm93c2VyOiB7XG4gICAgcGtnOiAnY29tLmFuZHJvaWQuYnJvd3NlcicsXG4gICAgYWN0aXZpdHk6ICdjb20uYW5kcm9pZC5icm93c2VyLkJyb3dzZXJBY3Rpdml0eScsXG4gIH0sXG4gICdjaHJvbWl1bS1icm93c2VyJzoge1xuICAgIHBrZzogJ29yZy5jaHJvbWl1bS5jaHJvbWUnLFxuICAgIGFjdGl2aXR5OiAnY29tLmdvb2dsZS5hbmRyb2lkLmFwcHMuY2hyb21lLk1haW4nLFxuICB9LFxuICAnY2hyb21pdW0td2Vidmlldyc6IHtcbiAgICBwa2c6ICdvcmcuY2hyb21pdW0ud2Vidmlld19zaGVsbCcsXG4gICAgYWN0aXZpdHk6ICdvcmcuY2hyb21pdW0ud2Vidmlld19zaGVsbC5XZWJWaWV3QnJvd3NlckFjdGl2aXR5JyxcbiAgfSxcbiAgZGVmYXVsdDoge1xuICAgIHBrZzogJ2NvbS5hbmRyb2lkLmNocm9tZScsXG4gICAgYWN0aXZpdHk6ICdjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbicsXG4gIH0sXG59O1xuY29uc3QgU0VUVElOR1NfSEVMUEVSX1BLR19JRCA9ICdpby5hcHBpdW0uc2V0dGluZ3MnO1xuY29uc3QgU0VUVElOR1NfSEVMUEVSX1VOTE9DS19BQ1RJVklUWSA9ICcuVW5sb2NrJztcbmNvbnN0IEVNVUxBVE9SX1BBVFRFUk4gPSAvXFxiZW11bGF0b3JcXGIvaTtcblxubGV0IGhlbHBlcnMgPSB7fTtcblxuaGVscGVycy5jcmVhdGVCYXNlQURCID0gYXN5bmMgZnVuY3Rpb24gY3JlYXRlQmFzZUFEQiAob3B0cyA9IHt9KSB7XG4gIC8vIGZpbHRlciBvdXQgYW55IHVud2FudGVkIG9wdGlvbnMgc2VudCBpblxuICAvLyB0aGlzIGxpc3Qgc2hvdWxkIGJlIHVwZGF0ZWQgYXMgQURCIHRha2VzIG1vcmUgYXJndW1lbnRzXG4gIGNvbnN0IHtcbiAgICBhZGJQb3J0LFxuICAgIHN1cHByZXNzS2lsbFNlcnZlcixcbiAgICByZW1vdGVBZGJIb3N0LFxuICAgIGNsZWFyRGV2aWNlTG9nc09uU3RhcnQsXG4gICAgYWRiRXhlY1RpbWVvdXQsXG4gICAgdXNlS2V5c3RvcmUsXG4gICAga2V5c3RvcmVQYXRoLFxuICAgIGtleXN0b3JlUGFzc3dvcmQsXG4gICAga2V5QWxpYXMsXG4gICAga2V5UGFzc3dvcmQsXG4gICAgcmVtb3RlQXBwc0NhY2hlTGltaXQsXG4gICAgYnVpbGRUb29sc1ZlcnNpb24sXG4gICAgYWxsb3dPZmZsaW5lRGV2aWNlcyxcbiAgfSA9IG9wdHM7XG4gIHJldHVybiBhd2FpdCBBREIuY3JlYXRlQURCKHtcbiAgICBhZGJQb3J0LFxuICAgIHN1cHByZXNzS2lsbFNlcnZlcixcbiAgICByZW1vdGVBZGJIb3N0LFxuICAgIGNsZWFyRGV2aWNlTG9nc09uU3RhcnQsXG4gICAgYWRiRXhlY1RpbWVvdXQsXG4gICAgdXNlS2V5c3RvcmUsXG4gICAga2V5c3RvcmVQYXRoLFxuICAgIGtleXN0b3JlUGFzc3dvcmQsXG4gICAga2V5QWxpYXMsXG4gICAga2V5UGFzc3dvcmQsXG4gICAgcmVtb3RlQXBwc0NhY2hlTGltaXQsXG4gICAgYnVpbGRUb29sc1ZlcnNpb24sXG4gICAgYWxsb3dPZmZsaW5lRGV2aWNlcyxcbiAgfSk7XG59O1xuXG5oZWxwZXJzLnByZXBhcmVFbXVsYXRvciA9IGFzeW5jIGZ1bmN0aW9uIHByZXBhcmVFbXVsYXRvciAoYWRiLCBvcHRzKSB7XG4gIGxldCB7XG4gICAgYXZkLFxuICAgIGF2ZEFyZ3MsXG4gICAgbGFuZ3VhZ2UsXG4gICAgbG9jYWxlLFxuICAgIGF2ZExhdW5jaFRpbWVvdXQsXG4gICAgYXZkUmVhZHlUaW1lb3V0LFxuICB9ID0gb3B0cztcbiAgaWYgKCFhdmQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBsYXVuY2ggQVZEIHdpdGhvdXQgQVZEIG5hbWUnKTtcbiAgfVxuICBsZXQgYXZkTmFtZSA9IGF2ZC5yZXBsYWNlKCdAJywgJycpO1xuICBsZXQgcnVubmluZ0FWRCA9IGF3YWl0IGFkYi5nZXRSdW5uaW5nQVZEKGF2ZE5hbWUpO1xuICBpZiAocnVubmluZ0FWRCAhPT0gbnVsbCkge1xuICAgIGlmIChhdmRBcmdzICYmIGF2ZEFyZ3MudG9Mb3dlckNhc2UoKS5pbmRleE9mKCctd2lwZS1kYXRhJykgPiAtMSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBLaWxsaW5nICcke2F2ZE5hbWV9JyBiZWNhdXNlIGl0IG5lZWRzIHRvIGJlIHdpcGVkIGF0IHN0YXJ0LmApO1xuICAgICAgYXdhaXQgYWRiLmtpbGxFbXVsYXRvcihhdmROYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdOb3QgbGF1bmNoaW5nIEFWRCBiZWNhdXNlIGl0IGlzIGFscmVhZHkgcnVubmluZy4nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgYXZkQXJncyA9IHRoaXMucHJlcGFyZUFWREFyZ3Mob3B0cywgYWRiLCBhdmRBcmdzKTtcbiAgYXdhaXQgYWRiLmxhdW5jaEFWRChhdmQsIGF2ZEFyZ3MsIGxhbmd1YWdlLCBsb2NhbGUsIGF2ZExhdW5jaFRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgICAgYXZkUmVhZHlUaW1lb3V0KTtcbn07XG5cbmhlbHBlcnMucHJlcGFyZUFWREFyZ3MgPSBmdW5jdGlvbiBwcmVwYXJlQVZEQXJncyAob3B0cywgYWRiLCBhdmRBcmdzKSB7XG4gIGxldCBhcmdzID0gYXZkQXJncyA/IFthdmRBcmdzXSA6IFtdO1xuICBpZiAoIV8uaXNVbmRlZmluZWQob3B0cy5uZXR3b3JrU3BlZWQpKSB7XG4gICAgbGV0IG5ldHdvcmtTcGVlZCA9IHRoaXMuZW5zdXJlTmV0d29ya1NwZWVkKGFkYiwgb3B0cy5uZXR3b3JrU3BlZWQpO1xuICAgIGFyZ3MucHVzaCgnLW5ldHNwZWVkJywgbmV0d29ya1NwZWVkKTtcbiAgfVxuICBpZiAob3B0cy5pc0hlYWRsZXNzKSB7XG4gICAgYXJncy5wdXNoKCctbm8td2luZG93Jyk7XG4gIH1cbiAgcmV0dXJuIGFyZ3Muam9pbignICcpO1xufTtcblxuaGVscGVycy5lbnN1cmVOZXR3b3JrU3BlZWQgPSBmdW5jdGlvbiBlbnN1cmVOZXR3b3JrU3BlZWQgKGFkYiwgbmV0d29ya1NwZWVkKSB7XG4gIGlmIChfLnZhbHVlcyhhZGIuTkVUV09SS19TUEVFRCkuaW5kZXhPZihuZXR3b3JrU3BlZWQpICE9PSAtMSkge1xuICAgIHJldHVybiBuZXR3b3JrU3BlZWQ7XG4gIH1cbiAgbG9nZ2VyLndhcm4oYFdyb25nIG5ldHdvcmsgc3BlZWQgcGFyYW0gJHtuZXR3b3JrU3BlZWR9LCB1c2luZyBkZWZhdWx0OiBmdWxsLiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGFkYi5ORVRXT1JLX1NQRUVEKX1gKTtcbiAgcmV0dXJuIGFkYi5ORVRXT1JLX1NQRUVELkZVTEw7XG59O1xuXG4vKipcbiAqIFNldCBhbmQgZW5zdXJlIHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGFkYiAtIFRoZSBhZGIgbW9kdWxlIGluc3RhbmNlLlxuICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gTGFuZ3VhZ2UuIFRoZSBsYW5ndWFnZSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIGxvd2VyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezIsOH0uIGUuZy4gZW4sIGphIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgY291bnRyeSAocmVnaW9uKSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHVwcGVyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezJ9IHwgWzAtOV17M30uIGUuZy4gVVMsIEpQIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezR9LiBlLmcuIEhhbnMgaW4gemgtSGFucy1DTiA6IGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9qYXZhL3V0aWwvTG9jYWxlLmh0bWxcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBpdCBmYWlsZWQgdG8gc2V0IGxvY2FsZSBwcm9wZXJseVxuICovXG5oZWxwZXJzLmVuc3VyZURldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZURldmljZUxvY2FsZSAoYWRiLCBsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0ID0gbnVsbCkge1xuICBpZiAoIV8uaXNTdHJpbmcobGFuZ3VhZ2UpICYmICFfLmlzU3RyaW5nKGNvdW50cnkpKSB7XG4gICAgbG9nZ2VyLndhcm4oYHNldERldmljZUxhbmd1YWdlQ291bnRyeSByZXF1aXJlcyBsYW5ndWFnZSBvciBjb3VudHJ5LmApO1xuICAgIGxvZ2dlci53YXJuKGBHb3QgbGFuZ3VhZ2U6ICcke2xhbmd1YWdlfScgYW5kIGNvdW50cnk6ICcke2NvdW50cnl9J2ApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGF3YWl0IGFkYi5zZXREZXZpY2VMYW5ndWFnZUNvdW50cnkobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCk7XG5cbiAgaWYgKCFhd2FpdCBhZGIuZW5zdXJlQ3VycmVudExvY2FsZShsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0KSkge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBzY3JpcHQgPyBgbGFuZ3VhZ2U6ICR7bGFuZ3VhZ2V9LCBjb3VudHJ5OiAke2NvdW50cnl9IGFuZCBzY3JpcHQ6ICR7c2NyaXB0fWAgOiBgbGFuZ3VhZ2U6ICR7bGFuZ3VhZ2V9IGFuZCBjb3VudHJ5OiAke2NvdW50cnl9YDtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzZXQgJHttZXNzYWdlfWApO1xuICB9XG59O1xuXG5oZWxwZXJzLmdldERldmljZUluZm9Gcm9tQ2FwcyA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZUluZm9Gcm9tQ2FwcyAob3B0cyA9IHt9KSB7XG4gIC8vIHdlIGNhbiBjcmVhdGUgYSB0aHJvd2F3YXkgQURCIGluc3RhbmNlIGhlcmUsIHNvIHRoZXJlIGlzIG5vIGRlcGVuZGVuY3lcbiAgLy8gb24gaW5zdGFudGlhdGluZyBvbiBlYXJsaWVyIChhdCB0aGlzIHBvaW50LCB3ZSBoYXZlIG5vIHVkaWQpXG4gIC8vIHdlIGNhbiBvbmx5IHVzZSB0aGlzIEFEQiBvYmplY3QgZm9yIGNvbW1hbmRzIHRoYXQgd291bGQgbm90IGJlIGNvbmZ1c2VkXG4gIC8vIGlmIG11bHRpcGxlIGRldmljZXMgYXJlIGNvbm5lY3RlZFxuICBjb25zdCBhZGIgPSBhd2FpdCBoZWxwZXJzLmNyZWF0ZUJhc2VBREIob3B0cyk7XG4gIGxldCB1ZGlkID0gb3B0cy51ZGlkO1xuICBsZXQgZW1Qb3J0ID0gbnVsbDtcblxuICAvLyBhIHNwZWNpZmljIGF2ZCBuYW1lIHdhcyBnaXZlbi4gdHJ5IHRvIGluaXRpYWxpemUgd2l0aCB0aGF0XG4gIGlmIChvcHRzLmF2ZCkge1xuICAgIGF3YWl0IGhlbHBlcnMucHJlcGFyZUVtdWxhdG9yKGFkYiwgb3B0cyk7XG4gICAgdWRpZCA9IGFkYi5jdXJEZXZpY2VJZDtcbiAgICBlbVBvcnQgPSBhZGIuZW11bGF0b3JQb3J0O1xuICB9IGVsc2Uge1xuICAgIC8vIG5vIGF2ZCBnaXZlbi4gbGV0cyB0cnkgd2hhdGV2ZXIncyBwbHVnZ2VkIGluIGRldmljZXMvZW11bGF0b3JzXG4gICAgbG9nZ2VyLmluZm8oJ1JldHJpZXZpbmcgZGV2aWNlIGxpc3QnKTtcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IGFkYi5nZXREZXZpY2VzV2l0aFJldHJ5KCk7XG5cbiAgICAvLyB1ZGlkIHdhcyBnaXZlbiwgbGV0cyB0cnkgdG8gaW5pdCB3aXRoIHRoYXQgZGV2aWNlXG4gICAgaWYgKHVkaWQpIHtcbiAgICAgIGlmICghXy5pbmNsdWRlcyhfLm1hcChkZXZpY2VzLCAndWRpZCcpLCB1ZGlkKSkge1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhgRGV2aWNlICR7dWRpZH0gd2FzIG5vdCBpbiB0aGUgbGlzdCBvZiBjb25uZWN0ZWQgZGV2aWNlc2ApO1xuICAgICAgfVxuICAgICAgZW1Qb3J0ID0gYWRiLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcodWRpZCk7XG4gICAgfSBlbHNlIGlmIChvcHRzLnBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgb3B0cy5wbGF0Zm9ybVZlcnNpb24gPSBgJHtvcHRzLnBsYXRmb3JtVmVyc2lvbn1gLnRyaW0oKTtcblxuICAgICAgLy8gYSBwbGF0Zm9ybSB2ZXJzaW9uIHdhcyBnaXZlbi4gbGV0cyB0cnkgdG8gZmluZCBhIGRldmljZSB3aXRoIHRoZSBzYW1lIG9zXG4gICAgICBjb25zdCBwbGF0Zm9ybVZlcnNpb24gPSBzZW12ZXIuY29lcmNlKG9wdHMucGxhdGZvcm1WZXJzaW9uKSB8fCBvcHRzLnBsYXRmb3JtVmVyc2lvbjtcbiAgICAgIGxvZ2dlci5pbmZvKGBMb29raW5nIGZvciBhIGRldmljZSB3aXRoIEFuZHJvaWQgJyR7cGxhdGZvcm1WZXJzaW9ufSdgKTtcblxuICAgICAgLy8gaW4gY2FzZSB3ZSBmYWlsIHRvIGZpbmQgc29tZXRoaW5nLCBnaXZlIHRoZSB1c2VyIGEgdXNlZnVsIGxvZyB0aGF0IGhhc1xuICAgICAgLy8gdGhlIGRldmljZSB1ZGlkcyBhbmQgb3MgdmVyc2lvbnMgc28gdGhleSBrbm93IHdoYXQncyBhdmFpbGFibGVcbiAgICAgIGNvbnN0IGF2YWlsRGV2aWNlcyA9IFtdO1xuICAgICAgbGV0IHBhcnRpYWxNYXRjaENhbmRpZGF0ZSA9IG51bGw7XG4gICAgICAvLyBmaXJzdCB0cnkgc3RhcnRlZCBkZXZpY2VzL2VtdWxhdG9yc1xuICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgZGV2aWNlcykge1xuICAgICAgICAvLyBkaXJlY3QgYWRiIGNhbGxzIHRvIHRoZSBzcGVjaWZpYyBkZXZpY2VcbiAgICAgICAgYXdhaXQgYWRiLnNldERldmljZUlkKGRldmljZS51ZGlkKTtcbiAgICAgICAgY29uc3QgcmF3RGV2aWNlT1MgPSBhd2FpdCBhZGIuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgICAgIC8vIFRoZSBkZXZpY2UgT1MgY291bGQgZWl0aGVyIGJlIGEgbnVtYmVyLCBsaWtlIGA2LjBgXG4gICAgICAgIC8vIG9yIGFuIGFiYnJldmlhdGlvbiwgbGlrZSBgUmBcbiAgICAgICAgYXZhaWxEZXZpY2VzLnB1c2goYCR7ZGV2aWNlLnVkaWR9ICgke3Jhd0RldmljZU9TfSlgKTtcbiAgICAgICAgY29uc3QgZGV2aWNlT1MgPSBzZW12ZXIuY29lcmNlKHJhd0RldmljZU9TKSB8fCByYXdEZXZpY2VPUztcbiAgICAgICAgaWYgKCFkZXZpY2VPUykge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYm90aFZlcnNpb25zQ2FuQmVDb2VyY2VkID0gc2VtdmVyLnZhbGlkKGRldmljZU9TKSAmJiBzZW12ZXIudmFsaWQocGxhdGZvcm1WZXJzaW9uKTtcbiAgICAgICAgY29uc3QgYm90aFZlcnNpb25zQXJlU3RyaW5ncyA9IF8uaXNTdHJpbmcoZGV2aWNlT1MpICYmIF8uaXNTdHJpbmcocGxhdGZvcm1WZXJzaW9uKTtcbiAgICAgICAgaWYgKGJvdGhWZXJzaW9uc0NhbkJlQ29lcmNlZCAmJiBkZXZpY2VPUy52ZXJzaW9uID09PSBwbGF0Zm9ybVZlcnNpb24udmVyc2lvblxuICAgICAgICAgICAgfHwgYm90aFZlcnNpb25zQXJlU3RyaW5ncyAmJiBfLnRvTG93ZXIoZGV2aWNlT1MpID09PSBfLnRvTG93ZXIocGxhdGZvcm1WZXJzaW9uKSkge1xuICAgICAgICAgIC8vIEdvdCBhbiBleGFjdCBtYXRjaCAtIHByb2NlZWQgaW1tZWRpYXRlbHlcbiAgICAgICAgICB1ZGlkID0gZGV2aWNlLnVkaWQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH0gZWxzZSBpZiAoIWJvdGhWZXJzaW9uc0NhbkJlQ29lcmNlZCkge1xuICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIHBvaW50IHRvIGNoZWNrIGZvciBwYXJ0aWFsIG1hdGNoIGlmIGVpdGhlciBvZiB2ZXJzaW9uIG51bWJlcnMgaXMgbm90IGNvZXJjaWJsZVxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCghXy5pbmNsdWRlcyhvcHRzLnBsYXRmb3JtVmVyc2lvbiwgJy4nKSAmJiBwbGF0Zm9ybVZlcnNpb24ubWFqb3IgPT09IGRldmljZU9TLm1ham9yXG4gICAgICAgICAgICB8fCBwbGF0Zm9ybVZlcnNpb24ubWFqb3IgPT09IGRldmljZU9TLm1ham9yICYmIHBsYXRmb3JtVmVyc2lvbi5taW5vciA9PT0gZGV2aWNlT1MubWlub3IpXG4gICAgICAgICAgICAvLyBHb3QgYSBwYXJ0aWFsIG1hdGNoIC0gbWFrZSBzdXJlIHdlIGNvbnNpZGVyIHRoZSBtb3N0IHJlY2VudFxuICAgICAgICAgICAgLy8gZGV2aWNlIHZlcnNpb24gYXZhaWxhYmxlIG9uIHRoZSBob3N0IHN5c3RlbVxuICAgICAgICAgICAgJiYgKHBhcnRpYWxNYXRjaENhbmRpZGF0ZSAmJiBzZW12ZXIuZ3QoZGV2aWNlT1MsIF8udmFsdWVzKHBhcnRpYWxNYXRjaENhbmRpZGF0ZSlbMF0pXG4gICAgICAgICAgICAgICAgfHwgIXBhcnRpYWxNYXRjaENhbmRpZGF0ZSkpIHtcbiAgICAgICAgICBwYXJ0aWFsTWF0Y2hDYW5kaWRhdGUgPSB7W2RldmljZS51ZGlkXTogZGV2aWNlT1N9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIXVkaWQgJiYgcGFydGlhbE1hdGNoQ2FuZGlkYXRlKSB7XG4gICAgICAgIHVkaWQgPSBfLmtleXMocGFydGlhbE1hdGNoQ2FuZGlkYXRlKVswXTtcbiAgICAgICAgYXdhaXQgYWRiLnNldERldmljZUlkKHVkaWQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXVkaWQpIHtcbiAgICAgICAgLy8gd2UgY291bGRuJ3QgZmluZCBhbnl0aGluZyEgcXVpdFxuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhgVW5hYmxlIHRvIGZpbmQgYW4gYWN0aXZlIGRldmljZSBvciBlbXVsYXRvciBgICtcbiAgICAgICAgICBgd2l0aCBPUyAke29wdHMucGxhdGZvcm1WZXJzaW9ufS4gVGhlIGZvbGxvd2luZyBhcmUgYXZhaWxhYmxlOiBgICtcbiAgICAgICAgICBhdmFpbERldmljZXMuam9pbignLCAnKSk7XG4gICAgICB9XG5cbiAgICAgIGVtUG9ydCA9IGFkYi5nZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nKHVkaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBhIHVkaWQgd2FzIG5vdCBnaXZlbiwgZ3JhYiB0aGUgZmlyc3QgZGV2aWNlIHdlIHNlZVxuICAgICAgdWRpZCA9IGRldmljZXNbMF0udWRpZDtcbiAgICAgIGVtUG9ydCA9IGFkYi5nZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nKHVkaWQpO1xuICAgIH1cbiAgfVxuXG4gIGxvZ2dlci5pbmZvKGBVc2luZyBkZXZpY2U6ICR7dWRpZH1gKTtcbiAgcmV0dXJuIHt1ZGlkLCBlbVBvcnR9O1xufTtcblxuLy8gcmV0dXJucyBhIG5ldyBhZGIgaW5zdGFuY2Ugd2l0aCBkZXZpY2VJZCBzZXRcbmhlbHBlcnMuY3JlYXRlQURCID0gYXN5bmMgZnVuY3Rpb24gY3JlYXRlQURCIChvcHRzID0ge30pIHtcbiAgY29uc3Qge3VkaWQsIGVtUG9ydH0gPSBvcHRzO1xuICBjb25zdCBhZGIgPSBhd2FpdCBoZWxwZXJzLmNyZWF0ZUJhc2VBREIob3B0cyk7XG4gIGFkYi5zZXREZXZpY2VJZCh1ZGlkKTtcbiAgaWYgKGVtUG9ydCkge1xuICAgIGFkYi5zZXRFbXVsYXRvclBvcnQoZW1Qb3J0KTtcbiAgfVxuXG4gIHJldHVybiBhZGI7XG59O1xuXG5oZWxwZXJzLnZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMgPSBmdW5jdGlvbiB2YWxpZGF0ZVBhY2thZ2VBY3Rpdml0eU5hbWVzIChvcHRzKSB7XG4gIGZvciAoY29uc3Qga2V5IG9mIFsnYXBwUGFja2FnZScsICdhcHBBY3Rpdml0eScsICdhcHBXYWl0UGFja2FnZScsICdhcHBXYWl0QWN0aXZpdHknXSkge1xuICAgIGNvbnN0IG5hbWUgPSBvcHRzW2tleV07XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXRjaCA9IC8oW15cXHcuKixdKSsvLmV4ZWMobmFtZSk7XG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgbG9nZ2VyLndhcm4oYENhcGFiaWxpdHkgJyR7a2V5fScgaXMgZXhwZWN0ZWQgdG8gb25seSBpbmNsdWRlIGxhdGluIGxldHRlcnMsIGRpZ2l0cywgdW5kZXJzY29yZSwgZG90LCBjb21tYSBhbmQgYXN0ZXJpc2sgY2hhcmFjdGVycy5gKTtcbiAgICBsb2dnZXIud2FybihgQ3VycmVudCB2YWx1ZSAnJHtuYW1lfScgaGFzIG5vbi1tYXRjaGluZyBjaGFyYWN0ZXIgYXQgaW5kZXggJHttYXRjaC5pbmRleH06ICcke25hbWUuc3Vic3RyaW5nKDAsIG1hdGNoLmluZGV4ICsgMSl9J2ApO1xuICB9XG59O1xuXG5oZWxwZXJzLmdldExhdW5jaEluZm8gPSBhc3luYyBmdW5jdGlvbiBnZXRMYXVuY2hJbmZvIChhZGIsIG9wdHMpIHtcbiAgbGV0IHthcHAsIGFwcFBhY2thZ2UsIGFwcEFjdGl2aXR5LCBhcHBXYWl0UGFja2FnZSwgYXBwV2FpdEFjdGl2aXR5fSA9IG9wdHM7XG4gIGlmICghYXBwKSB7XG4gICAgbG9nZ2VyLndhcm4oJ05vIGFwcCBzZW50IGluLCBub3QgcGFyc2luZyBwYWNrYWdlL2FjdGl2aXR5Jyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhpcy52YWxpZGF0ZVBhY2thZ2VBY3Rpdml0eU5hbWVzKG9wdHMpO1xuXG4gIGlmIChhcHBQYWNrYWdlICYmIGFwcEFjdGl2aXR5KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdQYXJzaW5nIHBhY2thZ2UgYW5kIGFjdGl2aXR5IGZyb20gYXBwIG1hbmlmZXN0Jyk7XG4gIGxldCB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9ID1cbiAgICBhd2FpdCBhZGIucGFja2FnZUFuZExhdW5jaEFjdGl2aXR5RnJvbU1hbmlmZXN0KGFwcCk7XG4gIGlmIChhcGtQYWNrYWdlICYmICFhcHBQYWNrYWdlKSB7XG4gICAgYXBwUGFja2FnZSA9IGFwa1BhY2thZ2U7XG4gIH1cbiAgaWYgKCFhcHBXYWl0UGFja2FnZSkge1xuICAgIGFwcFdhaXRQYWNrYWdlID0gYXBwUGFja2FnZTtcbiAgfVxuICBpZiAoYXBrQWN0aXZpdHkgJiYgIWFwcEFjdGl2aXR5KSB7XG4gICAgYXBwQWN0aXZpdHkgPSBhcGtBY3Rpdml0eTtcbiAgfVxuICBpZiAoIWFwcFdhaXRBY3Rpdml0eSkge1xuICAgIGFwcFdhaXRBY3Rpdml0eSA9IGFwcEFjdGl2aXR5O1xuICB9XG4gIGxvZ2dlci5kZWJ1ZyhgUGFyc2VkIHBhY2thZ2UgYW5kIGFjdGl2aXR5IGFyZTogJHthcGtQYWNrYWdlfS8ke2Fwa0FjdGl2aXR5fWApO1xuICByZXR1cm4ge2FwcFBhY2thZ2UsIGFwcFdhaXRQYWNrYWdlLCBhcHBBY3Rpdml0eSwgYXBwV2FpdEFjdGl2aXR5fTtcbn07XG5cbmhlbHBlcnMucmVzZXRBcHAgPSBhc3luYyBmdW5jdGlvbiByZXNldEFwcCAoYWRiLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGFwcCxcbiAgICBhcHBQYWNrYWdlLFxuICAgIGZhc3RSZXNldCxcbiAgICBmdWxsUmVzZXQsXG4gICAgYW5kcm9pZEluc3RhbGxUaW1lb3V0ID0gUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQsXG4gICAgYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgYWxsb3dUZXN0UGFja2FnZXNcbiAgfSA9IG9wdHM7XG5cbiAgaWYgKCFhcHBQYWNrYWdlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiJ2FwcFBhY2thZ2UnIG9wdGlvbiBpcyByZXF1aXJlZFwiKTtcbiAgfVxuXG4gIGNvbnN0IGlzSW5zdGFsbGVkID0gYXdhaXQgYWRiLmlzQXBwSW5zdGFsbGVkKGFwcFBhY2thZ2UpO1xuXG4gIGlmIChpc0luc3RhbGxlZCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBhZGIuZm9yY2VTdG9wKGFwcFBhY2thZ2UpO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICAvLyBmdWxsUmVzZXQgaGFzIHByaW9yaXR5IG92ZXIgZmFzdFJlc2V0XG4gICAgaWYgKCFmdWxsUmVzZXQgJiYgZmFzdFJlc2V0KSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCBhZGIuY2xlYXIoYXBwUGFja2FnZSk7XG4gICAgICBpZiAoXy5pc1N0cmluZyhvdXRwdXQpICYmIG91dHB1dC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdmYWlsZWQnKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjbGVhciB0aGUgYXBwbGljYXRpb24gZGF0YSBvZiAnJHthcHBQYWNrYWdlfScuIE9yaWdpbmFsIGVycm9yOiAke291dHB1dH1gKTtcbiAgICAgIH1cbiAgICAgIC8vIGV4ZWN1dGluZyBgc2hlbGwgcG0gY2xlYXJgIHJlc2V0cyBwcmV2aW91c2x5IGFzc2lnbmVkIGFwcGxpY2F0aW9uIHBlcm1pc3Npb25zIGFzIHdlbGxcbiAgICAgIGlmIChhdXRvR3JhbnRQZXJtaXNzaW9ucykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IGFkYi5ncmFudEFsbFBlcm1pc3Npb25zKGFwcFBhY2thZ2UpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcihgVW5hYmxlIHRvIGdyYW50IHBlcm1pc3Npb25zIHJlcXVlc3RlZC4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbG9nZ2VyLmRlYnVnKGBQZXJmb3JtZWQgZmFzdCByZXNldCBvbiB0aGUgaW5zdGFsbGVkICcke2FwcFBhY2thZ2V9JyBhcHBsaWNhdGlvbiAoc3RvcCBhbmQgY2xlYXIpYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgaWYgKCFhcHApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCInYXBwJyBvcHRpb24gaXMgcmVxdWlyZWQgZm9yIHJlaW5zdGFsbFwiKTtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZyhgUnVubmluZyBmdWxsIHJlc2V0IG9uICcke2FwcFBhY2thZ2V9JyAocmVpbnN0YWxsKWApO1xuICBpZiAoaXNJbnN0YWxsZWQpIHtcbiAgICBhd2FpdCBhZGIudW5pbnN0YWxsQXBrKGFwcFBhY2thZ2UpO1xuICB9XG4gIGF3YWl0IGFkYi5pbnN0YWxsKGFwcCwge1xuICAgIGdyYW50UGVybWlzc2lvbnM6IGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgIHRpbWVvdXQ6IGFuZHJvaWRJbnN0YWxsVGltZW91dCxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlcyxcbiAgfSk7XG59O1xuXG5oZWxwZXJzLmluc3RhbGxBcGsgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsQXBrIChhZGIsIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGFwcFBhY2thZ2UsXG4gICAgZmFzdFJlc2V0LFxuICAgIGZ1bGxSZXNldCxcbiAgICBhbmRyb2lkSW5zdGFsbFRpbWVvdXQgPSBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCxcbiAgICBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlcyxcbiAgICBlbmZvcmNlQXBwSW5zdGFsbCxcbiAgfSA9IG9wdHM7XG5cbiAgaWYgKCFhcHAgfHwgIWFwcFBhY2thZ2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCInYXBwJyBhbmQgJ2FwcFBhY2thZ2UnIG9wdGlvbnMgYXJlIHJlcXVpcmVkXCIpO1xuICB9XG5cbiAgaWYgKGZ1bGxSZXNldCkge1xuICAgIGF3YWl0IHRoaXMucmVzZXRBcHAoYWRiLCBvcHRzKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB7XG4gICAgYXBwU3RhdGUsXG4gICAgd2FzVW5pbnN0YWxsZWRcbiAgfSA9IGF3YWl0IGFkYi5pbnN0YWxsT3JVcGdyYWRlKGFwcCwgYXBwUGFja2FnZSwge1xuICAgIGdyYW50UGVybWlzc2lvbnM6IGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgIHRpbWVvdXQ6IGFuZHJvaWRJbnN0YWxsVGltZW91dCxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlcyxcbiAgICBlbmZvcmNlQ3VycmVudEJ1aWxkOiBlbmZvcmNlQXBwSW5zdGFsbCxcbiAgfSk7XG5cbiAgLy8gVGhlcmUgaXMgbm8gbmVlZCB0byByZXNldCB0aGUgbmV3bHkgaW5zdGFsbGVkIGFwcFxuICBjb25zdCBpc0luc3RhbGxlZE92ZXJFeGlzdGluZ0FwcCA9ICF3YXNVbmluc3RhbGxlZFxuICAgICYmIGFwcFN0YXRlICE9PSBhZGIuQVBQX0lOU1RBTExfU1RBVEUuTk9UX0lOU1RBTExFRDtcbiAgaWYgKGZhc3RSZXNldCAmJiBpc0luc3RhbGxlZE92ZXJFeGlzdGluZ0FwcCkge1xuICAgIGxvZ2dlci5pbmZvKGBQZXJmb3JtaW5nIGZhc3QgcmVzZXQgb24gJyR7YXBwUGFja2FnZX0nYCk7XG4gICAgYXdhaXQgdGhpcy5yZXNldEFwcChhZGIsIG9wdHMpO1xuICB9XG59O1xuXG4vKipcbiAqIEluc3RhbGxzIGFuIGFycmF5IG9mIGFwa3NcbiAqIEBwYXJhbSB7QURCfSBhZGIgSW5zdGFuY2Ugb2YgQXBwaXVtIEFEQiBvYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIE9wdHMgZGVmaW5lZCBpbiBkcml2ZXIuanNcbiAqL1xuaGVscGVycy5pbnN0YWxsT3RoZXJBcGtzID0gYXN5bmMgZnVuY3Rpb24gaW5zdGFsbE90aGVyQXBrcyAob3RoZXJBcHBzLCBhZGIsIG9wdHMpIHtcbiAgbGV0IHtcbiAgICBhbmRyb2lkSW5zdGFsbFRpbWVvdXQgPSBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCxcbiAgICBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlc1xuICB9ID0gb3B0cztcblxuICAvLyBJbnN0YWxsIGFsbCBvZiB0aGUgQVBLJ3MgYXN5bmNocm9ub3VzbHlcbiAgYXdhaXQgQi5hbGwob3RoZXJBcHBzLm1hcCgob3RoZXJBcHApID0+IHtcbiAgICBsb2dnZXIuZGVidWcoYEluc3RhbGxpbmcgYXBwOiAke290aGVyQXBwfWApO1xuICAgIHJldHVybiBhZGIuaW5zdGFsbE9yVXBncmFkZShvdGhlckFwcCwgbnVsbCwge1xuICAgICAgZ3JhbnRQZXJtaXNzaW9uczogYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgICB0aW1lb3V0OiBhbmRyb2lkSW5zdGFsbFRpbWVvdXQsXG4gICAgICBhbGxvd1Rlc3RQYWNrYWdlcyxcbiAgICB9KTtcbiAgfSkpO1xufTtcblxuLyoqXG4gKiBVbmluc3RhbGwgYW4gYXJyYXkgb2YgcGFja2FnZXNcbiAqIEBwYXJhbSB7QURCfSBhZGIgSW5zdGFuY2Ugb2YgQXBwaXVtIEFEQiBvYmplY3RcbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gYXBwUGFja2FnZXMgQW4gYXJyYXkgb2YgcGFja2FnZSBuYW1lcyB0byB1bmluc3RhbGwuIElmIHRoaXMgaW5jbHVkZXMgYCcqJ2AsIHVuaW5zdGFsbCBhbGwgb2YgM3JkIHBhcnR5IGFwcHNcbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gZmlsdGVyUGFja2FnZXMgQW4gYXJyYXkgb2YgcGFja2FnZXMgZG9lcyBub3QgdW5pbnN0YWxsIHdoZW4gYCpgIGlzIHByb3ZpZGVkIGFzIGBhcHBQYWNrYWdlc2BcbiAqL1xuaGVscGVycy51bmluc3RhbGxPdGhlclBhY2thZ2VzID0gYXN5bmMgZnVuY3Rpb24gdW5pbnN0YWxsT3RoZXJQYWNrYWdlcyAoYWRiLCBhcHBQYWNrYWdlcywgZmlsdGVyUGFja2FnZXMgPSBbXSkge1xuICBpZiAoYXBwUGFja2FnZXMuaW5jbHVkZXMoJyonKSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnVW5pbnN0YWxsIHRoaXJkIHBhcnR5IHBhY2thZ2VzJyk7XG4gICAgYXBwUGFja2FnZXMgPSBhd2FpdCB0aGlzLmdldFRoaXJkUGFydHlQYWNrYWdlcyhhZGIsIGZpbHRlclBhY2thZ2VzKTtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZyhgVW5pbnN0YWxsaW5nIHBhY2thZ2VzOiAke2FwcFBhY2thZ2VzfWApO1xuICBhd2FpdCBCLmFsbChhcHBQYWNrYWdlcy5tYXAoKGFwcFBhY2thZ2UpID0+IGFkYi51bmluc3RhbGxBcGsoYXBwUGFja2FnZSkpKTtcbn07XG5cbi8qKlxuICogR2V0IHRoaXJkIHBhcnR5IHBhY2thZ2VzIGZpbHRlcmVkIHdpdGggYGZpbHRlclBhY2thZ2VzYFxuICogQHBhcmFtIHtBREJ9IGFkYiBJbnN0YW5jZSBvZiBBcHBpdW0gQURCIG9iamVjdFxuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBmaWx0ZXJQYWNrYWdlcyBBbiBhcnJheSBvZiBwYWNrYWdlcyBkb2VzIG5vdCB1bmluc3RhbGwgd2hlbiBgKmAgaXMgcHJvdmlkZWQgYXMgYGFwcFBhY2thZ2VzYFxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IEFuIGFycmF5IG9mIGluc3RhbGxlZCB0aGlyZCBwYXJ5IHBhY2thZ2VzXG4gKi9cbmhlbHBlcnMuZ2V0VGhpcmRQYXJ0eVBhY2thZ2VzID0gYXN5bmMgZnVuY3Rpb24gZ2V0VGhpcmRQYXJ0eVBhY2thZ2VzIChhZGIsIGZpbHRlclBhY2thZ2VzID0gW10pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYWNrYWdlc1N0cmluZyA9IGF3YWl0IGFkYi5zaGVsbChbJ3BtJywgJ2xpc3QnLCAncGFja2FnZXMnLCAnLTMnXSk7XG4gICAgY29uc3QgYXBwUGFja2FnZXNBcnJheSA9IHBhY2thZ2VzU3RyaW5nLnRyaW0oKS5yZXBsYWNlKC9wYWNrYWdlOi9nLCAnJykuc3BsaXQoRU9MKTtcbiAgICBsb2dnZXIuZGVidWcoYCcke2FwcFBhY2thZ2VzQXJyYXl9JyBmaWx0ZXJlZCB3aXRoICcke2ZpbHRlclBhY2thZ2VzfSdgKTtcbiAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGFwcFBhY2thZ2VzQXJyYXksIGZpbHRlclBhY2thZ2VzKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLndhcm4oYFVuYWJsZSB0byBnZXQgcGFja2FnZXMgd2l0aCAnYWRiIHNoZWxsIHBtIGxpc3QgcGFja2FnZXMgLTMnOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIHJldHVybiBbXTtcbiAgfVxufTtcblxuaGVscGVycy5pbml0VW5pY29kZUtleWJvYXJkID0gYXN5bmMgZnVuY3Rpb24gaW5pdFVuaWNvZGVLZXlib2FyZCAoYWRiKSB7XG4gIGxvZ2dlci5kZWJ1ZygnRW5hYmxpbmcgVW5pY29kZSBrZXlib2FyZCBzdXBwb3J0Jyk7XG5cbiAgLy8gZ2V0IHRoZSBkZWZhdWx0IElNRSBzbyB3ZSBjYW4gcmV0dXJuIGJhY2sgdG8gaXQgbGF0ZXIgaWYgd2Ugd2FudFxuICBsZXQgZGVmYXVsdElNRSA9IGF3YWl0IGFkYi5kZWZhdWx0SU1FKCk7XG5cbiAgbG9nZ2VyLmRlYnVnKGBVbnNldHRpbmcgcHJldmlvdXMgSU1FICR7ZGVmYXVsdElNRX1gKTtcbiAgY29uc3QgYXBwaXVtSU1FID0gYCR7U0VUVElOR1NfSEVMUEVSX1BLR19JRH0vLlVuaWNvZGVJTUVgO1xuICBsb2dnZXIuZGVidWcoYFNldHRpbmcgSU1FIHRvICcke2FwcGl1bUlNRX0nYCk7XG4gIGF3YWl0IGFkYi5lbmFibGVJTUUoYXBwaXVtSU1FKTtcbiAgYXdhaXQgYWRiLnNldElNRShhcHBpdW1JTUUpO1xuICByZXR1cm4gZGVmYXVsdElNRTtcbn07XG5cbmhlbHBlcnMuc2V0TW9ja0xvY2F0aW9uQXBwID0gYXN5bmMgZnVuY3Rpb24gc2V0TW9ja0xvY2F0aW9uQXBwIChhZGIsIGFwcCkge1xuICB0cnkge1xuICAgIGlmIChhd2FpdCBhZGIuZ2V0QXBpTGV2ZWwoKSA8IDIzKSB7XG4gICAgICBhd2FpdCBhZGIuc2hlbGwoWydzZXR0aW5ncycsICdwdXQnLCAnc2VjdXJlJywgJ21vY2tfbG9jYXRpb24nLCAnMSddKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgYWRiLnNoZWxsKFsnYXBwb3BzJywgJ3NldCcsIGFwcCwgJ2FuZHJvaWQ6bW9ja19sb2NhdGlvbicsICdhbGxvdyddKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci53YXJuKGBVbmFibGUgdG8gc2V0IG1vY2sgbG9jYXRpb24gZm9yIGFwcCAnJHthcHB9JzogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuaGVscGVycy5pbnN0YWxsSGVscGVyQXBwID0gYXN5bmMgZnVuY3Rpb24gaW5zdGFsbEhlbHBlckFwcCAoYWRiLCBhcGtQYXRoLCBwYWNrYWdlSWQpIHtcbiAgLy8gU29tZXRpbWVzIGFkYiBwdXNoIG9yIGFkYiBpbnN0YWwgdGFrZSBtb3JlIHRpbWUgdGhhbiBleHBlY3RlZCB0byBpbnN0YWxsIGFuIGFwcFxuICAvLyBlLmcuIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vaW8uYXBwaXVtLnNldHRpbmdzL2lzc3Vlcy80MCNpc3N1ZWNvbW1lbnQtNDc2NTkzMTc0XG4gIGF3YWl0IHJldHJ5KDIsIGFzeW5jIGZ1bmN0aW9uIHJldHJ5SW5zdGFsbEhlbHBlckFwcCAoKSB7XG4gICAgYXdhaXQgYWRiLmluc3RhbGxPclVwZ3JhZGUoYXBrUGF0aCwgcGFja2FnZUlkLCB7Z3JhbnRQZXJtaXNzaW9uczogdHJ1ZX0pO1xuICB9KTtcbn07XG5cbi8qKlxuICogUHVzaGVzIGFuZCBpbnN0YWxscyBpby5hcHBpdW0uc2V0dGluZ3MgYXBwLlxuICogVGhyb3dzIGFuIGVycm9yIGlmIHRoZSBzZXR0aW5nIGFwcCBpcyByZXF1aXJlZFxuICpcbiAqIEBwYXJhbSB7QWRifSBhZGIgLSBUaGUgYWRiIG1vZHVsZSBpbnN0YW5jZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gdGhyb3dFcnJvcltmYWxzZV0gLSBXaGV0aGVyIHRocm93IGVycm9yIG9yIG5vdFxuICogQHRocm93cyB7RXJyb3J9IElmIHRocm93RXJyb3IgaXMgdHJ1ZSBhbmQgc29tZXRoaW5nIGhhcHBlbnMgaW4gaW5zdGFsbGF0aW9uIHN0ZXBcbiAqL1xuaGVscGVycy5wdXNoU2V0dGluZ3NBcHAgPSBhc3luYyBmdW5jdGlvbiBwdXNoU2V0dGluZ3NBcHAgKGFkYiwgdGhyb3dFcnJvciA9IGZhbHNlKSB7XG4gIGxvZ2dlci5kZWJ1ZygnUHVzaGluZyBzZXR0aW5ncyBhcGsgdG8gZGV2aWNlLi4uJyk7XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBoZWxwZXJzLmluc3RhbGxIZWxwZXJBcHAoYWRiLCBzZXR0aW5nc0Fwa1BhdGgsIFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQsIHRocm93RXJyb3IpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAodGhyb3dFcnJvcikge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cblxuICAgIGxvZ2dlci53YXJuKGBJZ25vcmVkIGVycm9yIHdoaWxlIGluc3RhbGxpbmcgJyR7c2V0dGluZ3NBcGtQYXRofSc6IGAgK1xuICAgICAgICAgICAgICAgIGAnJHtlcnIubWVzc2FnZX0nLiBGZWF0dXJlcyB0aGF0IHJlbHkgb24gdGhpcyBoZWxwZXIgYCArXG4gICAgICAgICAgICAgICAgJ3JlcXVpcmUgdGhlIGFwayBzdWNoIGFzIHRvZ2dsZSBXaUZpIGFuZCBnZXR0aW5nIGxvY2F0aW9uICcgK1xuICAgICAgICAgICAgICAgICd3aWxsIHJhaXNlIGFuIGVycm9yIGlmIHlvdSB0cnkgdG8gdXNlIHRoZW0uJyk7XG4gIH1cblxuICAvLyBSZWluc3RhbGwgd2lsbCBzdG9wIHRoZSBzZXR0aW5ncyBoZWxwZXIgcHJvY2VzcyBhbnl3YXksIHNvXG4gIC8vIHRoZXJlIGlzIG5vIG5lZWQgdG8gY29udGludWUgaWYgdGhlIGFwcGxpY2F0aW9uIGlzIHN0aWxsIHJ1bm5pbmdcbiAgaWYgKGF3YWl0IGFkYi5wcm9jZXNzRXhpc3RzKFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGAke1NFVFRJTkdTX0hFTFBFUl9QS0dfSUR9IGlzIGFscmVhZHkgcnVubmluZy4gYCArXG4gICAgICBgVGhlcmUgaXMgbm8gbmVlZCB0byByZXNldCBpdHMgcGVybWlzc2lvbnMuYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpIDw9IDIzKSB7IC8vIEFuZHJvaWQgNi0gZGV2aWNlcyBzaG91bGQgaGF2ZSBncmFudGVkIHBlcm1pc3Npb25zXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vcHVsbC8xMTY0MCNpc3N1ZWNvbW1lbnQtNDM4MjYwNDc3XG4gICAgY29uc3QgcGVybXMgPSBbJ1NFVF9BTklNQVRJT05fU0NBTEUnLCAnQ0hBTkdFX0NPTkZJR1VSQVRJT04nLCAnQUNDRVNTX0ZJTkVfTE9DQVRJT04nXTtcbiAgICBsb2dnZXIuaW5mbyhgR3JhbnRpbmcgcGVybWlzc2lvbnMgJHtwZXJtc30gdG8gJyR7U0VUVElOR1NfSEVMUEVSX1BLR19JRH0nYCk7XG4gICAgYXdhaXQgYWRiLmdyYW50UGVybWlzc2lvbnMoU0VUVElOR1NfSEVMUEVSX1BLR19JRCwgcGVybXMubWFwKCh4KSA9PiBgYW5kcm9pZC5wZXJtaXNzaW9uLiR7eH1gKSk7XG4gIH1cblxuICAvLyBsYXVuY2ggaW8uYXBwaXVtLnNldHRpbmdzIGFwcCBkdWUgdG8gc2V0dGluZ3MgZmFpbGluZyB0byBiZSBzZXRcbiAgLy8gaWYgdGhlIGFwcCBpcyBub3QgbGF1bmNoZWQgcHJpb3IgdG8gc3RhcnQgdGhlIHNlc3Npb24gb24gYW5kcm9pZCA3K1xuICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzg5NTdcbiAgdHJ5IHtcbiAgICBhd2FpdCBhZGIucmVxdWlyZVJ1bm5pbmdTZXR0aW5nc0FwcCgpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIuZGVidWcoZXJyKTtcbiAgICBpZiAodGhyb3dFcnJvcikge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBFeHRyYWN0cyBzdHJpbmcueG1sIGFuZCBjb252ZXJ0cyBpdCB0byBzdHJpbmcuanNvbiBhbmQgcHVzaGVzXG4gKiBpdCB0byAvZGF0YS9sb2NhbC90bXAvc3RyaW5nLmpzb24gb24gZm9yIHVzZSBvZiBib290c3RyYXBcbiAqIElmIGFwcCBpcyBub3QgcHJlc2VudCB0byBleHRyYWN0IHN0cmluZy54bWwgaXQgZGVsZXRlcyByZW1vdGUgc3RyaW5ncy5qc29uXG4gKiBJZiBhcHAgZG9lcyBub3QgaGF2ZSBzdHJpbmdzLnhtbCB3ZSBwdXNoIGFuIGVtcHR5IGpzb24gb2JqZWN0IHRvIHJlbW90ZVxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZSBhYmJyZXZpYXRpb24sIGZvciBleGFtcGxlICdmcicuIFRoZSBkZWZhdWx0IGxhbmd1YWdlXG4gKiBpcyB1c2VkIGlmIHRoaXMgYXJndW1lbnQgaXMgbm90IGRlZmluZWQuXG4gKiBAcGFyYW0ge09iamVjdH0gYWRiIC0gVGhlIGFkYiBtb2R1bGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIERyaXZlciBvcHRpb25zIGRpY3Rpb25hcnkuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgZGljdGlvbmFyeSwgd2hlcmUgc3RyaW5nIHJlc291cmNlIGlkZW50aWZpZXJzIGFyZSBrZXlzXG4gKiBhbG9uZyB3aXRoIHRoZWlyIGNvcnJlc3BvbmRpbmcgdmFsdWVzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugb3IgYW4gZW1wdHkgb2JqZWN0XG4gKiBpZiBubyBtYXRjaGluZyByZXNvdXJjZXMgd2VyZSBleHRyYWN0ZWQuXG4gKi9cbmhlbHBlcnMucHVzaFN0cmluZ3MgPSBhc3luYyBmdW5jdGlvbiBwdXNoU3RyaW5ncyAobGFuZ3VhZ2UsIGFkYiwgb3B0cykge1xuICBjb25zdCByZW1vdGVEaXIgPSAnL2RhdGEvbG9jYWwvdG1wJztcbiAgY29uc3Qgc3RyaW5nc0pzb24gPSAnc3RyaW5ncy5qc29uJztcbiAgY29uc3QgcmVtb3RlRmlsZSA9IHBhdGgucG9zaXgucmVzb2x2ZShyZW1vdGVEaXIsIHN0cmluZ3NKc29uKTtcblxuICAvLyBjbGVhbiB1cCByZW1vdGUgc3RyaW5nLmpzb24gaWYgcHJlc2VudFxuICBhd2FpdCBhZGIucmltcmFmKHJlbW90ZUZpbGUpO1xuXG4gIGxldCBhcHA7XG4gIHRyeSB7XG4gICAgYXBwID0gb3B0cy5hcHAgfHwgYXdhaXQgYWRiLnB1bGxBcGsob3B0cy5hcHBQYWNrYWdlLCBvcHRzLnRtcERpcik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5pbmZvKGBGYWlsZWQgdG8gcHVsbCBhbiBhcGsgZnJvbSAnJHtvcHRzLmFwcFBhY2thZ2V9JyB0byAnJHtvcHRzLnRtcERpcn0nLiBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkob3B0cy5hcHBQYWNrYWdlKSB8fCAhKGF3YWl0IGZzLmV4aXN0cyhhcHApKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhgTm8gYXBwIG9yIHBhY2thZ2Ugc3BlY2lmaWVkLiBSZXR1cm5pbmcgZW1wdHkgc3RyaW5nc2ApO1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHN0cmluZ3NUbXBEaXIgPSBwYXRoLnJlc29sdmUob3B0cy50bXBEaXIsIG9wdHMuYXBwUGFja2FnZSk7XG4gIHRyeSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdFeHRyYWN0aW5nIHN0cmluZ3MgZnJvbSBhcGsnLCBhcHAsIGxhbmd1YWdlLCBzdHJpbmdzVG1wRGlyKTtcbiAgICBjb25zdCB7YXBrU3RyaW5ncywgbG9jYWxQYXRofSA9IGF3YWl0IGFkYi5leHRyYWN0U3RyaW5nc0Zyb21BcGsoYXBwLCBsYW5ndWFnZSwgc3RyaW5nc1RtcERpcik7XG4gICAgYXdhaXQgYWRiLnB1c2gobG9jYWxQYXRoLCByZW1vdGVEaXIpO1xuICAgIHJldHVybiBhcGtTdHJpbmdzO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIud2FybihgQ291bGQgbm90IGdldCBzdHJpbmdzLCBjb250aW51aW5nIGFueXdheS4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgYXdhaXQgYWRiLnNoZWxsKCdlY2hvJywgW2Ane30nID4gJHtyZW1vdGVGaWxlfWBdKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBhd2FpdCBmcy5yaW1yYWYoc3RyaW5nc1RtcERpcik7XG4gIH1cbiAgcmV0dXJuIHt9O1xufTtcblxuaGVscGVycy51bmxvY2tXaXRoVUlBdXRvbWF0aW9uID0gYXN5bmMgZnVuY3Rpb24gdW5sb2NrV2l0aFVJQXV0b21hdGlvbiAoZHJpdmVyLCBhZGIsIHVubG9ja0NhcGFiaWxpdGllcykge1xuICBsZXQgdW5sb2NrVHlwZSA9IHVubG9ja0NhcGFiaWxpdGllcy51bmxvY2tUeXBlO1xuICBpZiAoIXVubG9ja2VyLmlzVmFsaWRVbmxvY2tUeXBlKHVubG9ja1R5cGUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHVubG9jayB0eXBlICR7dW5sb2NrVHlwZX1gKTtcbiAgfVxuICBsZXQgdW5sb2NrS2V5ID0gdW5sb2NrQ2FwYWJpbGl0aWVzLnVubG9ja0tleTtcbiAgaWYgKCF1bmxvY2tlci5pc1ZhbGlkS2V5KHVubG9ja1R5cGUsIHVubG9ja0tleSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgdW5sb2NrS2V5ICR7dW5sb2NrS2V5fSBjYXBhYmlsaXR5IGZvciB1bmxvY2tUeXBlICR7dW5sb2NrVHlwZX1gKTtcbiAgfVxuICBjb25zdCB1bmxvY2tNZXRob2QgPSB7XG4gICAgW1BJTl9VTkxPQ0tdOiB1bmxvY2tlci5waW5VbmxvY2ssXG4gICAgW1BBU1NXT1JEX1VOTE9DS106IHVubG9ja2VyLnBhc3N3b3JkVW5sb2NrLFxuICAgIFtQQVRURVJOX1VOTE9DS106IHVubG9ja2VyLnBhdHRlcm5VbmxvY2ssXG4gICAgW0ZJTkdFUlBSSU5UX1VOTE9DS106IHVubG9ja2VyLmZpbmdlcnByaW50VW5sb2NrXG4gIH1bdW5sb2NrVHlwZV07XG4gIGF3YWl0IHVubG9ja01ldGhvZChhZGIsIGRyaXZlciwgdW5sb2NrQ2FwYWJpbGl0aWVzKTtcbn07XG5cbmhlbHBlcnMudW5sb2NrV2l0aEhlbHBlckFwcCA9IGFzeW5jIGZ1bmN0aW9uIHVubG9ja1dpdGhIZWxwZXJBcHAgKGFkYikge1xuICBsb2dnZXIuaW5mbygnVW5sb2NraW5nIHNjcmVlbicpO1xuXG4gIC8vIFVubG9jayBzdWNjZWVkIHdpdGggYSBjb3VwbGUgb2YgcmV0cmllcy5cbiAgbGV0IGZpcnN0UnVuID0gdHJ1ZTtcbiAgYXdhaXQgcmV0cnkoMywgYXN5bmMgZnVuY3Rpb24gbGF1bmNoSGVscGVyICgpIHtcbiAgICAvLyBUbyByZWR1Y2UgYSB0aW1lIHRvIGNhbGwgYWRiLmlzU2NyZWVuTG9ja2VkKCkgc2luY2UgYGFkYiBzaGVsbCBkdW1wc3lzIHdpbmRvd2AgaXMgZWFzeSB0byBoYW5nIGFkYiBjb21tYW5kc1xuICAgIGlmIChmaXJzdFJ1bikge1xuICAgICAgZmlyc3RSdW4gPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCEoYXdhaXQgYWRiLmlzU2NyZWVuTG9ja2VkKCkpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKGBFcnJvciBpbiBpc1NjcmVlbkxvY2tlZDogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgIGxvZ2dlci53YXJuKCdcImFkYiBzaGVsbCBkdW1wc3lzIHdpbmRvd1wiIGNvbW1hbmQgaGFzIHRpbWVkIG91dC4nKTtcbiAgICAgICAgbG9nZ2VyLndhcm4oJ1RoZSByZWFzb24gb2YgdGhpcyB0aW1lb3V0IGlzIHRoZSBkZWxheWVkIGFkYiByZXNwb25zZS4gUmVzZXR0aW5nIGFkYiBzZXJ2ZXIgY2FuIGltcHJvdmUgaXQuJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbG9nZ2VyLmluZm8oYExhdW5jaGluZyAke1NFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFl9YCk7XG4gICAgYXdhaXQgYWRiLnNoZWxsKFtcbiAgICAgICdhbScsICdzdGFydCcsXG4gICAgICAnLW4nLCBgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS8ke1NFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFl9YCxcbiAgICAgICctYycsICdhbmRyb2lkLmludGVudC5jYXRlZ29yeS5MQVVOQ0hFUicsXG4gICAgICAnLWEnLCAnYW5kcm9pZC5pbnRlbnQuYWN0aW9uLk1BSU4nLFxuICAgICAgJy1mJywgJzB4MTAyMDAwMDAnLFxuICAgIF0pO1xuICAgIGF3YWl0IEIuZGVsYXkoMTAwMCk7XG4gIH0pO1xufTtcblxuaGVscGVycy51bmxvY2sgPSBhc3luYyBmdW5jdGlvbiB1bmxvY2sgKGRyaXZlciwgYWRiLCBjYXBhYmlsaXRpZXMpIHtcbiAgaWYgKCEoYXdhaXQgYWRiLmlzU2NyZWVuTG9ja2VkKCkpKSB7XG4gICAgbG9nZ2VyLmluZm8oJ1NjcmVlbiBhbHJlYWR5IHVubG9ja2VkLCBkb2luZyBub3RoaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdTY3JlZW4gaXMgbG9ja2VkLCB0cnlpbmcgdG8gdW5sb2NrJyk7XG4gIGlmIChfLmlzVW5kZWZpbmVkKGNhcGFiaWxpdGllcy51bmxvY2tUeXBlKSkge1xuICAgIGxvZ2dlci53YXJuKCdVc2luZyBhcHAgdW5sb2NrLCB0aGlzIGlzIGdvaW5nIHRvIGJlIGRlcHJlY2F0ZWQhJyk7XG4gICAgYXdhaXQgaGVscGVycy51bmxvY2tXaXRoSGVscGVyQXBwKGFkYik7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgaGVscGVycy51bmxvY2tXaXRoVUlBdXRvbWF0aW9uKGRyaXZlciwgYWRiLCB7dW5sb2NrVHlwZTogY2FwYWJpbGl0aWVzLnVubG9ja1R5cGUsIHVubG9ja0tleTogY2FwYWJpbGl0aWVzLnVubG9ja0tleX0pO1xuICAgIGF3YWl0IGhlbHBlcnMudmVyaWZ5VW5sb2NrKGFkYik7XG4gIH1cbn07XG5cbmhlbHBlcnMudmVyaWZ5VW5sb2NrID0gYXN5bmMgZnVuY3Rpb24gdmVyaWZ5VW5sb2NrIChhZGIpIHtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbCgyLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgaWYgKGF3YWl0IGFkYi5pc1NjcmVlbkxvY2tlZCgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NjcmVlbiBkaWQgbm90IHVubG9jayBzdWNjZXNzZnVsbHksIHJldHJ5aW5nJyk7XG4gICAgfVxuICAgIGxvZ2dlci5kZWJ1ZygnU2NyZWVuIHVubG9ja2VkIHN1Y2Nlc3NmdWxseScpO1xuICB9KTtcbn07XG5cbmhlbHBlcnMuaW5pdERldmljZSA9IGFzeW5jIGZ1bmN0aW9uIGluaXREZXZpY2UgKGFkYiwgb3B0cykge1xuICBpZiAob3B0cy5za2lwRGV2aWNlSW5pdGlhbGl6YXRpb24pIHtcbiAgICBsb2dnZXIuaW5mbyhgJ3NraXBEZXZpY2VJbml0aWFsaXphdGlvbicgaXMgc2V0LiBTa2lwcGluZyBkZXZpY2UgaW5pdGlhbGl6YXRpb24uYCk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgYWRiLndhaXRGb3JEZXZpY2UoKTtcbiAgICAvLyBwdXNoU2V0dGluZ3NBcHAgcmVxdWlyZWQgYmVmb3JlIGNhbGxpbmcgZW5zdXJlRGV2aWNlTG9jYWxlIGZvciBBUEkgTGV2ZWwgMjQrXG5cbiAgICAvLyBTb21lIGZlYXR1cmUgc3VjaCBhcyBsb2NhdGlvbi93aWZpIGFyZSBub3QgbmVjZXNzYXJ5IGZvciBhbGwgdXNlcnMsXG4gICAgLy8gYnV0IHRoZXkgcmVxdWlyZSB0aGUgc2V0dGluZ3MgYXBwLiBTbywgdHJ5IHRvIGNvbmZpZ3VyZSBpdCB3aGlsZSBBcHBpdW1cbiAgICAvLyBkb2VzIG5vdCB0aHJvdyBlcnJvciBldmVuIGlmIHRoZXkgZmFpbC5cbiAgICBjb25zdCBzaG91bGRUaHJvd0Vycm9yID0gb3B0cy5sYW5ndWFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvcHRzLmxvY2FsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvcHRzLmxvY2FsZVNjcmlwdFxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvcHRzLnVuaWNvZGVLZXlib2FyZFxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvcHRzLmRpc2FibGVXaW5kb3dBbmltYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgIW9wdHMuc2tpcFVubG9jaztcbiAgICBhd2FpdCBoZWxwZXJzLnB1c2hTZXR0aW5nc0FwcChhZGIsIHNob3VsZFRocm93RXJyb3IpO1xuICB9XG5cbiAgaWYgKCFvcHRzLmF2ZCkge1xuICAgIGF3YWl0IGhlbHBlcnMuc2V0TW9ja0xvY2F0aW9uQXBwKGFkYiwgU0VUVElOR1NfSEVMUEVSX1BLR19JRCk7XG4gIH1cblxuICBpZiAob3B0cy5sYW5ndWFnZSB8fCBvcHRzLmxvY2FsZSkge1xuICAgIGF3YWl0IGhlbHBlcnMuZW5zdXJlRGV2aWNlTG9jYWxlKGFkYiwgb3B0cy5sYW5ndWFnZSwgb3B0cy5sb2NhbGUsIG9wdHMubG9jYWxlU2NyaXB0KTtcbiAgfVxuXG4gIGlmIChvcHRzLnNraXBMb2djYXRDYXB0dXJlKSB7XG4gICAgbG9nZ2VyLmluZm8oYCdza2lwTG9nY2F0Q2FwdHVyZScgaXMgc2V0LiBTa2lwcGluZyBzdGFydGluZyBsb2djYXQgY2FwdHVyZS5gKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBhZGIuc3RhcnRMb2djYXQoKTtcbiAgfVxuXG4gIGlmIChvcHRzLnVuaWNvZGVLZXlib2FyZCkge1xuICAgIHJldHVybiBhd2FpdCBoZWxwZXJzLmluaXRVbmljb2RlS2V5Ym9hcmQoYWRiKTtcbiAgfVxufTtcblxuaGVscGVycy5yZW1vdmVOdWxsUHJvcGVydGllcyA9IGZ1bmN0aW9uIHJlbW92ZU51bGxQcm9wZXJ0aWVzIChvYmopIHtcbiAgZm9yIChsZXQga2V5IG9mIF8ua2V5cyhvYmopKSB7XG4gICAgaWYgKF8uaXNOdWxsKG9ialtrZXldKSB8fCBfLmlzVW5kZWZpbmVkKG9ialtrZXldKSkge1xuICAgICAgZGVsZXRlIG9ialtrZXldO1xuICAgIH1cbiAgfVxufTtcblxuaGVscGVycy50cnVuY2F0ZURlY2ltYWxzID0gZnVuY3Rpb24gdHJ1bmNhdGVEZWNpbWFscyAobnVtYmVyLCBkaWdpdHMpIHtcbiAgbGV0IG11bHRpcGxpZXIgPSBNYXRoLnBvdygxMCwgZGlnaXRzKSxcbiAgICAgIGFkanVzdGVkTnVtID0gbnVtYmVyICogbXVsdGlwbGllcixcbiAgICAgIHRydW5jYXRlZE51bSA9IE1hdGhbYWRqdXN0ZWROdW0gPCAwID8gJ2NlaWwnIDogJ2Zsb29yJ10oYWRqdXN0ZWROdW0pO1xuXG4gIHJldHVybiB0cnVuY2F0ZWROdW0gLyBtdWx0aXBsaWVyO1xufTtcblxuaGVscGVycy5pc0Nocm9tZUJyb3dzZXIgPSBmdW5jdGlvbiBpc0Nocm9tZUJyb3dzZXIgKGJyb3dzZXIpIHtcbiAgcmV0dXJuIF8uaW5jbHVkZXMoT2JqZWN0LmtleXMoQ0hST01FX0JST1dTRVJfUEFDS0FHRV9BQ1RJVklUWSksIChicm93c2VyIHx8ICcnKS50b0xvd2VyQ2FzZSgpKTtcbn07XG5cbmhlbHBlcnMuZ2V0Q2hyb21lUGtnID0gZnVuY3Rpb24gZ2V0Q2hyb21lUGtnIChicm93c2VyKSB7XG4gIHJldHVybiBDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZW2Jyb3dzZXIudG9Mb3dlckNhc2UoKV0gfHwgQ0hST01FX0JST1dTRVJfUEFDS0FHRV9BQ1RJVklUWS5kZWZhdWx0O1xufTtcblxuaGVscGVycy5yZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMgPSBhc3luYyBmdW5jdGlvbiByZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMgKHNlcnZlciwgc2Vzc2lvbklkKSB7XG4gIGlmICghc2VydmVyIHx8ICFfLmlzRnVuY3Rpb24oc2VydmVyLmdldFdlYlNvY2tldEhhbmRsZXJzKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGFjdGl2ZUhhbmRsZXJzID0gYXdhaXQgc2VydmVyLmdldFdlYlNvY2tldEhhbmRsZXJzKHNlc3Npb25JZCk7XG4gIGZvciAoY29uc3QgcGF0aG5hbWUgb2YgXy5rZXlzKGFjdGl2ZUhhbmRsZXJzKSkge1xuICAgIGF3YWl0IHNlcnZlci5yZW1vdmVXZWJTb2NrZXRIYW5kbGVyKHBhdGhuYW1lKTtcbiAgfVxufTtcblxuLyoqXG4gKiBUYWtlcyBhIGRlc2lyZWQgY2FwYWJpbGl0eSBhbmQgdHJpZXMgdG8gSlNPTi5wYXJzZSBpdCBhcyBhbiBhcnJheSxcbiAqIGFuZCBlaXRoZXIgcmV0dXJucyB0aGUgcGFyc2VkIGFycmF5IG9yIGEgc2luZ2xldG9uIGFycmF5LlxuICpcbiAqIEBwYXJhbSB7YW55fSBjYXAgQSBkZXNpcmVkIGNhcGFiaWxpdHlcbiAqL1xuaGVscGVycy5wYXJzZUFycmF5ID0gZnVuY3Rpb24gcGFyc2VBcnJheSAoY2FwKSB7XG4gIGxldCBwYXJzZWRDYXBzO1xuICB0cnkge1xuICAgIHBhcnNlZENhcHMgPSBKU09OLnBhcnNlKGNhcCk7XG4gIH0gY2F0Y2ggKGlnbikgeyB9XG5cbiAgaWYgKF8uaXNBcnJheShwYXJzZWRDYXBzKSkge1xuICAgIHJldHVybiBwYXJzZWRDYXBzO1xuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoY2FwKSkge1xuICAgIHJldHVybiBbY2FwXTtcbiAgfVxuXG4gIHRocm93IG5ldyBFcnJvcihgbXVzdCBwcm92aWRlIGEgc3RyaW5nIG9yIEpTT04gQXJyYXk7IHJlY2VpdmVkICR7Y2FwfWApO1xufTtcblxuLyoqXG4gKiBWYWxpZGF0ZSBkZXNpcmVkIGNhcGFiaWxpdGllcy4gUmV0dXJucyB0cnVlIGlmIGNhcGFiaWxpdHkgaXMgdmFsaWRcbiAqXG4gKiBAcGFyYW0geyp9IGNhcCBBIGRlc2lyZWQgY2FwYWJpbGl0eVxuICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBjYXBhYmlsaXR5IGlzIHZhbGlkXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNhcHMgaGFzIGludmFsaWQgY2FwYWJpbGl0eVxuICovXG5oZWxwZXJzLnZhbGlkYXRlRGVzaXJlZENhcHMgPSBmdW5jdGlvbiB2YWxpZGF0ZURlc2lyZWRDYXBzIChjYXBzKSB7XG4gIGlmIChjYXBzLmJyb3dzZXJOYW1lKSB7XG4gICAgaWYgKGNhcHMuYXBwKSB7XG4gICAgICAvLyB3YXJuIGlmIHRoZSBjYXBhYmlsaXRpZXMgaGF2ZSBib3RoIGBhcHBgIGFuZCBgYnJvd3NlciwgYWx0aG91Z2ggdGhpcyBpcyBjb21tb24gd2l0aCBzZWxlbml1bSBncmlkXG4gICAgICBsb2dnZXIud2FybihgVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIHNob3VsZCBnZW5lcmFsbHkgbm90IGluY2x1ZGUgYm90aCBhbiAnYXBwJyBhbmQgYSAnYnJvd3Nlck5hbWUnYCk7XG4gICAgfVxuICAgIGlmIChjYXBzLmFwcFBhY2thZ2UpIHtcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGBUaGUgZGVzaXJlZCBzaG91bGQgbm90IGluY2x1ZGUgYm90aCBvZiBhbiAnYXBwUGFja2FnZScgYW5kIGEgJ2Jyb3dzZXJOYW1lJ2ApO1xuICAgIH1cbiAgfVxuXG4gIGlmIChjYXBzLnVuaW5zdGFsbE90aGVyUGFja2FnZXMpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5wYXJzZUFycmF5KGNhcHMudW5pbnN0YWxsT3RoZXJQYWNrYWdlcyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBwYXJzZSBcInVuaW5zdGFsbE90aGVyUGFja2FnZXNcIiBjYXBhYmlsaXR5OiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIGN1cnJlbnQgZGV2aWNlIHVuZGVyIHRlc3QgaXMgYW4gZW11bGF0b3JcbiAqXG4gKiBAcGFyYW0ge0FEQn0gYWRiIC0gYXBwaXVtLWFkYiBpbnN0YW5jZVxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgLSBkcml2ZXIgb3B0aW9ucyBtYXBwaW5nXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSBkZXZpY2UgaXMgYW4gQW5kcm9pZCBlbXVsYXRvclxuICovXG5oZWxwZXJzLmlzRW11bGF0b3IgPSBmdW5jdGlvbiBpc0VtdWxhdG9yIChhZGIsIG9wdHMpIHtcbiAgY29uc3QgcG9zc2libGVOYW1lcyA9IFtvcHRzLnVkaWQsIGFkYj8uY3VyRGV2aWNlSWRdO1xuICByZXR1cm4gISFvcHRzLmF2ZCB8fCBwb3NzaWJsZU5hbWVzLnNvbWUoKHgpID0+IEVNVUxBVE9SX1BBVFRFUk4udGVzdCh4KSk7XG59O1xuXG5oZWxwZXJzLmJvb3RzdHJhcCA9IEJvb3RzdHJhcDtcbmhlbHBlcnMudW5sb2NrZXIgPSB1bmxvY2tlcjtcblxuZXhwb3J0IHsgaGVscGVycywgU0VUVElOR1NfSEVMUEVSX1BLR19JRCB9O1xuZXhwb3J0IGRlZmF1bHQgaGVscGVycztcbiJdLCJmaWxlIjoibGliL2FuZHJvaWQtaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
