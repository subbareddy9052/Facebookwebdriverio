"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseWindows = parseWindows;
exports.parseSurfaceLine = parseSurfaceLine;
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _logger = _interopRequireDefault(require("../logger"));

var _moment = _interopRequireDefault(require("moment"));

var _asyncbox = require("asyncbox");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keys = async function keys(keys) {
  keys = _lodash.default.isArray(keys) ? keys.join('') : keys;
  let params = {
    text: keys,
    replace: false
  };

  if (this.opts.unicodeKeyboard) {
    params.unicodeKeyboard = true;
  }

  await this.doSendKeys(params);
};

commands.doSendKeys = async function doSendKeys(params) {
  return await this.bootstrap.sendAction('setText', params);
};

commands.getDeviceTime = async function getDeviceTime(format = 'YYYY-MM-DDTHH:mm:ssZ') {
  _logger.default.debug('Attempting to capture android device date and time. ' + `The format specifier is '${format}'`);

  const deviceTimestamp = (await this.adb.shell(['date', '+%Y-%m-%dT%T%z'])).trim();

  _logger.default.debug(`Got device timestamp: ${deviceTimestamp}`);

  const parsedTimestamp = _moment.default.utc(deviceTimestamp, 'YYYY-MM-DDTHH:mm:ssZZ');

  if (!parsedTimestamp.isValid()) {
    _logger.default.warn('Cannot parse the returned timestamp. Returning as is');

    return deviceTimestamp;
  }

  return parsedTimestamp.utcOffset(parsedTimestamp._tzm || 0).format(format);
};

commands.getPageSource = async function getPageSource() {
  return await this.bootstrap.sendAction('source');
};

commands.back = async function back() {
  return await this.bootstrap.sendAction('pressBack');
};

commands.isKeyboardShown = async function isKeyboardShown() {
  let keyboardInfo = await this.adb.isSoftKeyboardPresent();
  return keyboardInfo.isKeyboardShown;
};

commands.hideKeyboard = async function hideKeyboard() {
  let {
    isKeyboardShown,
    canCloseKeyboard
  } = await this.adb.isSoftKeyboardPresent();

  if (!isKeyboardShown) {
    _logger.default.info('Keyboard has no UI; no closing necessary');

    return;
  }

  for (const keyCode of [111, 4]) {
    if (canCloseKeyboard) {
      await this.adb.keyevent(keyCode);
    }

    try {
      return await (0, _asyncbox.waitForCondition)(async () => {
        ({
          isKeyboardShown
        } = await this.adb.isSoftKeyboardPresent());
        return !isKeyboardShown;
      }, {
        waitMs: 1000,
        intervalMs: 500
      });
    } catch (ign) {}
  }

  throw new Error(`The software keyboard cannot be closed`);
};

commands.openSettingsActivity = async function openSettingsActivity(setting) {
  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.shell(['am', 'start', '-a', `android.settings.${setting}`]);
  await this.adb.waitForNotActivity(appPackage, appActivity, 5000);
};

commands.getWindowSize = async function getWindowSize() {
  return await this.bootstrap.sendAction('getDeviceSize');
};

commands.getWindowRect = async function getWindowRect() {
  const {
    width,
    height
  } = await this.getWindowSize();
  return {
    width,
    height,
    x: 0,
    y: 0
  };
};

commands.getCurrentActivity = async function getCurrentActivity() {
  return (await this.adb.getFocusedPackageAndActivity()).appActivity;
};

commands.getCurrentPackage = async function getCurrentPackage() {
  return (await this.adb.getFocusedPackageAndActivity()).appPackage;
};

commands.background = async function background(seconds) {
  if (seconds < 0) {
    await this.adb.goToHome();
    return true;
  }

  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.goToHome();
  await _bluebird.default.delay(seconds * 1000);
  let args;

  if (this._cachedActivityArgs && this._cachedActivityArgs[`${appPackage}/${appActivity}`]) {
    args = this._cachedActivityArgs[`${appPackage}/${appActivity}`];
  } else {
    try {
      _logger.default.debug(`Activating app '${appPackage}' in order to restore it`);

      await this.activateApp(appPackage);
      return true;
    } catch (ign) {}

    args = appPackage === this.opts.appPackage && appActivity === this.opts.appActivity || appPackage === this.opts.appWaitPackage && (this.opts.appWaitActivity || '').split(',').includes(appActivity) ? {
      pkg: this.opts.appPackage,
      activity: this.opts.appActivity,
      action: this.opts.intentAction,
      category: this.opts.intentCategory,
      flags: this.opts.intentFlags,
      waitPkg: this.opts.appWaitPackage,
      waitActivity: this.opts.appWaitActivity,
      waitForLaunch: this.opts.appWaitForLaunch,
      waitDuration: this.opts.appWaitDuration,
      optionalIntentArguments: this.opts.optionalIntentArguments,
      stopApp: false,
      user: this.opts.userProfile
    } : {
      pkg: appPackage,
      activity: appActivity,
      waitPkg: appPackage,
      waitActivity: appActivity,
      stopApp: false
    };
  }

  args = await _appiumSupport.util.filterObject(args);

  _logger.default.debug(`Bringing application back to foreground with arguments: ${JSON.stringify(args)}`);

  return await this.adb.startApp(args);
};

commands.getStrings = async function getStrings(language) {
  if (!language) {
    language = await this.adb.getDeviceLanguage();

    _logger.default.info(`No language specified, returning strings for: ${language}`);
  }

  const preprocessStringsMap = mapping => {
    const result = {};

    for (const [key, value] of _lodash.default.toPairs(mapping)) {
      result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
    }

    return result;
  };

  if (this.apkStrings[language]) {
    return preprocessStringsMap(this.apkStrings[language]);
  }

  this.apkStrings[language] = await _androidHelpers.default.pushStrings(language, this.adb, this.opts);

  if (this.bootstrap) {
    await this.bootstrap.sendAction('updateStrings');
  }

  return preprocessStringsMap(this.apkStrings[language]);
};

commands.launchApp = async function launchApp() {
  await this.initAUT();
  await this.startAUT();
};

commands.startActivity = async function startActivity(appPackage, appActivity, appWaitPackage, appWaitActivity, intentAction, intentCategory, intentFlags, optionalIntentArguments, dontStopAppOnReset) {
  _logger.default.debug(`Starting package '${appPackage}' and activity '${appActivity}'`);

  if (!_appiumSupport.util.hasValue(dontStopAppOnReset)) {
    dontStopAppOnReset = !!this.opts.dontStopAppOnReset;
  }

  let args = {
    pkg: appPackage,
    activity: appActivity,
    waitPkg: appWaitPackage || appPackage,
    waitActivity: appWaitActivity || appActivity,
    action: intentAction,
    category: intentCategory,
    flags: intentFlags,
    optionalIntentArguments,
    stopApp: !dontStopAppOnReset
  };
  this._cachedActivityArgs = this._cachedActivityArgs || {};
  this._cachedActivityArgs[`${args.waitPkg}/${args.waitActivity}`] = args;
  await this.adb.startApp(args);
};

commands.reset = async function reset() {
  await _androidHelpers.default.resetApp(this.adb, Object.assign({}, this.opts, {
    fastReset: true
  }));
  await this.setContext();
  return (await this.isChromeSession) ? this.startChromeSession() : this.startAUT();
};

commands.startAUT = async function startAUT() {
  await this.adb.startApp({
    pkg: this.opts.appPackage,
    activity: this.opts.appActivity,
    action: this.opts.intentAction,
    category: this.opts.intentCategory,
    flags: this.opts.intentFlags,
    waitPkg: this.opts.appWaitPackage,
    waitActivity: this.opts.appWaitActivity,
    waitForLaunch: this.opts.appWaitForLaunch,
    waitDuration: this.opts.appWaitDuration,
    optionalIntentArguments: this.opts.optionalIntentArguments,
    stopApp: !this.opts.dontStopAppOnReset,
    user: this.opts.userProfile
  });
};

commands.setUrl = async function setUrl(uri) {
  await this.adb.startUri(uri, this.opts.appPackage);
};

commands.closeApp = async function closeApp() {
  await this.adb.forceStop(this.opts.appPackage);
  await this.setContext();
};

commands.getDisplayDensity = async function getDisplayDensity() {
  let out = await this.adb.shell(['getprop', 'ro.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  out = await this.adb.shell(['getprop', 'qemu.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  _logger.default.errorAndThrow('Failed to get display density property.');
};

function parseSurfaceLine(line) {
  let bounds = line.split('rect=')[1].replace(/[(), x]+/g, ' ').trim().split(' ');
  return {
    visible: line.indexOf('shown=true') !== -1,
    x: parseFloat(bounds[0]),
    y: parseFloat(bounds[1]),
    width: parseFloat(bounds[2]),
    height: parseFloat(bounds[3])
  };
}

function parseWindows(lines) {
  let atStatusBar = false;
  let atNavBar = false;
  let statusBar;
  let navigationBar;
  lines.split('\n').forEach(line => {
    if (line.indexOf('  Window #') !== -1) {
      atStatusBar = line.indexOf('StatusBar') !== -1;
      atNavBar = line.indexOf('NavigationBar') !== -1;
      return;
    }

    if (line.indexOf('      Surface:') === -1) {
      return;
    }

    if (atStatusBar) {
      statusBar = parseSurfaceLine(line);
      atStatusBar = false;
    } else if (atNavBar) {
      navigationBar = parseSurfaceLine(line);
      atNavBar = false;
    }
  });

  if (!statusBar) {
    _logger.default.errorAndThrow('Failed to parse status bar information.');
  }

  if (!navigationBar) {
    _logger.default.errorAndThrow('Failed to parse navigation bar information.');
  }

  return {
    statusBar,
    navigationBar
  };
}

commands.getSystemBars = async function getSystemBars() {
  let out = await this.adb.shell(['dumpsys', 'window', 'windows']);

  if (!out) {
    _logger.default.errorAndThrow('Did not get window manager output.');
  }

  return parseWindows(out);
};

commands.mobilePerformEditorAction = async function mobilePerformEditorAction(opts = {}) {
  const {
    action
  } = opts;

  if (!_appiumSupport.util.hasValue(action)) {
    _logger.default.errorAndThrow(`'action' argument is required`);
  }

  await this.adb.performEditorAction(action);
};

const PERMISSION_ACTION = {
  GRANT: 'grant',
  REVOKE: 'revoke'
};

commands.mobileChangePermissions = async function mobileChangePermissions(opts = {}) {
  const {
    permissions,
    appPackage = this.opts.appPackage,
    action = PERMISSION_ACTION.GRANT
  } = opts;

  if (!_appiumSupport.util.hasValue(permissions)) {
    _logger.default.errorAndThrow(`'permissions' argument is required`);
  }

  let actionFunc;

  switch (_lodash.default.toLower(action)) {
    case PERMISSION_ACTION.GRANT:
      actionFunc = (appPackage, permission) => this.adb.grantPermission(appPackage, permission);

      break;

    case PERMISSION_ACTION.REVOKE:
      actionFunc = (appPackage, permission) => this.adb.revokePermission(appPackage, permission);

      break;

    default:
      _logger.default.errorAndThrow(`Unknown action '${action}'. ` + `Only ${JSON.stringify(_lodash.default.values(PERMISSION_ACTION))} actions are supported`);

      break;
  }

  for (const permission of _lodash.default.isArray(permissions) ? permissions : [permissions]) {
    await actionFunc(appPackage, permission);
  }
};

const PERMISSIONS_TYPE = {
  DENIED: 'denied',
  GRANTED: 'granted',
  REQUESTED: 'requested'
};

commands.mobileGetPermissions = async function mobileGetPermissions(opts = {}) {
  const {
    type = PERMISSIONS_TYPE.REQUESTED,
    appPackage = this.opts.appPackage
  } = opts;
  let actionFunc;

  switch (_lodash.default.toLower(type)) {
    case PERMISSIONS_TYPE.REQUESTED:
      actionFunc = appPackage => this.adb.getReqPermissions(appPackage);

      break;

    case PERMISSIONS_TYPE.GRANTED:
      actionFunc = appPackage => this.adb.getGrantedPermissions(appPackage);

      break;

    case PERMISSIONS_TYPE.DENIED:
      actionFunc = appPackage => this.adb.getDeniedPermissions(appPackage);

      break;

    default:
      _logger.default.errorAndThrow(`Unknown permissions type '${type}'. ` + `Only ${JSON.stringify(_lodash.default.values(PERMISSIONS_TYPE))} types are supported`);

      break;
  }

  return await actionFunc(appPackage);
};

commands.mobileGetNotifications = async function mobileGetNotifications() {
  return await this.adb.getNotifications();
};

commands.mobileListSms = async function mobileListSms(opts = {}) {
  return await this.adb.getSmsList(opts);
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZW5lcmFsLmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJrZXlzIiwiXyIsImlzQXJyYXkiLCJqb2luIiwicGFyYW1zIiwidGV4dCIsInJlcGxhY2UiLCJvcHRzIiwidW5pY29kZUtleWJvYXJkIiwiZG9TZW5kS2V5cyIsImJvb3RzdHJhcCIsInNlbmRBY3Rpb24iLCJnZXREZXZpY2VUaW1lIiwiZm9ybWF0IiwibG9nIiwiZGVidWciLCJkZXZpY2VUaW1lc3RhbXAiLCJhZGIiLCJzaGVsbCIsInRyaW0iLCJwYXJzZWRUaW1lc3RhbXAiLCJtb21lbnQiLCJ1dGMiLCJpc1ZhbGlkIiwid2FybiIsInV0Y09mZnNldCIsIl90em0iLCJnZXRQYWdlU291cmNlIiwiYmFjayIsImlzS2V5Ym9hcmRTaG93biIsImtleWJvYXJkSW5mbyIsImlzU29mdEtleWJvYXJkUHJlc2VudCIsImhpZGVLZXlib2FyZCIsImNhbkNsb3NlS2V5Ym9hcmQiLCJpbmZvIiwia2V5Q29kZSIsImtleWV2ZW50Iiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImlnbiIsIkVycm9yIiwib3BlblNldHRpbmdzQWN0aXZpdHkiLCJzZXR0aW5nIiwiYXBwUGFja2FnZSIsImFwcEFjdGl2aXR5IiwiZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSIsIndhaXRGb3JOb3RBY3Rpdml0eSIsImdldFdpbmRvd1NpemUiLCJnZXRXaW5kb3dSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJ4IiwieSIsImdldEN1cnJlbnRBY3Rpdml0eSIsImdldEN1cnJlbnRQYWNrYWdlIiwiYmFja2dyb3VuZCIsInNlY29uZHMiLCJnb1RvSG9tZSIsIkIiLCJkZWxheSIsImFyZ3MiLCJfY2FjaGVkQWN0aXZpdHlBcmdzIiwiYWN0aXZhdGVBcHAiLCJhcHBXYWl0UGFja2FnZSIsImFwcFdhaXRBY3Rpdml0eSIsInNwbGl0IiwiaW5jbHVkZXMiLCJwa2ciLCJhY3Rpdml0eSIsImFjdGlvbiIsImludGVudEFjdGlvbiIsImNhdGVnb3J5IiwiaW50ZW50Q2F0ZWdvcnkiLCJmbGFncyIsImludGVudEZsYWdzIiwid2FpdFBrZyIsIndhaXRBY3Rpdml0eSIsIndhaXRGb3JMYXVuY2giLCJhcHBXYWl0Rm9yTGF1bmNoIiwid2FpdER1cmF0aW9uIiwiYXBwV2FpdER1cmF0aW9uIiwib3B0aW9uYWxJbnRlbnRBcmd1bWVudHMiLCJzdG9wQXBwIiwidXNlciIsInVzZXJQcm9maWxlIiwidXRpbCIsImZpbHRlck9iamVjdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGFydEFwcCIsImdldFN0cmluZ3MiLCJsYW5ndWFnZSIsImdldERldmljZUxhbmd1YWdlIiwicHJlcHJvY2Vzc1N0cmluZ3NNYXAiLCJtYXBwaW5nIiwicmVzdWx0Iiwia2V5IiwidmFsdWUiLCJ0b1BhaXJzIiwiaXNTdHJpbmciLCJhcGtTdHJpbmdzIiwiYW5kcm9pZEhlbHBlcnMiLCJwdXNoU3RyaW5ncyIsImxhdW5jaEFwcCIsImluaXRBVVQiLCJzdGFydEFVVCIsInN0YXJ0QWN0aXZpdHkiLCJkb250U3RvcEFwcE9uUmVzZXQiLCJoYXNWYWx1ZSIsInJlc2V0IiwicmVzZXRBcHAiLCJPYmplY3QiLCJhc3NpZ24iLCJmYXN0UmVzZXQiLCJzZXRDb250ZXh0IiwiaXNDaHJvbWVTZXNzaW9uIiwic3RhcnRDaHJvbWVTZXNzaW9uIiwic2V0VXJsIiwidXJpIiwic3RhcnRVcmkiLCJjbG9zZUFwcCIsImZvcmNlU3RvcCIsImdldERpc3BsYXlEZW5zaXR5Iiwib3V0IiwidmFsIiwicGFyc2VJbnQiLCJpc05hTiIsImVycm9yQW5kVGhyb3ciLCJwYXJzZVN1cmZhY2VMaW5lIiwibGluZSIsImJvdW5kcyIsInZpc2libGUiLCJpbmRleE9mIiwicGFyc2VGbG9hdCIsInBhcnNlV2luZG93cyIsImxpbmVzIiwiYXRTdGF0dXNCYXIiLCJhdE5hdkJhciIsInN0YXR1c0JhciIsIm5hdmlnYXRpb25CYXIiLCJmb3JFYWNoIiwiZ2V0U3lzdGVtQmFycyIsIm1vYmlsZVBlcmZvcm1FZGl0b3JBY3Rpb24iLCJwZXJmb3JtRWRpdG9yQWN0aW9uIiwiUEVSTUlTU0lPTl9BQ1RJT04iLCJHUkFOVCIsIlJFVk9LRSIsIm1vYmlsZUNoYW5nZVBlcm1pc3Npb25zIiwicGVybWlzc2lvbnMiLCJhY3Rpb25GdW5jIiwidG9Mb3dlciIsInBlcm1pc3Npb24iLCJncmFudFBlcm1pc3Npb24iLCJyZXZva2VQZXJtaXNzaW9uIiwidmFsdWVzIiwiUEVSTUlTU0lPTlNfVFlQRSIsIkRFTklFRCIsIkdSQU5URUQiLCJSRVFVRVNURUQiLCJtb2JpbGVHZXRQZXJtaXNzaW9ucyIsInR5cGUiLCJnZXRSZXFQZXJtaXNzaW9ucyIsImdldEdyYW50ZWRQZXJtaXNzaW9ucyIsImdldERlbmllZFBlcm1pc3Npb25zIiwibW9iaWxlR2V0Tm90aWZpY2F0aW9ucyIsImdldE5vdGlmaWNhdGlvbnMiLCJtb2JpbGVMaXN0U21zIiwiZ2V0U21zTGlzdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLFFBQVEsR0FBRyxFQUFmO0FBQUEsSUFBbUJDLE9BQU8sR0FBRyxFQUE3QjtBQUFBLElBQWlDQyxVQUFVLEdBQUcsRUFBOUM7Ozs7QUFFQUYsUUFBUSxDQUFDRyxJQUFULEdBQWdCLGVBQWVBLElBQWYsQ0FBcUJBLElBQXJCLEVBQTJCO0FBRXpDQSxFQUFBQSxJQUFJLEdBQUdDLGdCQUFFQyxPQUFGLENBQVVGLElBQVYsSUFBa0JBLElBQUksQ0FBQ0csSUFBTCxDQUFVLEVBQVYsQ0FBbEIsR0FBa0NILElBQXpDO0FBQ0EsTUFBSUksTUFBTSxHQUFHO0FBQ1hDLElBQUFBLElBQUksRUFBRUwsSUFESztBQUVYTSxJQUFBQSxPQUFPLEVBQUU7QUFGRSxHQUFiOztBQUlBLE1BQUksS0FBS0MsSUFBTCxDQUFVQyxlQUFkLEVBQStCO0FBQzdCSixJQUFBQSxNQUFNLENBQUNJLGVB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QUFBLFVBQVUsR0FBSTFHLFVBQUQsSUFBZ0IsS0FBSzFCLEdBQUwsQ0FBU2dKLGlCQUFULENBQTJCdEgsVUFBM0IsQ0FBN0I7O0FBQ0E7O0FBQ0YsU0FBS2dILGdCQUFnQixDQUFDRSxPQUF0QjtBQUNFUixNQUFBQSxVQUFVLEdBQUkxRyxVQUFELElBQWdCLEtBQUsxQixHQUFMLENBQVNpSixxQkFBVCxDQUErQnZILFVBQS9CLENBQTdCOztBQUNBOztBQUNGLFNBQUtnSCxnQkFBZ0IsQ0FBQ0MsTUFBdEI7QUFDRVAsTUFBQUEsVUFBVSxHQUFJMUcsVUFBRCxJQUFnQixLQUFLMUIsR0FBTCxDQUFTa0osb0JBQVQsQ0FBOEJ4SCxVQUE5QixDQUE3Qjs7QUFDQTs7QUFDRjtBQUNFN0Isc0JBQUlpSCxhQUFKLENBQW1CLDZCQUE0QmlDLElBQUssS0FBbEMsR0FDZixRQUFPekUsSUFBSSxDQUFDQyxTQUFMLENBQWV2RixnQkFBRXlKLE1BQUYsQ0FBU0MsZ0JBQVQsQ0FBZixDQUEyQyxzQkFEckQ7O0FBRUE7QUFiSjs7QUFlQSxTQUFPLE1BQU1OLFVBQVUsQ0FBQzFHLFVBQUQsQ0FBdkI7QUFDRCxDQXZCRDs7QUErQkE5QyxRQUFRLENBQUN1SyxzQkFBVCxHQUFrQyxlQUFlQSxzQkFBZixHQUF5QztBQUN6RSxTQUFPLE1BQU0sS0FBS25KLEdBQUwsQ0FBU29KLGdCQUFULEVBQWI7QUFDRCxDQUZEOztBQWlCQXhLLFFBQVEsQ0FBQ3lLLGFBQVQsR0FBeUIsZUFBZUEsYUFBZixDQUE4Qi9KLElBQUksR0FBRyxFQUFyQyxFQUF5QztBQUNoRSxTQUFPLE1BQU0sS0FBS1UsR0FBTCxDQUFTc0osVUFBVCxDQUFvQmhLLElBQXBCLENBQWI7QUFDRCxDQUZEOztBQUtBd0csTUFBTSxDQUFDQyxNQUFQLENBQWNqSCxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgYW5kcm9pZEhlbHBlcnMgZnJvbSAnLi4vYW5kcm9pZC1oZWxwZXJzJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmtleXMgPSBhc3luYyBmdW5jdGlvbiBrZXlzIChrZXlzKSB7XG4gIC8vIFByb3RvY29sIHNlbmRzIGFuIGFycmF5OyByZXRoaW5rIGFwcHJvYWNoXG4gIGtleXMgPSBfLmlzQXJyYXkoa2V5cykgPyBrZXlzLmpvaW4oJycpIDoga2V5cztcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICB0ZXh0OiBrZXlzLFxuICAgIHJlcGxhY2U6IGZhbHNlXG4gIH07XG4gIGlmICh0aGlzLm9wdHMudW5pY29kZUtleWJvYXJkKSB7XG4gICAgcGFyYW1zLnVuaWNvZGVLZXlib2FyZCA9IHRydWU7XG4gIH1cbiAgYXdhaXQgdGhpcy5kb1NlbmRLZXlzKHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy5kb1NlbmRLZXlzID0gYXN5bmMgZnVuY3Rpb24gZG9TZW5kS2V5cyAocGFyYW1zKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdzZXRUZXh0JywgcGFyYW1zKTtcbn07XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IGRldmljZSdzIHRpbWVzdGFtcC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZm9ybWF0IC0gVGhlIHNldCBvZiBmb3JtYXQgc3BlY2lmaWVycy4gUmVhZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBzOi8vbW9tZW50anMuY29tL2RvY3MvIHRvIGdldCB0aGUgZnVsbCBsaXN0IG9mIHN1cHBvcnRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGV0aW1lIGZvcm1hdCBzcGVjaWZpZXJzLiBUaGUgZGVmYXVsdCBmb3JtYXQgaXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBgWVlZWS1NTS1ERFRISDptbTpzc1pgLCB3aGljaCBjb21wbGllcyB0byBJU08tODYwMVxuICogQHJldHVybnMgRm9ybWF0dGVkIGRhdGV0aW1lIHN0cmluZyBvciB0aGUgcmF3IGNvbW1hbmQgb3V0cHV0IGlmIGZvcm1hdHRpbmcgZmFpbHNcbiAqL1xuY29tbWFuZHMuZ2V0RGV2aWNlVGltZSA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZVRpbWUgKGZvcm1hdCA9ICdZWVlZLU1NLUREVEhIOm1tOnNzWicpIHtcbiAgbG9nLmRlYnVnKCdBdHRlbXB0aW5nIHRvIGNhcHR1cmUgYW5kcm9pZCBkZXZpY2UgZGF0ZSBhbmQgdGltZS4gJyArXG4gICAgYFRoZSBmb3JtYXQgc3BlY2lmaWVyIGlzICcke2Zvcm1hdH0nYCk7XG4gIGNvbnN0IGRldmljZVRpbWVzdGFtcCA9IChhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2RhdGUnLCAnKyVZLSVtLSVkVCVUJXonXSkpLnRyaW0oKTtcbiAgbG9nLmRlYnVnKGBHb3QgZGV2aWNlIHRpbWVzdGFtcDogJHtkZXZpY2VUaW1lc3RhbXB9YCk7XG4gIGNvbnN0IHBhcnNlZFRpbWVzdGFtcCA9IG1vbWVudC51dGMoZGV2aWNlVGltZXN0YW1wLCAnWVlZWS1NTS1ERFRISDptbTpzc1paJyk7XG4gIGlmICghcGFyc2VkVGltZXN0YW1wLmlzVmFsaWQoKSkge1xuICAgIGxvZy53YXJuKCdDYW5ub3QgcGFyc2UgdGhlIHJldHVybmVkIHRpbWVzdGFtcC4gUmV0dXJuaW5nIGFzIGlzJyk7XG4gICAgcmV0dXJuIGRldmljZVRpbWVzdGFtcDtcbiAgfVxuICByZXR1cm4gcGFyc2VkVGltZXN0YW1wLnV0Y09mZnNldChwYXJzZWRUaW1lc3RhbXAuX3R6bSB8fCAwKS5mb3JtYXQoZm9ybWF0KTtcbn07XG5cbmNvbW1hbmRzLmdldFBhZ2VTb3VyY2UgPSBhc3luYyBmdW5jdGlvbiBnZXRQYWdlU291cmNlICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3NvdXJjZScpO1xufTtcblxuY29tbWFuZHMuYmFjayA9IGFzeW5jIGZ1bmN0aW9uIGJhY2sgKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbigncHJlc3NCYWNrJyk7XG59O1xuXG5jb21tYW5kcy5pc0tleWJvYXJkU2hvd24gPSBhc3luYyBmdW5jdGlvbiBpc0tleWJvYXJkU2hvd24gKCkge1xuICBsZXQga2V5Ym9hcmRJbmZvID0gYXdhaXQgdGhpcy5hZGIuaXNTb2Z0S2V5Ym9hcmRQcmVzZW50KCk7XG4gIHJldHVybiBrZXlib2FyZEluZm8uaXNLZXlib2FyZFNob3duO1xufTtcblxuY29tbWFuZHMuaGlkZUtleWJvYXJkID0gYXN5bmMgZnVuY3Rpb24gaGlkZUtleWJvYXJkICgpIHtcbiAgbGV0IHtpc0tleWJvYXJkU2hvd24sIGNhbkNsb3NlS2V5Ym9hcmR9ID0gYXdhaXQgdGhpcy5hZGIuaXNTb2Z0S2V5Ym9hcmRQcmVzZW50KCk7XG4gIGlmICghaXNLZXlib2FyZFNob3duKSB7XG4gICAgbG9nLmluZm8oJ0tleWJvYXJkIGhhcyBubyBVSTsgbm8gY2xvc2luZyBuZWNlc3NhcnknKTtcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gVHJ5IEVTQyB0aGVuIEJBQ0sgaWYgdGhlIGZpcnN0IG9uZSBmYWlsc1xuICBmb3IgKGNvbnN0IGtleUNvZGUgb2YgWzExMSwgNF0pIHtcbiAgICBpZiAoY2FuQ2xvc2VLZXlib2FyZCkge1xuICAgICAgYXdhaXQgdGhpcy5hZGIua2V5ZXZlbnQoa2V5Q29kZSk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICAgICh7aXNLZXlib2FyZFNob3dufSA9IGF3YWl0IHRoaXMuYWRiLmlzU29mdEtleWJvYXJkUHJlc2VudCgpKTtcbiAgICAgICAgcmV0dXJuICFpc0tleWJvYXJkU2hvd247XG4gICAgICB9LCB7d2FpdE1zOiAxMDAwLCBpbnRlcnZhbE1zOiA1MDB9KTtcbiAgICB9IGNhdGNoIChpZ24pIHt9XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKGBUaGUgc29mdHdhcmUga2V5Ym9hcmQgY2Fubm90IGJlIGNsb3NlZGApO1xufTtcblxuY29tbWFuZHMub3BlblNldHRpbmdzQWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiBvcGVuU2V0dGluZ3NBY3Rpdml0eSAoc2V0dGluZykge1xuICBsZXQge2FwcFBhY2thZ2UsIGFwcEFjdGl2aXR5fSA9IGF3YWl0IHRoaXMuYWRiLmdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkoKTtcbiAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydhbScsICdzdGFydCcsICctYScsIGBhbmRyb2lkLnNldHRpbmdzLiR7c2V0dGluZ31gXSk7XG4gIGF3YWl0IHRoaXMuYWRiLndhaXRGb3JOb3RBY3Rpdml0eShhcHBQYWNrYWdlLCBhcHBBY3Rpdml0eSwgNTAwMCk7XG59O1xuXG5jb21tYW5kcy5nZXRXaW5kb3dTaXplID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93U2l6ZSAoKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdnZXREZXZpY2VTaXplJyk7XG59O1xuXG4vLyBGb3IgVzNDXG5jb21tYW5kcy5nZXRXaW5kb3dSZWN0ID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93UmVjdCAoKSB7XG4gIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gYXdhaXQgdGhpcy5nZXRXaW5kb3dTaXplKCk7XG4gIHJldHVybiB7XG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0LFxuICAgIHg6IDAsXG4gICAgeTogMFxuICB9O1xufTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudEFjdGl2aXR5ICgpIHtcbiAgcmV0dXJuIChhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCkpLmFwcEFjdGl2aXR5O1xufTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudFBhY2thZ2UgPSBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50UGFja2FnZSAoKSB7XG4gIHJldHVybiAoYXdhaXQgdGhpcy5hZGIuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpKS5hcHBQYWNrYWdlO1xufTtcblxuY29tbWFuZHMuYmFja2dyb3VuZCA9IGFzeW5jIGZ1bmN0aW9uIGJhY2tncm91bmQgKHNlY29uZHMpIHtcbiAgaWYgKHNlY29uZHMgPCAwKSB7XG4gICAgLy8gaWYgdXNlciBwYXNzZXMgaW4gYSBuZWdhdGl2ZSBzZWNvbmRzIHZhbHVlLCBpbnRlcnByZXQgdGhhdCBhcyB0aGUgaW5zdHJ1Y3Rpb25cbiAgICAvLyB0byBub3QgYnJpbmcgdGhlIGFwcCBiYWNrIGF0IGFsbFxuICAgIGF3YWl0IHRoaXMuYWRiLmdvVG9Ib21lKCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgbGV0IHthcHBQYWNrYWdlLCBhcHBBY3Rpdml0eX0gPSBhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gIGF3YWl0IHRoaXMuYWRiLmdvVG9Ib21lKCk7XG4gIGF3YWl0IEIuZGVsYXkoc2Vjb25kcyAqIDEwMDApO1xuXG4gIGxldCBhcmdzO1xuICBpZiAodGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzICYmIHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJnc1tgJHthcHBQYWNrYWdlfS8ke2FwcEFjdGl2aXR5fWBdKSB7XG4gICAgLy8gdGhlIGFjdGl2aXR5IHdhcyBzdGFydGVkIHdpdGggYHN0YXJ0QWN0aXZpdHlgLCBzbyB1c2UgdGhvc2UgYXJncyB0byByZXN0YXJ0XG4gICAgYXJncyA9IHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJnc1tgJHthcHBQYWNrYWdlfS8ke2FwcEFjdGl2aXR5fWBdO1xuICB9IGVsc2Uge1xuICAgIHRyeSB7XG4gICAgICBsb2cuZGVidWcoYEFjdGl2YXRpbmcgYXBwICcke2FwcFBhY2thZ2V9JyBpbiBvcmRlciB0byByZXN0b3JlIGl0YCk7XG4gICAgICBhd2FpdCB0aGlzLmFjdGl2YXRlQXBwKGFwcFBhY2thZ2UpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIGFyZ3MgPSAoKGFwcFBhY2thZ2UgPT09IHRoaXMub3B0cy5hcHBQYWNrYWdlICYmIGFwcEFjdGl2aXR5ID09PSB0aGlzLm9wdHMuYXBwQWN0aXZpdHkpIHx8XG4gICAgICAgICAgICAoYXBwUGFja2FnZSA9PT0gdGhpcy5vcHRzLmFwcFdhaXRQYWNrYWdlICYmICh0aGlzLm9wdHMuYXBwV2FpdEFjdGl2aXR5IHx8ICcnKS5zcGxpdCgnLCcpLmluY2x1ZGVzKGFwcEFjdGl2aXR5KSkpXG4gICAgICA/IHsvLyB0aGUgYWN0aXZpdHkgaXMgdGhlIG9yaWdpbmFsIHNlc3Npb24gYWN0aXZpdHksIHNvIHVzZSB0aGUgb3JpZ2luYWwgYXJnc1xuICAgICAgICBwa2c6IHRoaXMub3B0cy5hcHBQYWNrYWdlLFxuICAgICAgICBhY3Rpdml0eTogdGhpcy5vcHRzLmFwcEFjdGl2aXR5LFxuICAgICAgICBhY3Rpb246IHRoaXMub3B0cy5pbnRlbnRBY3Rpb24sXG4gICAgICAgIGNhdGVnb3J5OiB0aGlzLm9wdHMuaW50ZW50Q2F0ZWdvcnksXG4gICAgICAgIGZsYWdzOiB0aGlzLm9wdHMuaW50ZW50RmxhZ3MsXG4gICAgICAgIHdhaXRQa2c6IHRoaXMub3B0cy5hcHBXYWl0UGFja2FnZSxcbiAgICAgICAgd2FpdEFjdGl2aXR5OiB0aGlzLm9wdHMuYXBwV2FpdEFjdGl2aXR5LFxuICAgICAgICB3YWl0Rm9yTGF1bmNoOiB0aGlzLm9wdHMuYXBwV2FpdEZvckxhdW5jaCxcbiAgICAgICAgd2FpdER1cmF0aW9uOiB0aGlzLm9wdHMuYXBwV2FpdER1cmF0aW9uLFxuICAgICAgICBvcHRpb25hbEludGVudEFyZ3VtZW50czogdGhpcy5vcHRzLm9wdGlvbmFsSW50ZW50QXJndW1lbnRzLFxuICAgICAgICBzdG9wQXBwOiBmYWxzZSxcbiAgICAgICAgdXNlcjogdGhpcy5vcHRzLnVzZXJQcm9maWxlfVxuICAgICAgOiB7Ly8gdGhlIGFjdGl2aXR5IHdhcyBzdGFydGVkIHNvbWUgb3RoZXIgd2F5LCBzbyB1c2UgZGVmYXVsdHNcbiAgICAgICAgcGtnOiBhcHBQYWNrYWdlLFxuICAgICAgICBhY3Rpdml0eTogYXBwQWN0aXZpdHksXG4gICAgICAgIHdhaXRQa2c6IGFwcFBhY2thZ2UsXG4gICAgICAgIHdhaXRBY3Rpdml0eTogYXBwQWN0aXZpdHksXG4gICAgICAgIHN0b3BBcHA6IGZhbHNlfTtcbiAgfVxuICBhcmdzID0gYXdhaXQgdXRpbC5maWx0ZXJPYmplY3QoYXJncyk7XG4gIGxvZy5kZWJ1ZyhgQnJpbmdpbmcgYXBwbGljYXRpb24gYmFjayB0byBmb3JlZ3JvdW5kIHdpdGggYXJndW1lbnRzOiAke0pTT04uc3RyaW5naWZ5KGFyZ3MpfWApO1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuc3RhcnRBcHAoYXJncyk7XG59O1xuXG5jb21tYW5kcy5nZXRTdHJpbmdzID0gYXN5bmMgZnVuY3Rpb24gZ2V0U3RyaW5ncyAobGFuZ3VhZ2UpIHtcbiAgaWYgKCFsYW5ndWFnZSkge1xuICAgIGxhbmd1YWdlID0gYXdhaXQgdGhpcy5hZGIuZ2V0RGV2aWNlTGFuZ3VhZ2UoKTtcbiAgICBsb2cuaW5mbyhgTm8gbGFuZ3VhZ2Ugc3BlY2lmaWVkLCByZXR1cm5pbmcgc3RyaW5ncyBmb3I6ICR7bGFuZ3VhZ2V9YCk7XG4gIH1cblxuICAvLyBDbGllbnRzIHJlcXVpcmUgdGhlIHJlc3VsdGluZyBtYXBwaW5nIHRvIGhhdmUgYm90aCBrZXlzXG4gIC8vIGFuZCB2YWx1ZXMgb2YgdHlwZSBzdHJpbmdcbiAgY29uc3QgcHJlcHJvY2Vzc1N0cmluZ3NNYXAgPSAobWFwcGluZykgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIF8udG9QYWlycyhtYXBwaW5nKSkge1xuICAgICAgcmVzdWx0W2tleV0gPSBfLmlzU3RyaW5nKHZhbHVlKSA/IHZhbHVlIDogSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGlmICh0aGlzLmFwa1N0cmluZ3NbbGFuZ3VhZ2VdKSB7XG4gICAgLy8gUmV0dXJuIGNhY2hlZCBzdHJpbmdzXG4gICAgcmV0dXJuIHByZXByb2Nlc3NTdHJpbmdzTWFwKHRoaXMuYXBrU3RyaW5nc1tsYW5ndWFnZV0pO1xuICB9XG5cbiAgdGhpcy5hcGtTdHJpbmdzW2xhbmd1YWdlXSA9IGF3YWl0IGFuZHJvaWRIZWxwZXJzLnB1c2hTdHJpbmdzKGxhbmd1YWdlLCB0aGlzLmFkYiwgdGhpcy5vcHRzKTtcbiAgaWYgKHRoaXMuYm9vdHN0cmFwKSB7XG4gICAgLy8gVE9ETzogVGhpcyBpcyBtdXRhdGluZyB0aGUgY3VycmVudCBsYW5ndWFnZSwgYnV0IGl0J3MgaG93IGFwcGl1bSBjdXJyZW50bHkgd29ya3NcbiAgICBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCd1cGRhdGVTdHJpbmdzJyk7XG4gIH1cblxuICByZXR1cm4gcHJlcHJvY2Vzc1N0cmluZ3NNYXAodGhpcy5hcGtTdHJpbmdzW2xhbmd1YWdlXSk7XG59O1xuXG5jb21tYW5kcy5sYXVuY2hBcHAgPSBhc3luYyBmdW5jdGlvbiBsYXVuY2hBcHAgKCkge1xuICBhd2FpdCB0aGlzLmluaXRBVVQoKTtcbiAgYXdhaXQgdGhpcy5zdGFydEFVVCgpO1xufTtcblxuY29tbWFuZHMuc3RhcnRBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0QWN0aXZpdHkgKGFwcFBhY2thZ2UsIGFwcEFjdGl2aXR5LFxuICBhcHBXYWl0UGFja2FnZSwgYXBwV2FpdEFjdGl2aXR5LCBpbnRlbnRBY3Rpb24sIGludGVudENhdGVnb3J5LCBpbnRlbnRGbGFncyxcbiAgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHMsIGRvbnRTdG9wQXBwT25SZXNldCkge1xuICBsb2cuZGVidWcoYFN0YXJ0aW5nIHBhY2thZ2UgJyR7YXBwUGFja2FnZX0nIGFuZCBhY3Rpdml0eSAnJHthcHBBY3Rpdml0eX0nYCk7XG5cbiAgLy8gZG9udFN0b3BBcHBPblJlc2V0IGlzIGJvdGggYW4gYXJndW1lbnQgaGVyZSwgYW5kIGEgZGVzaXJlZCBjYXBhYmlsaXR5XG4gIC8vIGlmIHRoZSBhcmd1bWVudCBpcyBzZXQsIHVzZSBpdCwgb3RoZXJ3aXNlIHVzZSB0aGUgY2FwXG4gIGlmICghdXRpbC5oYXNWYWx1ZShkb250U3RvcEFwcE9uUmVzZXQpKSB7XG4gICAgZG9udFN0b3BBcHBPblJlc2V0ID0gISF0aGlzLm9wdHMuZG9udFN0b3BBcHBPblJlc2V0O1xuICB9XG5cbiAgbGV0IGFyZ3MgPSB7XG4gICAgcGtnOiBhcHBQYWNrYWdlLFxuICAgIGFjdGl2aXR5OiBhcHBBY3Rpdml0eSxcbiAgICB3YWl0UGtnOiBhcHBXYWl0UGFja2FnZSB8fCBhcHBQYWNrYWdlLFxuICAgIHdhaXRBY3Rpdml0eTogYXBwV2FpdEFjdGl2aXR5IHx8IGFwcEFjdGl2aXR5LFxuICAgIGFjdGlvbjogaW50ZW50QWN0aW9uLFxuICAgIGNhdGVnb3J5OiBpbnRlbnRDYXRlZ29yeSxcbiAgICBmbGFnczogaW50ZW50RmxhZ3MsXG4gICAgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHMsXG4gICAgc3RvcEFwcDogIWRvbnRTdG9wQXBwT25SZXNldFxuICB9O1xuICB0aGlzLl9jYWNoZWRBY3Rpdml0eUFyZ3MgPSB0aGlzLl9jYWNoZWRBY3Rpdml0eUFyZ3MgfHwge307XG4gIHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJnc1tgJHthcmdzLndhaXRQa2d9LyR7YXJncy53YWl0QWN0aXZpdHl9YF0gPSBhcmdzO1xuICBhd2FpdCB0aGlzLmFkYi5zdGFydEFwcChhcmdzKTtcbn07XG5cbmNvbW1hbmRzLnJlc2V0ID0gYXN5bmMgZnVuY3Rpb24gcmVzZXQgKCkge1xuICBhd2FpdCBhbmRyb2lkSGVscGVycy5yZXNldEFwcCh0aGlzLmFkYiwgT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRzLCB7ZmFzdFJlc2V0OiB0cnVlfSkpO1xuICAvLyByZXNldCBjb250ZXh0IHNpbmNlIHdlIGRvbid0IGtub3cgd2hhdCBraW5kIG9uIGNvbnRleHQgd2Ugd2lsbCBlbmQgdXAgYWZ0ZXIgYXBwIGxhdW5jaC5cbiAgYXdhaXQgdGhpcy5zZXRDb250ZXh0KCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmlzQ2hyb21lU2Vzc2lvbiA/IHRoaXMuc3RhcnRDaHJvbWVTZXNzaW9uKCkgOiB0aGlzLnN0YXJ0QVVUKCk7XG59O1xuXG5jb21tYW5kcy5zdGFydEFVVCA9IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0QVVUICgpIHtcbiAgYXdhaXQgdGhpcy5hZGIuc3RhcnRBcHAoe1xuICAgIHBrZzogdGhpcy5vcHRzLmFwcFBhY2thZ2UsXG4gICAgYWN0aXZpdHk6IHRoaXMub3B0cy5hcHBBY3Rpdml0eSxcbiAgICBhY3Rpb246IHRoaXMub3B0cy5pbnRlbnRBY3Rpb24sXG4gICAgY2F0ZWdvcnk6IHRoaXMub3B0cy5pbnRlbnRDYXRlZ29yeSxcbiAgICBmbGFnczogdGhpcy5vcHRzLmludGVudEZsYWdzLFxuICAgIHdhaXRQa2c6IHRoaXMub3B0cy5hcHBXYWl0UGFja2FnZSxcbiAgICB3YWl0QWN0aXZpdHk6IHRoaXMub3B0cy5hcHBXYWl0QWN0aXZpdHksXG4gICAgd2FpdEZvckxhdW5jaDogdGhpcy5vcHRzLmFwcFdhaXRGb3JMYXVuY2gsXG4gICAgd2FpdER1cmF0aW9uOiB0aGlzLm9wdHMuYXBwV2FpdER1cmF0aW9uLFxuICAgIG9wdGlvbmFsSW50ZW50QXJndW1lbnRzOiB0aGlzLm9wdHMub3B0aW9uYWxJbnRlbnRBcmd1bWVudHMsXG4gICAgc3RvcEFwcDogIXRoaXMub3B0cy5kb250U3RvcEFwcE9uUmVzZXQsXG4gICAgdXNlcjogdGhpcy5vcHRzLnVzZXJQcm9maWxlLFxuICB9KTtcbn07XG5cbi8vIHdlIG92ZXJyaWRlIHNldFVybCB0byB0YWtlIGFuIGFuZHJvaWQgVVJJIHdoaWNoIGNhbiBiZSB1c2VkIGZvciBkZWVwLWxpbmtpbmdcbi8vIGluc2lkZSBhbiBhcHAsIHNpbWlsYXIgdG8gc3RhcnRpbmcgYW4gaW50ZW50XG5jb21tYW5kcy5zZXRVcmwgPSBhc3luYyBmdW5jdGlvbiBzZXRVcmwgKHVyaSkge1xuICBhd2FpdCB0aGlzLmFkYi5zdGFydFVyaSh1cmksIHRoaXMub3B0cy5hcHBQYWNrYWdlKTtcbn07XG5cbi8vIGNsb3NpbmcgYXBwIHVzaW5nIGZvcmNlIHN0b3BcbmNvbW1hbmRzLmNsb3NlQXBwID0gYXN5bmMgZnVuY3Rpb24gY2xvc2VBcHAgKCkge1xuICBhd2FpdCB0aGlzLmFkYi5mb3JjZVN0b3AodGhpcy5vcHRzLmFwcFBhY2thZ2UpO1xuICAvLyByZXNldCBjb250ZXh0IHNpbmNlIHdlIGRvbid0IGtub3cgd2hhdCBraW5kIG9uIGNvbnRleHQgd2Ugd2lsbCBlbmQgdXAgYWZ0ZXIgYXBwIGxhdW5jaC5cbiAgYXdhaXQgdGhpcy5zZXRDb250ZXh0KCk7XG59O1xuXG5jb21tYW5kcy5nZXREaXNwbGF5RGVuc2l0eSA9IGFzeW5jIGZ1bmN0aW9uIGdldERpc3BsYXlEZW5zaXR5ICgpIHtcbiAgLy8gZmlyc3QgdHJ5IHRoZSBwcm9wZXJ0eSBmb3IgZGV2aWNlc1xuICBsZXQgb3V0ID0gYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydnZXRwcm9wJywgJ3JvLnNmLmxjZF9kZW5zaXR5J10pO1xuICBpZiAob3V0KSB7XG4gICAgbGV0IHZhbCA9IHBhcnNlSW50KG91dCwgMTApO1xuICAgIC8vIGlmIHRoZSB2YWx1ZSBpcyBOYU4sIHRyeSBnZXR0aW5nIHRoZSBlbXVsYXRvciBwcm9wZXJ0eVxuICAgIGlmICghaXNOYU4odmFsKSkge1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBQYXJzZWQgZGVuc2l0eSB2YWx1ZSB3YXMgTmFOOiBcIiR7b3V0fVwiYCk7XG4gIH1cbiAgLy8gZmFsbGJhY2sgdG8gdHJ5aW5nIHByb3BlcnR5IGZvciBlbXVsYXRvcnNcbiAgb3V0ID0gYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydnZXRwcm9wJywgJ3FlbXUuc2YubGNkX2RlbnNpdHknXSk7XG4gIGlmIChvdXQpIHtcbiAgICBsZXQgdmFsID0gcGFyc2VJbnQob3V0LCAxMCk7XG4gICAgaWYgKCFpc05hTih2YWwpKSB7XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYFBhcnNlZCBkZW5zaXR5IHZhbHVlIHdhcyBOYU46IFwiJHtvdXR9XCJgKTtcbiAgfVxuICAvLyBjb3VsZG4ndCBnZXQgYW55dGhpbmcsIHNvIGVycm9yIG91dFxuICBsb2cuZXJyb3JBbmRUaHJvdygnRmFpbGVkIHRvIGdldCBkaXNwbGF5IGRlbnNpdHkgcHJvcGVydHkuJyk7XG59O1xuXG4vKipcbiAqIFBhcnNlcyB0aGUgZ2l2ZW4gd2luZG93IG1hbmFnZXIgU3VyZmFjZSBzdHJpbmcgdG8gZ2V0IGluZm8uXG4gKiBAcGFyYW0gbGluZTogVG8gcGFyc2UuIFRoaXMgaXMgYXNzdW1lZCB0byBiZSB2YWxpZC5cbiAqIEByZXR1cm46IFZpc2liaWxpdHkgYW5kIGJvdW5kcyBvZiB0aGUgU3VyZmFjZS5cbiAqL1xuZnVuY3Rpb24gcGFyc2VTdXJmYWNlTGluZSAobGluZSkge1xuICAvLyB0aGUgc3VyZmFjZSBib3VuZHMgYXJlIGluIHRoZSBmb3JtYXQ6XG4gIC8vIFwicmVjdD0oMC4wLDExODQuMCkgNzY4LjAgeCA5Ni4wXCJcbiAgLy8gICAgICAgXiBsb2NhdGlvbiAgIF4gc2l6ZVxuICAvLyBjdXQgb3V0IHRoZSBzdHVmZiBiZWZvcmUgdGhlICdyZWN0JyBhbmQgdGhlbiBzcGxpdCB0aGUgbnVtYmVycyBhcGFydFxuICBsZXQgYm91bmRzID0gbGluZS5zcGxpdCgncmVjdD0nKVsxXVxuICAucmVwbGFjZSgvWygpLCB4XSsvZywgJyAnKVxuICAudHJpbSgpXG4gIC5zcGxpdCgnICcpO1xuXG4gIHJldHVybiB7XG4gICAgdmlzaWJsZTogKGxpbmUuaW5kZXhPZignc2hvd249dHJ1ZScpICE9PSAtMSksXG4gICAgeDogcGFyc2VGbG9hdChib3VuZHNbMF0pLFxuICAgIHk6IHBhcnNlRmxvYXQoYm91bmRzWzFdKSxcbiAgICB3aWR0aDogcGFyc2VGbG9hdChib3VuZHNbMl0pLFxuICAgIGhlaWdodDogcGFyc2VGbG9hdChib3VuZHNbM10pXG4gIH07XG59XG5cbi8qKlxuICogRXh0cmFjdHMgc3RhdHVzIGFuZCBuYXZpZ2F0aW9uIGJhciBpbmZvcm1hdGlvbiBmcm9tIHRoZSB3aW5kb3cgbWFuYWdlciBvdXRwdXQuXG4gKiBAcGFyYW0gbGluZXM6IE91dHB1dCBmcm9tIGR1bXBzeXMgY29tbWFuZFxuICogQHJldHVybjogVmlzaWJpbGl0eSBhbmQgYm91bmRzIGluZm8gb2Ygc3RhdHVzIGFuZCBuYXZpZ2F0aW9uIGJhclxuICovXG5mdW5jdGlvbiBwYXJzZVdpbmRvd3MgKGxpbmVzKSB7XG4gIGxldCBhdFN0YXR1c0JhciA9IGZhbHNlO1xuICBsZXQgYXROYXZCYXIgPSBmYWxzZTtcbiAgbGV0IHN0YXR1c0JhcjtcbiAgbGV0IG5hdmlnYXRpb25CYXI7XG4gIC8vIHRoZSB3aW5kb3cgbWFuYWdlciBvdXRwdXQgbG9va3MgbGlrZTpcbiAgLy8gV2luZG93ICMxIC4uLiBXaW5kb3dJRFxuICAvLyAgIEEgYnVuY2ggb2YgcHJvcGVydGllc1xuICAvLyBXaW5kb3cgIzIgLi4uIFdpbmRvd0lEXG4gIC8vICAgQSBidW5jaCBvZiBwcm9wZXJ0aWVzXG4gIGxpbmVzLnNwbGl0KCdcXG4nKS5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgLy8gdGhlIHN0YXJ0IG9mIGEgbmV3IHdpbmRvdyBzZWN0aW9uXG4gICAgaWYgKGxpbmUuaW5kZXhPZignICBXaW5kb3cgIycpICE9PSAtMSkge1xuICAgICAgLy8gZGV0ZXJtaW5lIHdoaWNoIHNlY3Rpb24gd2UncmUgaW5cbiAgICAgIC8vIG9ubHkgb25lIHdpbGwgYmUgdHJ1ZVxuICAgICAgYXRTdGF0dXNCYXIgPSAobGluZS5pbmRleE9mKCdTdGF0dXNCYXInKSAhPT0gLTEpO1xuICAgICAgYXROYXZCYXIgPSAobGluZS5pbmRleE9mKCdOYXZpZ2F0aW9uQmFyJykgIT09IC0xKTtcbiAgICAgIC8vIGRvbid0IG5lZWQgYW55dGhpbmcgZWxzZS4gbW92ZSB0byBuZXh0IGxpbmVcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gb25jZSB3ZSdyZSBpbiBhIHdpbmRvdyBzZWN0aW9uLCBsb29rIGZvciB0aGUgc3VyZmFjZSBkYXRhIGxpbmVcbiAgICBpZiAobGluZS5pbmRleE9mKCcgICAgICBTdXJmYWNlOicpID09PSAtMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoYXRTdGF0dXNCYXIpIHtcbiAgICAgIHN0YXR1c0JhciA9IHBhcnNlU3VyZmFjZUxpbmUobGluZSk7XG4gICAgICBhdFN0YXR1c0JhciA9IGZhbHNlO1xuICAgIH0gZWxzZSBpZiAoYXROYXZCYXIpIHtcbiAgICAgIG5hdmlnYXRpb25CYXIgPSBwYXJzZVN1cmZhY2VMaW5lKGxpbmUpO1xuICAgICAgYXROYXZCYXIgPSBmYWxzZTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmICghc3RhdHVzQmFyKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0ZhaWxlZCB0byBwYXJzZSBzdGF0dXMgYmFyIGluZm9ybWF0aW9uLicpO1xuICB9XG4gIGlmICghbmF2aWdhdGlvbkJhcikge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdGYWlsZWQgdG8gcGFyc2UgbmF2aWdhdGlvbiBiYXIgaW5mb3JtYXRpb24uJyk7XG4gIH1cblxuICByZXR1cm4ge3N0YXR1c0JhciwgbmF2aWdhdGlvbkJhcn07XG59XG5cbmNvbW1hbmRzLmdldFN5c3RlbUJhcnMgPSBhc3luYyBmdW5jdGlvbiBnZXRTeXN0ZW1CYXJzICgpIHtcbiAgbGV0IG91dCA9IGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnZHVtcHN5cycsICd3aW5kb3cnLCAnd2luZG93cyddKTtcbiAgaWYgKCFvdXQpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRGlkIG5vdCBnZXQgd2luZG93IG1hbmFnZXIgb3V0cHV0LicpO1xuICB9XG4gIHJldHVybiBwYXJzZVdpbmRvd3Mob3V0KTtcbn07XG5cbmNvbW1hbmRzLm1vYmlsZVBlcmZvcm1FZGl0b3JBY3Rpb24gPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVQZXJmb3JtRWRpdG9yQWN0aW9uIChvcHRzID0ge30pIHtcbiAgY29uc3Qge2FjdGlvbn0gPSBvcHRzO1xuICBpZiAoIXV0aWwuaGFzVmFsdWUoYWN0aW9uKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGAnYWN0aW9uJyBhcmd1bWVudCBpcyByZXF1aXJlZGApO1xuICB9XG5cbiAgYXdhaXQgdGhpcy5hZGIucGVyZm9ybUVkaXRvckFjdGlvbihhY3Rpb24pO1xufTtcblxuY29uc3QgUEVSTUlTU0lPTl9BQ1RJT04gPSB7XG4gIEdSQU5UOiAnZ3JhbnQnLFxuICBSRVZPS0U6ICdyZXZva2UnLFxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBDaGFuZ2VQZXJtaXNzaW9uc09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7IXN0cmluZ3xBcnJheTxzdHJpbmc+fSBwZXJtaXNzaW9ucyAtIFRoZSBmdWxsIG5hbWUgb2YgdGhlIHBlcm1pc3Npb24gdG8gYmUgY2hhbmdlZFxuICogb3IgYSBsaXN0IG9mIHBlcm1pc3Npb25zLiBNYW5kYXRvcnkgYXJndW1lbnQuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYXBwUGFja2FnZSBbdGhpcy5vcHRzLmFwcFBhY2thZ2VdIC0gVGhlIGFwcGxpY2F0aW9uIHBhY2thZ2UgdG8gc2V0IGNoYW5nZVxuICogcGVybWlzc2lvbnMgb24uIERlZmF1bHRzIHRvIHRoZSBwYWNrYWdlIG5hbWUgdW5kZXIgdGVzdC5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhY3Rpb24gW2dyYW50XSAtIE9uZSBvZiBgUEVSTUlTU0lPTl9BQ1RJT05gIHZhbHVlc1xuICovXG5cbi8qKlxuICogQ2hhbmdlcyBwYWNrYWdlIHBlcm1pc3Npb25zIGluIHJ1bnRpbWUuXG4gKlxuICogQHBhcmFtIHs/Q2hhbmdlUGVybWlzc2lvbnNPcHRpb25zfSBvcHRzIC0gQXZhaWxhYmxlIG9wdGlvbnMgbWFwcGluZy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIGNoYW5naW5nIHBlcm1pc3Npb25zXG4gKi9cbmNvbW1hbmRzLm1vYmlsZUNoYW5nZVBlcm1pc3Npb25zID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlQ2hhbmdlUGVybWlzc2lvbnMgKG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgcGVybWlzc2lvbnMsXG4gICAgYXBwUGFja2FnZSA9IHRoaXMub3B0cy5hcHBQYWNrYWdlLFxuICAgIGFjdGlvbiA9IFBFUk1JU1NJT05fQUNUSU9OLkdSQU5ULFxuICB9ID0gb3B0cztcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKHBlcm1pc3Npb25zKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGAncGVybWlzc2lvbnMnIGFyZ3VtZW50IGlzIHJlcXVpcmVkYCk7XG4gIH1cblxuICBsZXQgYWN0aW9uRnVuYztcbiAgc3dpdGNoIChfLnRvTG93ZXIoYWN0aW9uKSkge1xuICAgIGNhc2UgUEVSTUlTU0lPTl9BQ1RJT04uR1JBTlQ6XG4gICAgICBhY3Rpb25GdW5jID0gKGFwcFBhY2thZ2UsIHBlcm1pc3Npb24pID0+IHRoaXMuYWRiLmdyYW50UGVybWlzc2lvbihhcHBQYWNrYWdlLCBwZXJtaXNzaW9uKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgUEVSTUlTU0lPTl9BQ1RJT04uUkVWT0tFOlxuICAgICAgYWN0aW9uRnVuYyA9IChhcHBQYWNrYWdlLCBwZXJtaXNzaW9uKSA9PiB0aGlzLmFkYi5yZXZva2VQZXJtaXNzaW9uKGFwcFBhY2thZ2UsIHBlcm1pc3Npb24pO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBVbmtub3duIGFjdGlvbiAnJHthY3Rpb259Jy4gYCArXG4gICAgICAgIGBPbmx5ICR7SlNPTi5zdHJpbmdpZnkoXy52YWx1ZXMoUEVSTUlTU0lPTl9BQ1RJT04pKX0gYWN0aW9ucyBhcmUgc3VwcG9ydGVkYCk7XG4gICAgICBicmVhaztcbiAgfVxuICBmb3IgKGNvbnN0IHBlcm1pc3Npb24gb2YgKF8uaXNBcnJheShwZXJtaXNzaW9ucykgPyBwZXJtaXNzaW9ucyA6IFtwZXJtaXNzaW9uc10pKSB7XG4gICAgYXdhaXQgYWN0aW9uRnVuYyhhcHBQYWNrYWdlLCBwZXJtaXNzaW9uKTtcbiAgfVxufTtcblxuY29uc3QgUEVSTUlTU0lPTlNfVFlQRSA9IHtcbiAgREVOSUVEOiAnZGVuaWVkJyxcbiAgR1JBTlRFRDogJ2dyYW50ZWQnLFxuICBSRVFVRVNURUQ6ICdyZXF1ZXN0ZWQnLFxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBHZXRQZXJtaXNzaW9uc09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlIFtyZXF1ZXN0ZWRdIC0gT25lIG9mIHBvc3NpYmxlIHBlcm1pc3Npb24gdHlwZXMgdG8gZ2V0LlxuICogQ2FuIGJlIGFueSBvZiBgUEVSTUlTU0lPTlNfVFlQRWAgdmFsdWVzLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGFwcFBhY2thZ2UgW3RoaXMub3B0cy5hcHBQYWNrYWdlXSAtIFRoZSBhcHBsaWNhdGlvbiBwYWNrYWdlIHRvIHNldCBjaGFuZ2VcbiAqIHBlcm1pc3Npb25zIG9uLiBEZWZhdWx0cyB0byB0aGUgcGFja2FnZSBuYW1lIHVuZGVyIHRlc3QuXG4gKi9cblxuLyoqXG4gKiBHZXRzIHJ1bnRpbWUgcGVybWlzc2lvbnMgbGlzdCBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIHBhY2thZ2UuXG4gKlxuICogQHBhcmFtIHtHZXRQZXJtaXNzaW9uc09wdGlvbnN9IG9wdHMgLSBBdmFpbGFibGUgb3B0aW9ucyBtYXBwaW5nLlxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IFRoZSBsaXN0IG9mIHJldHJpZXZlZCBwZXJtaXNzaW9ucyBmb3IgdGhlIGdpdmVuIHR5cGVcbiAqIChjYW4gYWxzbyBiZSBlbXB0eSkuXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgcGVybWlzc2lvbnMuXG4gKi9cbmNvbW1hbmRzLm1vYmlsZUdldFBlcm1pc3Npb25zID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlR2V0UGVybWlzc2lvbnMgKG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgdHlwZSA9IFBFUk1JU1NJT05TX1RZUEUuUkVRVUVTVEVELFxuICAgIGFwcFBhY2thZ2UgPSB0aGlzLm9wdHMuYXBwUGFja2FnZSxcbiAgfSA9IG9wdHM7XG5cbiAgbGV0IGFjdGlvbkZ1bmM7XG4gIHN3aXRjaCAoXy50b0xvd2VyKHR5cGUpKSB7XG4gICAgY2FzZSBQRVJNSVNTSU9OU19UWVBFLlJFUVVFU1RFRDpcbiAgICAgIGFjdGlvbkZ1bmMgPSAoYXBwUGFja2FnZSkgPT4gdGhpcy5hZGIuZ2V0UmVxUGVybWlzc2lvbnMoYXBwUGFja2FnZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFBFUk1JU1NJT05TX1RZUEUuR1JBTlRFRDpcbiAgICAgIGFjdGlvbkZ1bmMgPSAoYXBwUGFja2FnZSkgPT4gdGhpcy5hZGIuZ2V0R3JhbnRlZFBlcm1pc3Npb25zKGFwcFBhY2thZ2UpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBQRVJNSVNTSU9OU19UWVBFLkRFTklFRDpcbiAgICAgIGFjdGlvbkZ1bmMgPSAoYXBwUGFja2FnZSkgPT4gdGhpcy5hZGIuZ2V0RGVuaWVkUGVybWlzc2lvbnMoYXBwUGFja2FnZSk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYFVua25vd24gcGVybWlzc2lvbnMgdHlwZSAnJHt0eXBlfScuIGAgK1xuICAgICAgICBgT25seSAke0pTT04uc3RyaW5naWZ5KF8udmFsdWVzKFBFUk1JU1NJT05TX1RZUEUpKX0gdHlwZXMgYXJlIHN1cHBvcnRlZGApO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IGFjdGlvbkZ1bmMoYXBwUGFja2FnZSk7XG59O1xuXG4vKipcbiAqIFJldHJpZXZlcyB0aGUgbGlzdCBvZiByZWNlbnQgc3lzdGVtIG5vdGlmaWNhdGlvbnMuXG4gKlxuICogQHJldHVybnMge09iamVjdH0gU2VlIHRoZSBkb2N1bWVudGF0aW9uIG9uIGBhZGIuZ2V0Tm90aWZpY2F0aW9uc2AgZm9yXG4gKiBtb3JlIGRldGFpbHNcbiAqL1xuY29tbWFuZHMubW9iaWxlR2V0Tm90aWZpY2F0aW9ucyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUdldE5vdGlmaWNhdGlvbnMgKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuZ2V0Tm90aWZpY2F0aW9ucygpO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTbXNMaXN0T3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IG1heCBbMTAwXSAtIFRoZSBtYXhpbXVtIGNvdW50IG9mIHJlY2VudCBTTVMgbWVzc2FnZXNcbiAqIHRvIHJldHJpZXZlXG4gKi9cblxuLyoqXG4gKiBSZXRyaWV2ZXMgdGhlIGxpc3Qgb2YgcmVjZW50IFNNUyBtZXNzYWdlcyB3aXRoIHRoZWlyIHByb3BlcnRpZXMuXG4gKlxuICogQHBhcmFtIHtTbXNMaXN0T3B0aW9uc30gb3B0c1xuICogQHJldHVybnMge09iamVjdH0gU2VlIHRoZSBkb2N1bWVudGF0aW9uIG9uIGBhZGIuZ2V0U21zTGlzdGAgZm9yXG4gKiBtb3JlIGRldGFpbHNcbiAqL1xuY29tbWFuZHMubW9iaWxlTGlzdFNtcyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUxpc3RTbXMgKG9wdHMgPSB7fSkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuZ2V0U21zTGlzdChvcHRzKTtcbn07XG5cblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbi8vIGZvciB1bml0IHRlc3RzXG5leHBvcnQgeyBwYXJzZVdpbmRvd3MsIHBhcnNlU3VyZmFjZUxpbmUgfTtcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2dlbmVyYWwuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
