import logger from '../logger';
import { util } from 'appium-support';

let extensions = {}, commands = {};

/**
 * @typedef {Object} DeviceInfo
 *
 * @property {?string} currentLocale - Current device locale. e.g. 'ja_EN' and 'zh-Hant_US'
 * @property {?string} timeZone - TZ database Time Zones format like 'US/Pacific'
  */

/**
 * Returns device info.
 *
 * @returns {DeviceInfo} The current device info
 * @throws {Error} if an error raised by command
 */
commands.mobileGetDeviceInfo = async function mobileGetDeviceInfo () {
  let locale;
  try {
    locale = await this.adb.getDeviceLocale();
  } catch (e) {
    logger.warn(`Failed to get device locale: ${e.message}`);
  }

  let timezone;
  try {
    timezone = await this.adb.getTimezone();
  } catch (e) {
    logger.warn(`Failed to get device timezone: ${e.message}`);
  }

  const info = {};
  if (util.hasValue(locale)) {
    info.locale = locale;
  }
  if (util.hasValue(timezone)) {
    info.timeZone = timezone;
  }
  return info;
};

Object.assign(extensions, commands);
export { commands };
export default extensions;
