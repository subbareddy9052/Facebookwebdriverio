"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _remoteMessages = _interopRequireDefault(require("./remote-messages"));

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _rpcMessageHandler = _interopRequireDefault(require("./rpc-message-handler"));

var _appiumSupport = require("appium-support");

const DATA_LOG_LENGTH = {
  length: 200
};
const WAIT_FOR_TARGET_TIMEOUT = 10000;
const WAIT_FOR_TARGET_INTERVAL = 1000;
const MIN_PLATFORM_FOR_TARGET_BASED = '12.2';
const MIN_PLATFORM_NO_TARGET_EXISTS = '13.4';

function isTargetBased(isSafari, platformVersion) {
  const isHighVersion = _appiumSupport.util.compareVersions(platformVersion, '>=', MIN_PLATFORM_FOR_TARGET_BASED);

  _logger.default.debug(`Checking which communication style to use (${isSafari ? '' : 'non-'}Safari on platform version '${platformVersion}')`);

  _logger.default.debug(`Platform version equal or higher than '${MIN_PLATFORM_FOR_TARGET_BASED}': ${isHighVersion}`);

  return isSafari && isHighVersion;
}

class RpcClient {
  constructor(opts = {}) {
    this._targets = [];
    this._shouldCheckForTarget = !!opts.shouldCheckForTarget;
    const {
      bundleId,
      platformVersion = {},
      isSafari = true,
      logAllCommunication = false,
      logAllCommunicationHexDump = false,
      socketChunkSize,
      fullPageInitialization = false
    } = opts;
    this.isSafari = isSafari;
    this.isConnected = false;
    this.connId = _appiumSupport.util.uuidV4();
    this.senderId = _appiumSupport.util.uuidV4();
    this.msgId = 0;
    this.logAllCommunication = logAllCommunication;
    this.logAllCommunicationHexDump = logAllCommunicationHexDump;
    this.socketChunkSize = socketChunkSize;
    this.fullPageInitialization = fullPageInitialization;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this._contexts = [];
    this._targets = {};
    this.isTargetBased = isTargetBased(isSafari, this.platformVersion);
  }

  get contexts() {
    return this._contexts;
  }

  get needsTarget() {
    return this.shouldCheckForTarget && this.isTargetBased;
  }

  get targets() {
    return this._targets;
  }

  get shouldCheckForTarget() {
    return this._shouldCheckForTarget;
  }

  set shouldCheckForTarget(shouldCheckForTarget) {
    this._shouldCheckForTarget = !!shouldCheckForTarget;
  }

  get isConnected() {
    return this.connected;
  }

  set isConnected(connected) {
    this.connected = !!connected;
  }

  on(event, listener) {
    this.messageHandler.on(event, listener);
    return this;
  }

  once(event, listener) {
    this.messageHandler.once(event, listener);
    return this;
  }

  off(event, listener) {
    this.messageHandler.off(event, listener);
    return this;
  }

  set isTargetBased(isTargetBased) {
    _logger.default.warn(`Setting communication protocol: using ${isTargetBased ? 'Target-based' : 'full Web Inspector protocol'} communication`);

    this._isTargetBased = isTargetBased;

    if (!this.remoteMessages) {
      this.remoteMessages = new _remoteMessages.default(isTargetBased);
    } else {
      this.remoteMessages.isTargetBased = isTargetBased;
    }

    if (!this.messageHandler) {
      this.messageHandler = new _rpcMessageHandler.default(isTargetBased);
      this.messageHandler.on('Target.targetCreated', this.addTarget.bind(this));
      this.messageHandler.on('Target.didCommitProvisionalTarget', this.updateTarget.bind(this));
      this.messageHandler.on('Target.targetDestroyed', this.removeTarget.bind(this));
      this.messageHandler.on('Runtime.executionContextCreated', this.onExecutionContextCreated.bind(this));
      this.messageHandler.on('Heap.garbageCollected', this.onGarbageCollected.bind(this));
    } else {
      this.messageHandler.isTargetBased = isTargetBased;
    }
  }

  get isTargetBased() {
    return this._isTargetBased;
  }

  async waitForTarget(appIdKey, pageIdKey, force = false) {
    if (!force && !this.needsTarget) {
      return;
    }

    if (this.getTarget(appIdKey, pageIdKey)) {
      return;
    }

    try {
      await (0, _asyncbox.waitForCondition)(() => !_lodash.default.isEmpty(this.getTarget(appIdKey, pageIdKey)), {
        waitMs: WAIT_FOR_TARGET_TIMEOUT,
        intervalMs: WAIT_FOR_TARGET_INTERVAL,
        error: 'No targets found, unable to communicate with device'
      });
    } catch (err) {
      if (!err.message.includes('Condition unmet')) {
        throw err;
      }

      throw new Error('No targets found, unable to communicate with device');
    }
  }

  async send(command, opts = {}, waitForResponse = true) {
    const timer = new _appiumSupport.timing.Timer().start();
    const {
      appIdKey,
      pageIdKey
    } = opts;

    try {
      if (!_lodash.default.isEmpty(appIdKey) && !_lodash.default.isEmpty(pageIdKey)) {
        await this.waitForTarget(appIdKey, pageIdKey);
      }

      return await this.sendToDevice(command, opts, waitForResponse);
    } catch (err) {
      if (err.message.includes(`'Target' domain was not found`)) {
        this.isTargetBased = false;
        return await this.sendToDevice(command, opts, waitForResponse);
      } else if (err.message.includes(`domain was not found`) || err.message.includes(`Some arguments of method`)) {
        this.isTargetBased = true;
        await this.waitForTarget(appIdKey, pageIdKey);
        return await this.sendToDevice(command, opts, waitForResponse);
      }

      throw err;
    } finally {
      _logger.default.debug(`Sending to Web Inspector took ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
    }
  }

  async sendToDevice(command, opts = {}, waitForResponse = true) {
    return await new _bluebird.default(async (resolve, reject) => {
      var _cmd$__argument, _cmd$__argument2;

      const msgId = this.msgId++;
      let wrapperMsgId = msgId;

      if (this.isTargetBased) {
        wrapperMsgId = this.msgId++;
        this.messageHandler.on(wrapperMsgId.toString(), function (err) {
          if (err) {
            reject(err);
          }
        });
      }

      const appIdKey = opts.appIdKey;
      const pageIdKey = opts.pageIdKey;
      const targetId = this.getTarget(appIdKey, pageIdKey);

      const fullOpts = _lodash.default.defaults({
        connId: this.connId,
        senderId: this.senderId,
        targetId,
        id: msgId
      }, opts);

      const cmd = this.remoteMessages.getRemoteCommand(command, fullOpts);

      if (cmd === null || cmd === void 0 ? void 0 : (_cmd$__argument = cmd.__argument) === null || _cmd$__argument === void 0 ? void 0 : _cmd$__argument.WIRSocketDataKey) {
        if (_lodash.default.isNil(cmd.__argument.WIRSocketDataKey.id)) {
          cmd.__argument.WIRSocketDataKey.id = wrapperMsgId;
        }

        cmd.__argument.WIRSocketDataKey = Buffer.from(JSON.stringify(cmd.__argument.WIRSocketDataKey));
      }

      let messageHandled = true;

      if (!waitForResponse) {
        messageHandled = false;
        this.messageHandler.once(msgId.toString(), function (err) {
          if (err) {
            _logger.default.error(`Received error from send that is not being waited for (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(err), DATA_LOG_LENGTH)}'`);

            reject(err);
          }
        });
      } else if (this.messageHandler.listeners(cmd.__selector).length) {
        this.messageHandler.prependOnceListener(cmd.__selector, function (err, ...args) {
          if (err) {
            return reject(err);
          }

          _logger.default.debug(`Received response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(args), DATA_LOG_LENGTH)}'`);

          resolve(args);
        });
      } else if (cmd === null || cmd === void 0 ? void 0 : (_cmd$__argument2 = cmd.__argument) === null || _cmd$__argument2 === void 0 ? void 0 : _cmd$__argument2.WIRSocketDataKey) {
        this.messageHandler.once(msgId.toString(), function (err, value) {
          if (err) {
            return reject(new Error(`Remote debugger error with code '${err.code}': ${err.message}`));
          }

          _logger.default.debug(`Received data response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(value), DATA_LOG_LENGTH)}'`);

          resolve(value);
        });
      } else {
        messageHandled = false;
      }

      const msg = `Sending '${cmd.__selector}' message` + (fullOpts.appIdKey ? ` to app '${fullOpts.appIdKey}'` : '') + (fullOpts.pageIdKey ? `, page '${fullOpts.pageIdKey}'` : '') + (this.needsTarget && targetId ? `, target '${targetId}'` : '') + ` (id: ${msgId}): '${command}'`;

      _logger.default.debug(msg);

      try {
        const res = await this.sendMessage(cmd);

        if (!messageHandled) {
          resolve(res);
        }
      } catch (err) {
        return reject(err);
      }
    });
  }

  async connect() {
    throw new Error(`Sub-classes need to implement a 'connect' function`);
  }

  async disconnect() {
    this.messageHandler.removeAllListeners();
  }

  async sendMessage() {
    throw new Error(`Sub-classes need to implement a 'sendMessage' function`);
  }

  async receive() {
    throw new Error(`Sub-classes need to implement a 'receive' function`);
  }

  addTarget(err, app, targetInfo) {
    if (_lodash.default.isNil(targetInfo === null || targetInfo === void 0 ? void 0 : targetInfo.targetId)) {
      _logger.default.warn(`Received 'Target.targetCreated' event for app '${app}' with no target. Skipping`);

      return;
    }

    if (_lodash.default.isEmpty(this.pendingTargetNotification) && !targetInfo.isProvisional) {
      _logger.default.warn(`Received 'Target.targetCreated' event for app '${app}' with no pending request: ${JSON.stringify(targetInfo)}`);

      return;
    }

    if (targetInfo.isProvisional) {
      _logger.default.debug(`Provisional target created for app '${app}', '${targetInfo.targetId}'. Ignoring until target update event`);

      return;
    }

    const [appIdKey, pageIdKey] = this.pendingTargetNotification;

    _logger.default.debug(`Target created for app '${appIdKey}' and page '${pageIdKey}': ${JSON.stringify(targetInfo)}`);

    if (_lodash.default.has(this.targets[appIdKey], pageIdKey)) {
      _logger.default.debug(`There is already a target for this app and page ('${this.targets[appIdKey][pageIdKey]}'). This might cause problems`);
    }

    this.targets[app] = this.targets[app] || {};
    this.targets[appIdKey][pageIdKey] = targetInfo.targetId;
  }

  updateTarget(err, app, oldTargetId, newTargetId) {
    _logger.default.debug(`Target updated for app '${app}'. Old target: '${oldTargetId}', new target: '${newTargetId}'`);

    if (!this.targets[app]) {
      _logger.default.warn(`No existing target for app '${app}'. Not sure what to do`);

      return;
    }

    this.targets[app].provisional = {
      oldTargetId,
      newTargetId
    };
  }

  removeTarget(err, app, targetInfo) {
    var _this$targets$app, _this$targets$app$pro;

    if (_lodash.default.isNil(targetInfo === null || targetInfo === void 0 ? void 0 : targetInfo.targetId)) {
      _logger.default.debug(`Received 'Target.targetDestroyed' event with no target. Skipping`);

      return;
    }

    _logger.default.debug(`Target destroyed for app '${app}': ${targetInfo.targetId}`);

    if (((_this$targets$app = this.targets[app]) === null || _this$targets$app === void 0 ? void 0 : (_this$targets$app$pro = _this$targets$app.provisional) === null || _this$targets$app$pro === void 0 ? void 0 : _this$targets$app$pro.oldTargetId) === targetInfo.targetId) {
      const {
        oldTargetId,
        newTargetId
      } = this.targets[app].provisional;
      delete this.targets[app].provisional;
      const targets = this.targets[app];

      for (const [page, targetId] of _lodash.default.toPairs(targets)) {
        if (targetId === oldTargetId) {
          _logger.default.debug(`Found provisional target for app '${app}'. Old target: '${oldTargetId}', new target: '${newTargetId}'. Updating`);

          targets[page] = newTargetId;
          return;
        }
      }

      _logger.default.warn(`Provisional target for app '${app}' found, but no suitable existing target found. This may cause problems`);

      _logger.default.warn(`Old target: '${oldTargetId}', new target: '${newTargetId}'. Existing targets: ${JSON.stringify(targets)}`);
    }

    const targets = this.targets[app];

    for (const [page, targetId] of _lodash.default.toPairs(targets)) {
      if (targetId === targetInfo.targetId) {
        delete targets[page];
        return;
      }
    }

    _logger.default.debug(`Target '${targetInfo.targetId}' deleted for app '${app}', but no such target exists`);
  }

  getTarget(appIdKey, pageIdKey) {
    return (this.targets[appIdKey] || {})[pageIdKey];
  }

  async selectPage(appIdKey, pageIdKey) {
    this.pendingTargetNotification = [appIdKey, pageIdKey];
    this.shouldCheckForTarget = false;
    const sendOpts = {
      appIdKey,
      pageIdKey
    };

    for (const enabled of [true, false]) {
      await this.send('indicateWebView', Object.assign({
        enabled
      }, sendOpts), false);
    }

    await this.send('setSenderKey', sendOpts);

    _logger.default.debug('Sender key set');

    if (this.isTargetBased && _appiumSupport.util.compareVersions(this.platformVersion, '<', MIN_PLATFORM_NO_TARGET_EXISTS)) {
      await this.send('Target.exists', sendOpts, false);
    }

    this.shouldCheckForTarget = true;

    if (this.fullPageInitialization) {
      await this.initializePageFull(appIdKey, pageIdKey);
    } else {
      await this.initializePage(appIdKey, pageIdKey);
    }
  }

  async initializePage(appIdKey, pageIdKey) {
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('Inspector.enable', sendOpts, false);
    await this.send('Page.enable', sendOpts, false);
    await this.send('Network.enable', sendOpts, false);
    await this.send('Runtime.enable', sendOpts, false);
    await this.send('Heap.enable', sendOpts, false);
    await this.send('Debugger.enable', sendOpts, false);
    await this.send('Console.enable', sendOpts, false);
    await this.send('Inspector.initialized', sendOpts, false);
  }

  async initializePageFull(appIdKey, pageIdKey) {
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('Inspector.enable', sendOpts, false);
    await this.send('Page.enable', sendOpts, false);
    await this.send('Page.getResourceTree', sendOpts, false);
    await this.send('Network.enable', sendOpts, false);
    await this.send('Network.setResourceCachingDisabled', Object.assign({
      disabled: false
    }, sendOpts), false);
    await this.send('DOMStorage.enable', sendOpts, false);
    await this.send('Database.enable', sendOpts, false);
    await this.send('IndexedDB.enable', sendOpts, false);
    await this.send('CSS.enable', sendOpts, false);
    await this.send('Runtime.enable', sendOpts, false);
    await this.send('Heap.enable', sendOpts, false);
    await this.send('Memory.enable', sendOpts, false);
    await this.send('ApplicationCache.enable', sendOpts, false);
    await this.send('ApplicationCache.getFramesWithManifests', sendOpts, false);
    await this.send('Timeline.setInstruments', sendOpts, false);
    await this.send('Timeline.setAutoCaptureEnabled', Object.assign({
      enabled: false
    }, sendOpts), false);
    await this.send('Debugger.enable', sendOpts, false);
    await this.send('Debugger.setBreakpointsActive', Object.assign({
      active: true
    }, sendOpts), false);
    await this.send('Debugger.setPauseOnExceptions', Object.assign({
      state: 'none'
    }, sendOpts), false);
    await this.send('Debugger.setPauseOnAssertions', Object.assign({
      enabled: false
    }, sendOpts), false);
    await this.send('Debugger.setAsyncStackTraceDepth', Object.assign({
      depth: 200
    }, sendOpts), false);
    await this.send('Debugger.setPauseForInternalScripts', Object.assign({
      shouldPause: false
    }, sendOpts), false);
    await this.send('LayerTree.enable', sendOpts, false);
    await this.send('Worker.enable', sendOpts, false);
    await this.send('Canvas.enable', sendOpts, false);
    await this.send('Console.enable', sendOpts, false);
    await this.send('DOM.getDocument', sendOpts, false);
    const loggingChannels = await this.send('Console.getLoggingChannels', sendOpts);

    for (const source of (loggingChannels.channels || []).map(entry => entry.source)) {
      await this.send('Console.setLoggingChannelLevel', Object.assign({
        source,
        level: 'verbose'
      }, sendOpts), false);
    }

    await this.send('Inspector.initialized', sendOpts, false);
  }

  async selectApp(appIdKey) {
    return await new _bluebird.default((resolve, reject) => {
      const onAppChange = (err, dict) => {
        if (err) {
          return reject(err);
        }

        const oldAppIdKey = dict.WIRHostApplicationIdentifierKey;
        const correctAppIdKey = dict.WIRApplicationIdentifierKey;

        if (oldAppIdKey && correctAppIdKey !== oldAppIdKey) {
          _logger.default.debug(`We were notified we might have connected to the wrong app. ` + `Using id ${correctAppIdKey} instead of ${oldAppIdKey}`);
        }

        reject(new Error('New application has connected'));
      };

      this.messageHandler.prependOnceListener('_rpc_applicationConnected:', onAppChange);
      return (async () => {
        let pageDict, connectedAppIdKey;

        try {
          [connectedAppIdKey, pageDict] = await this.send('connectToApp', {
            appIdKey
          });
        } catch (err) {
          _logger.default.warn(`Unable to connect to app: ${err.message}`);

          reject(err);
        }

        if (_lodash.default.isEmpty(pageDict)) {
          let msg = 'Empty page dictionary received';

          _logger.default.debug(msg);

          reject(new Error(msg));
        } else {
          resolve([connectedAppIdKey, pageDict]);
        }
      })();
    });
  }

  onExecutionContextCreated(err, context) {
    this.contexts.push(context.id);
  }

  onGarbageCollected() {
    _logger.default.debug(`Web Inspector garbage collected`);
  }

  onScriptParsed(err, scriptInfo) {
    _logger.default.debug(`Script parsed: ${JSON.stringify(scriptInfo)}`);
  }

}

exports.default = RpcClient;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9ycGMvcnBjLWNsaWVudC5qcyJdLCJuYW1lcyI6WyJEQVRBX0xPR19MRU5HVEgiLCJsZW5ndGgiLCJXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCIsIldBSVRfRk9SX1RBUkdFVF9JTlRFUlZBTCIsIk1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEIiwiTUlOX1BMQVRGT1JNX05PX1RBUkdFVF9FWElTVFMiLCJpc1RhcmdldEJhc2VkIiwiaXNTYWZhcmkiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc0hpZ2hWZXJzaW9uIiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsImxvZyIsImRlYnVnIiwiUnBjQ2xpZW50IiwiY29uc3RydWN0b3IiLCJvcHRzIiwiX3RhcmdldHMiLCJfc2hvdWxkQ2hlY2tGb3JUYXJnZXQiLCJzaG91bGRDaGVja0ZvclRhcmdldCIsImJ1bmRsZUlkIiwibG9nQWxsQ29tbXVuaWNhdGlvbiIsImxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwic29ja2V0Q2h1bmtTaXplIiwiZnVsbFBhZ2VJbml0aWFsaXphdGlvbiIsImlzQ29ubmVjdGVkIiwiY29ubklkIiwidXVpZFY0Iiwic2VuZGVySWQiLCJtc2dJZCIsIl9jb250ZXh0cyIsImNvbnRleHRzIiwibmVlZHNUYXJnZXQiLCJ0YXJnZXRzIiwiY29ubmVjdGVkIiwib24iLCJldmVudCIsImxpc3RlbmVyIiwibWVzc2FnZUhhbmRsZXIiLCJvbmNlIiwib2ZmIiwid2FybiIsIl9pc1RhcmdldEJhc2VkIiwicmVtb3RlTWVzc2FnZXMiLCJSZW1vdGVNZXNzYWdlcyIsIlJwY01lc3NhZ2VIYW5kbGVyIiwiYWRkVGFyZ2V0IiwiYmluZCIsInVwZGF0ZVRhcmdldCIsInJlbW92ZVRhcmdldCIsIm9uRXhlY3V0aW9uQ29udGV4dENyZWF0ZWQiLCJvbkdhcmJhZ2VDb2xsZWN0ZWQiLCJ3YWl0Rm9yVGFyZ2V0IiwiYXBwSWRLZXkiLCJwYWdlSWRLZXkiLCJmb3JjZSIsImdldFRhcmdldCIsIl8iLCJpc0VtcHR5Iiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImVycm9yIiwiZXJyIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiRXJyb3IiLCJzZW5kIiwiY29tbWFuZCIsIndhaXRGb3JSZXNwb25zZSIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsInNlbmRUb0RldmljZSIsImdldER1cmF0aW9uIiwiYXNNaWxsaVNlY29uZHMiLCJ0b0ZpeGVkIiwiQiIsInJlc29sdmUiLCJyZWplY3QiLCJ3cmFwcGVyTXNnSWQiLCJ0b1N0cmluZyIsInRhcmdldElkIiwiZnVsbE9wdHMiLCJkZWZhdWx0cyIsImlkIiwiY21kIiwiZ2V0UmVtb3RlQ29tbWFuZCIsIl9fYXJndW1lbnQiLCJXSVJTb2NrZXREYXRhS2V5IiwiaXNOaWwiLCJCdWZmZXIiLCJmcm9tIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1lc3NhZ2VIYW5kbGVkIiwidHJ1bmNhdGUiLCJsaXN0ZW5lcnMiLCJfX3NlbGVjdG9yIiwicHJlcGVuZE9uY2VMaXN0ZW5lciIsImFyZ3MiLCJ2YWx1ZSIsImNvZGUiLCJtc2ciLCJyZXMiLCJzZW5kTWVzc2FnZSIsImNvbm5lY3QiLCJkaXNjb25uZWN0IiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwicmVjZWl2ZSIsImFwcCIsInRhcmdldEluZm8iLCJwZW5kaW5nVGFyZ2V0Tm90aWZpY2F0aW9uIiwiaXNQcm92aXNpb25hbCIsImhhcyIsIm9sZFRhcmdldElkIiwibmV3VGFyZ2V0SWQiLCJwcm92aXNpb25hbCIsInBhZ2UiLCJ0b1BhaXJzIiwic2VsZWN0UGFnZSIsInNlbmRPcHRzIiwiZW5hYmxlZCIsIk9iamVjdCIsImFzc2lnbiIsImluaXRpYWxpemVQYWdlRnVsbCIsImluaXRpYWxpemVQYWdlIiwiZGlzYWJsZWQiLCJhY3RpdmUiLCJzdGF0ZSIsImRlcHRoIiwic2hvdWxkUGF1c2UiLCJsb2dnaW5nQ2hhbm5lbHMiLCJzb3VyY2UiLCJjaGFubmVscyIsIm1hcCIsImVudHJ5IiwibGV2ZWwiLCJzZWxlY3RBcHAiLCJvbkFwcENoYW5nZSIsImRpY3QiLCJvbGRBcHBJZEtleSIsIldJUkhvc3RBcHBsaWNhdGlvbklkZW50aWZpZXJLZXkiLCJjb3JyZWN0QXBwSWRLZXkiLCJXSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXkiLCJwYWdlRGljdCIsImNvbm5lY3RlZEFwcElkS2V5IiwiY29udGV4dCIsInB1c2giLCJvblNjcmlwdFBhcnNlZCIsInNjcmlwdEluZm8iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsZUFBZSxHQUFHO0FBQUNDLEVBQUFBLE1BQU0sRUFBRTtBQUFULENBQXhCO0FBRUEsTUFBTUMsdUJBQXVCLEdBQUcsS0FBaEM7QUFDQSxNQUFNQyx3QkFBd0IsR0FBRyxJQUFqQztBQUVBLE1BQU1DLDZCQUE2QixHQUFHLE1BQXRDO0FBR0EsTUFBTUMsNkJBQTZCLEdBQUcsTUFBdEM7O0FBRUEsU0FBU0MsYUFBVCxDQUF3QkMsUUFBeEIsRUFBa0NDLGVBQWxDLEVBQW1EO0FBRWpELFFBQU1DLGFBQWEsR0FBR0Msb0JBQUtDLGVBQUwsQ0FBcUJILGVBQXJCLEVBQXNDLElBQXRDLEVBQTRDSiw2QkFBNUMsQ0FBdEI7O0FBQ0FRLGtCQUFJQyxLQUFKLENBQVcsOENBQTZDTixRQUFRLEdBQUcsRUFBSCxHQUFRLE1BQU8sK0JBQThCQyxlQUFnQixJQUE3SDs7QUFDQUksa0JBQUlDLEtBQUosQ0FBVywwQ0FBeUNULDZCQUE4QixNQUFLSyxhQUFjLEVBQXJHOztBQUNBLFNBQU9GLFFBQVEsSUFBSUUsYUFBbkI7QUFDRDs7QUFFYyxNQUFNSyxTQUFOLENBQWdCO0FBQzdCQyxFQUFBQSxXQUFXLENBQUVDLElBQUksR0FBRyxFQUFULEVBQWE7QUFDdEIsU0FBS0MsUUFBTCxHQUFnQixFQUFoQjtBQUNBLFNBQUtDLHFCQUFMLEdBQTZCLENBQUMsQ0FBQ0YsSUFBSSxDQUFDRyxvQkFBcEM7QUFFQSxVQUFNO0FBQ0pDLE1BQUFB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TztBQUNMekIsVUFBQUEsT0FBTyxDQUFDLENBQUNvRSxpQkFBRCxFQUFvQkQsUUFBcEIsQ0FBRCxDQUFQO0FBQ0Q7QUFDRixPQXBCTSxHQUFQO0FBcUJELEtBN0NZLENBQWI7QUE4Q0Q7O0FBRUQvRixFQUFBQSx5QkFBeUIsQ0FBRVksR0FBRixFQUFPcUYsT0FBUCxFQUFnQjtBQUl2QyxTQUFLcEgsUUFBTCxDQUFjcUgsSUFBZCxDQUFtQkQsT0FBTyxDQUFDOUQsRUFBM0I7QUFDRDs7QUFFRGxDLEVBQUFBLGtCQUFrQixHQUFJO0FBRXBCdkMsb0JBQUlDLEtBQUosQ0FBVyxpQ0FBWDtBQUNEOztBQUVEd0ksRUFBQUEsY0FBYyxDQUFFdkYsR0FBRixFQUFPd0YsVUFBUCxFQUFtQjtBQUUvQjFJLG9CQUFJQyxLQUFKLENBQVcsa0JBQWlCZ0YsSUFBSSxDQUFDQyxTQUFMLENBQWV3RCxVQUFmLENBQTJCLEVBQXZEO0FBQ0Q7O0FBeGhCNEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVtb3RlTWVzc2FnZXMgZnJvbSAnLi9yZW1vdGUtbWVzc2FnZXMnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgUnBjTWVzc2FnZUhhbmRsZXIgZnJvbSAnLi9ycGMtbWVzc2FnZS1oYW5kbGVyJztcbmltcG9ydCB7IHV0aWwsIHRpbWluZyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcblxuXG5jb25zdCBEQVRBX0xPR19MRU5HVEggPSB7bGVuZ3RoOiAyMDB9O1xuXG5jb25zdCBXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCA9IDEwMDAwO1xuY29uc3QgV0FJVF9GT1JfVEFSR0VUX0lOVEVSVkFMID0gMTAwMDtcblxuY29uc3QgTUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUQgPSAnMTIuMic7XG5cbi8vIGBUYXJnZXQuZXhpc3RzYCBwcm90b2NvbCBtZXRob2Qgd2FzIHJlbW92ZWQgZnJvbSBXZWJLaXRpbiAxMy40XG5jb25zdCBNSU5fUExBVEZPUk1fTk9fVEFSR0VUX0VYSVNUUyA9ICcxMy40JztcblxuZnVuY3Rpb24gaXNUYXJnZXRCYXNlZCAoaXNTYWZhcmksIHBsYXRmb3JtVmVyc2lvbikge1xuICAvLyBvbiBpT1MgMTIuMiB0aGUgbWVzc2FnZXMgZ2V0IHNlbnQgdGhyb3VnaCB0aGUgVGFyZ2V0IGRvbWFpblxuICBjb25zdCBpc0hpZ2hWZXJzaW9uID0gdXRpbC5jb21wYXJlVmVyc2lvbnMocGxhdGZvcm1WZXJzaW9uLCAnPj0nLCBNSU5fUExBVEZPUk1fRk9SX1RBUkdFVF9CQVNFRCk7XG4gIGxvZy5kZWJ1ZyhgQ2hlY2tpbmcgd2hpY2ggY29tbXVuaWNhdGlvbiBzdHlsZSB0byB1c2UgKCR7aXNTYWZhcmkgPyAnJyA6ICdub24tJ31TYWZhcmkgb24gcGxhdGZvcm0gdmVyc2lvbiAnJHtwbGF0Zm9ybVZlcnNpb259JylgKTtcbiAgbG9nLmRlYnVnKGBQbGF0Zm9ybSB2ZXJzaW9uIGVxdWFsIG9yIGhpZ2hlciB0aGFuICcke01JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEfSc6ICR7aXNIaWdoVmVyc2lvbn1gKTtcbiAgcmV0dXJuIGlzU2FmYXJpICYmIGlzSGlnaFZlcnNpb247XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJwY0NsaWVudCB7XG4gIGNvbnN0cnVjdG9yIChvcHRzID0ge30pIHtcbiAgICB0aGlzLl90YXJnZXRzID0gW107XG4gICAgdGhpcy5fc2hvdWxkQ2hlY2tGb3JUYXJnZXQgPSAhIW9wdHMuc2hvdWxkQ2hlY2tGb3JUYXJnZXQ7XG5cbiAgICBjb25zdCB7XG4gICAgICBidW5kbGVJZCxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbiA9IHt9LFxuICAgICAgaXNTYWZhcmkgPSB0cnVlLFxuICAgICAgbG9nQWxsQ29tbXVuaWNhdGlvbiA9IGZhbHNlLFxuICAgICAgbG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAgPSBmYWxzZSxcbiAgICAgIHNvY2tldENodW5rU2l6ZSxcbiAgICAgIGZ1bGxQYWdlSW5pdGlhbGl6YXRpb24gPSBmYWxzZSxcbiAgICB9ID0gb3B0cztcblxuICAgIHRoaXMuaXNTYWZhcmkgPSBpc1NhZmFyaTtcblxuICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmNvbm5JZCA9IHV0aWwudXVpZFY0KCk7XG4gICAgdGhpcy5zZW5kZXJJZCA9IHV0aWwudXVpZFY0KCk7XG4gICAgdGhpcy5tc2dJZCA9IDA7XG5cbiAgICB0aGlzLmxvZ0FsbENvbW11bmljYXRpb24gPSBsb2dBbGxDb21tdW5pY2F0aW9uO1xuICAgIHRoaXMubG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAgPSBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcDtcbiAgICB0aGlzLnNvY2tldENodW5rU2l6ZSA9IHNvY2tldENodW5rU2l6ZTtcblxuICAgIHRoaXMuZnVsbFBhZ2VJbml0aWFsaXphdGlvbiA9IGZ1bGxQYWdlSW5pdGlhbGl6YXRpb247XG5cbiAgICB0aGlzLmJ1bmRsZUlkID0gYnVuZGxlSWQ7XG4gICAgdGhpcy5wbGF0Zm9ybVZlcnNpb24gPSBwbGF0Zm9ybVZlcnNpb247XG5cbiAgICB0aGlzLl9jb250ZXh0cyA9IFtdO1xuICAgIHRoaXMuX3RhcmdldHMgPSB7fTtcblxuICAgIC8vIHN0YXJ0IHdpdGggYSBiZXN0IGd1ZXNzIGZvciB0aGUgcHJvdG9jb2xcbiAgICB0aGlzLmlzVGFyZ2V0QmFzZWQgPSBpc1RhcmdldEJhc2VkKGlzU2FmYXJpLCB0aGlzLnBsYXRmb3JtVmVyc2lvbik7XG4gIH1cblxuICBnZXQgY29udGV4dHMgKCkge1xuICAgIHJldHVybiB0aGlzLl9jb250ZXh0cztcbiAgfVxuXG4gIGdldCBuZWVkc1RhcmdldCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2hvdWxkQ2hlY2tGb3JUYXJnZXQgJiYgdGhpcy5pc1RhcmdldEJhc2VkO1xuICB9XG5cbiAgZ2V0IHRhcmdldHMgKCkge1xuICAgIHJldHVybiB0aGlzLl90YXJnZXRzO1xuICB9XG5cbiAgZ2V0IHNob3VsZENoZWNrRm9yVGFyZ2V0ICgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2hvdWxkQ2hlY2tGb3JUYXJnZXQ7XG4gIH1cblxuICBzZXQgc2hvdWxkQ2hlY2tGb3JUYXJnZXQgKHNob3VsZENoZWNrRm9yVGFyZ2V0KSB7XG4gICAgdGhpcy5fc2hvdWxkQ2hlY2tGb3JUYXJnZXQgPSAhIXNob3VsZENoZWNrRm9yVGFyZ2V0O1xuICB9XG5cbiAgZ2V0IGlzQ29ubmVjdGVkICgpIHtcbiAgICByZXR1cm4gdGhpcy5jb25uZWN0ZWQ7XG4gIH1cblxuICBzZXQgaXNDb25uZWN0ZWQgKGNvbm5lY3RlZCkge1xuICAgIHRoaXMuY29ubmVjdGVkID0gISFjb25uZWN0ZWQ7XG4gIH1cblxuICBvbiAoZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbihldmVudCwgbGlzdGVuZXIpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgb25jZSAoZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbmNlKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBvZmYgKGV2ZW50LCBsaXN0ZW5lcikge1xuICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub2ZmKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZXQgaXNUYXJnZXRCYXNlZCAoaXNUYXJnZXRCYXNlZCkge1xuICAgIGxvZy53YXJuKGBTZXR0aW5nIGNvbW11bmljYXRpb24gcHJvdG9jb2w6IHVzaW5nICR7aXNUYXJnZXRCYXNlZCA/ICdUYXJnZXQtYmFzZWQnIDogJ2Z1bGwgV2ViIEluc3BlY3RvciBwcm90b2NvbCd9IGNvbW11bmljYXRpb25gKTtcbiAgICB0aGlzLl9pc1RhcmdldEJhc2VkID0gaXNUYXJnZXRCYXNlZDtcblxuICAgIGlmICghdGhpcy5yZW1vdGVNZXNzYWdlcykge1xuICAgICAgdGhpcy5yZW1vdGVNZXNzYWdlcyA9IG5ldyBSZW1vdGVNZXNzYWdlcyhpc1RhcmdldEJhc2VkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW1vdGVNZXNzYWdlcy5pc1RhcmdldEJhc2VkID0gaXNUYXJnZXRCYXNlZDtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMubWVzc2FnZUhhbmRsZXIpIHtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIgPSBuZXcgUnBjTWVzc2FnZUhhbmRsZXIoaXNUYXJnZXRCYXNlZCk7XG5cbiAgICAgIC8vIGFkZCBoYW5kbGVycyBmb3IgaW50ZXJuYWwgZXZlbnRzXG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKCdUYXJnZXQudGFyZ2V0Q3JlYXRlZCcsIHRoaXMuYWRkVGFyZ2V0LmJpbmQodGhpcykpO1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbignVGFyZ2V0LmRpZENvbW1pdFByb3Zpc2lvbmFsVGFyZ2V0JywgdGhpcy51cGRhdGVUYXJnZXQuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKCdUYXJnZXQudGFyZ2V0RGVzdHJveWVkJywgdGhpcy5yZW1vdmVUYXJnZXQuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKCdSdW50aW1lLmV4ZWN1dGlvbkNvbnRleHRDcmVhdGVkJywgdGhpcy5vbkV4ZWN1dGlvbkNvbnRleHRDcmVhdGVkLmJpbmQodGhpcykpO1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbignSGVhcC5nYXJiYWdlQ29sbGVjdGVkJywgdGhpcy5vbkdhcmJhZ2VDb2xsZWN0ZWQuYmluZCh0aGlzKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIuaXNUYXJnZXRCYXNlZCA9IGlzVGFyZ2V0QmFzZWQ7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGlzVGFyZ2V0QmFzZWQgKCkge1xuICAgIHJldHVybiB0aGlzLl9pc1RhcmdldEJhc2VkO1xuICB9XG5cbiAgYXN5bmMgd2FpdEZvclRhcmdldCAoYXBwSWRLZXksIHBhZ2VJZEtleSwgZm9yY2UgPSBmYWxzZSkge1xuICAgIGlmICghZm9yY2UgJiYgIXRoaXMubmVlZHNUYXJnZXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nZXRUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBvdGhlcndpc2Ugd2FpdGluZyBpcyBuZWNlc3NhcnkgdG8gc2VlIHdoYXQgdGhlIHRhcmdldCBpc1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKCgpID0+ICFfLmlzRW1wdHkodGhpcy5nZXRUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSkpLCB7XG4gICAgICAgIHdhaXRNczogV0FJVF9GT1JfVEFSR0VUX1RJTUVPVVQsXG4gICAgICAgIGludGVydmFsTXM6IFdBSVRfRk9SX1RBUkdFVF9JTlRFUlZBTCxcbiAgICAgICAgZXJyb3I6ICdObyB0YXJnZXRzIGZvdW5kLCB1bmFibGUgdG8gY29tbXVuaWNhdGUgd2l0aCBkZXZpY2UnLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIWVyci5tZXNzYWdlLmluY2x1ZGVzKCdDb25kaXRpb24gdW5tZXQnKSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHRhcmdldHMgZm91bmQsIHVuYWJsZSB0byBjb21tdW5pY2F0ZSB3aXRoIGRldmljZScpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlbmQgKGNvbW1hbmQsIG9wdHMgPSB7fSwgd2FpdEZvclJlc3BvbnNlID0gdHJ1ZSkge1xuICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgY29uc3Qge1xuICAgICAgYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXlcbiAgICB9ID0gb3B0cztcbiAgICB0cnkge1xuICAgICAgaWYgKCFfLmlzRW1wdHkoYXBwSWRLZXkpICYmICFfLmlzRW1wdHkocGFnZUlkS2V5KSkge1xuICAgICAgICBhd2FpdCB0aGlzLndhaXRGb3JUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kVG9EZXZpY2UoY29tbWFuZCwgb3B0cywgd2FpdEZvclJlc3BvbnNlKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChlcnIubWVzc2FnZS5pbmNsdWRlcyhgJ1RhcmdldCcgZG9tYWluIHdhcyBub3QgZm91bmRgKSkge1xuICAgICAgICB0aGlzLmlzVGFyZ2V0QmFzZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZFRvRGV2aWNlKGNvbW1hbmQsIG9wdHMsIHdhaXRGb3JSZXNwb25zZSk7XG4gICAgICB9IGVsc2UgaWYgKGVyci5tZXNzYWdlLmluY2x1ZGVzKGBkb21haW4gd2FzIG5vdCBmb3VuZGApIHx8IGVyci5tZXNzYWdlLmluY2x1ZGVzKGBTb21lIGFyZ3VtZW50cyBvZiBtZXRob2RgKSkge1xuICAgICAgICB0aGlzLmlzVGFyZ2V0QmFzZWQgPSB0cnVlO1xuICAgICAgICBhd2FpdCB0aGlzLndhaXRGb3JUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRUb0RldmljZShjb21tYW5kLCBvcHRzLCB3YWl0Rm9yUmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBsb2cuZGVidWcoYFNlbmRpbmcgdG8gV2ViIEluc3BlY3RvciB0b29rICR7dGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcy50b0ZpeGVkKDApfW1zYCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZFRvRGV2aWNlIChjb21tYW5kLCBvcHRzID0ge30sIHdhaXRGb3JSZXNwb25zZSA9IHRydWUpIHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgLy8gcHJvbWlzZSB0byBiZSByZXNvbHZlZCB3aGVuZXZlciByZW1vdGUgZGVidWdnZXJcbiAgICAgIC8vIHJlcGxpZXMgdG8gb3VyIHJlcXVlc3RcblxuICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGUgbWVzc2FnZXMgY29taW5nIGFuZCBnb2luZyB1c2luZyBhIHNpbXBsZSBzZXF1ZW50aWFsIGlkXG4gICAgICBjb25zdCBtc2dJZCA9IHRoaXMubXNnSWQrKztcbiAgICAgIGxldCB3cmFwcGVyTXNnSWQgPSBtc2dJZDtcbiAgICAgIGlmICh0aGlzLmlzVGFyZ2V0QmFzZWQpIHtcbiAgICAgICAgLy8gZm9yIHRhcmdldC1iYXNlIGNvbW11bmljYXRpb24sIGV2ZXJ5dGhpbmcgaXMgd3JhcHBlZCB1cFxuICAgICAgICB3cmFwcGVyTXNnSWQgPSB0aGlzLm1zZ0lkKys7XG4gICAgICAgIC8vIGFja25vd2xlZGdlIHdyYXBwZXIgbWVzc2FnZVxuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKHdyYXBwZXJNc2dJZC50b1N0cmluZygpLCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYXBwSWRLZXkgPSBvcHRzLmFwcElkS2V5O1xuICAgICAgY29uc3QgcGFnZUlkS2V5ID0gb3B0cy5wYWdlSWRLZXk7XG4gICAgICBjb25zdCB0YXJnZXRJZCA9IHRoaXMuZ2V0VGFyZ2V0KGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuXG4gICAgICAvLyByZXRyaWV2ZSB0aGUgY29ycmVjdCBjb21tYW5kIHRvIHNlbmRcbiAgICAgIGNvbnN0IGZ1bGxPcHRzID0gXy5kZWZhdWx0cyh7XG4gICAgICAgIGNvbm5JZDogdGhpcy5jb25uSWQsXG4gICAgICAgIHNlbmRlcklkOiB0aGlzLnNlbmRlcklkLFxuICAgICAgICB0YXJnZXRJZCxcbiAgICAgICAgaWQ6IG1zZ0lkLFxuICAgICAgfSwgb3B0cyk7XG4gICAgICBjb25zdCBjbWQgPSB0aGlzLnJlbW90ZU1lc3NhZ2VzLmdldFJlbW90ZUNvbW1hbmQoY29tbWFuZCwgZnVsbE9wdHMpO1xuXG4gICAgICBpZiAoY21kPy5fX2FyZ3VtZW50Py5XSVJTb2NrZXREYXRhS2V5KSB7XG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgbWVzc2FnZSBiZWluZyBzZW50IGhhcyBhbGwgdGhlIGluZm9ybWF0aW9uIHRoYXQgaXMgbmVlZGVkXG4gICAgICAgIGlmIChfLmlzTmlsKGNtZC5fX2FyZ3VtZW50LldJUlNvY2tldERhdGFLZXkuaWQpKSB7XG4gICAgICAgICAgY21kLl9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5pZCA9IHdyYXBwZXJNc2dJZDtcbiAgICAgICAgfVxuICAgICAgICBjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5ID1cbiAgICAgICAgICBCdWZmZXIuZnJvbShKU09OLnN0cmluZ2lmeShjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5KSk7XG4gICAgICB9XG5cbiAgICAgIGxldCBtZXNzYWdlSGFuZGxlZCA9IHRydWU7XG4gICAgICBpZiAoIXdhaXRGb3JSZXNwb25zZSkge1xuICAgICAgICAvLyB0aGUgcHJvbWlzZSB3aWxsIGJlIHJlc29sdmVkIGFzIHNvb24gYXMgdGhlIHNvY2tldCBoYXMgYmVlbiBzZW50XG4gICAgICAgIG1lc3NhZ2VIYW5kbGVkID0gZmFsc2U7XG4gICAgICAgIC8vIGRvIG5vdCBsb2cgcmVjZWlwdHNcbiAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbmNlKG1zZ0lkLnRvU3RyaW5nKCksIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAvLyB3ZSBhcmUgbm90IHdhaXRpbmcgZm9yIHRoaXMsIGFuZCBpZiBpdCBlcnJvcnMgaXQgaXMgbW9zdCBsaWtlbHlcbiAgICAgICAgICAgIC8vIGEgcHJvdG9jb2wgY2hhbmdlLiBMb2cgYW5kIGNoZWNrIGR1cmluZyB0ZXN0aW5nXG4gICAgICAgICAgICBsb2cuZXJyb3IoYFJlY2VpdmVkIGVycm9yIGZyb20gc2VuZCB0aGF0IGlzIG5vdCBiZWluZyB3YWl0ZWQgZm9yIChpZDogJHttc2dJZH0pOiAnJHtfLnRydW5jYXRlKEpTT04uc3RyaW5naWZ5KGVyciksIERBVEFfTE9HX0xFTkdUSCl9J2ApO1xuICAgICAgICAgICAgLy8gcmVqZWN0LCB0aG91Z2ggaXQgaXMgdmVyeSByYXJlIHRoYXQgdGhpcyB3aWxsIGJlIHRyaWdnZXJlZCwgc2luY2VcbiAgICAgICAgICAgIC8vIHRoZSBwcm9taXNlIGlzIHJlc29sdmVkIGRpcmVjdGx0eSBhZnRlciBzZW5kLiBPbiB0aGUgb2ZmIGNoYW5jZSxcbiAgICAgICAgICAgIC8vIHRob3VnaCwgaXQgd2lsbCBhbGVydCBvZiBhIHByb3RvY29sIGNoYW5nZS5cbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMubWVzc2FnZUhhbmRsZXIubGlzdGVuZXJzKGNtZC5fX3NlbGVjdG9yKS5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5wcmVwZW5kT25jZUxpc3RlbmVyKGNtZC5fX3NlbGVjdG9yLCBmdW5jdGlvbiAoZXJyLCAuLi5hcmdzKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIHJlc3BvbnNlIGZyb20gc2VuZCAoaWQ6ICR7bXNnSWR9KTogJyR7Xy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeShhcmdzKSwgREFUQV9MT0dfTEVOR1RIKX0nYCk7XG4gICAgICAgICAgcmVzb2x2ZShhcmdzKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKGNtZD8uX19hcmd1bWVudD8uV0lSU29ja2V0RGF0YUtleSkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uY2UobXNnSWQudG9TdHJpbmcoKSwgZnVuY3Rpb24gKGVyciwgdmFsdWUpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcihgUmVtb3RlIGRlYnVnZ2VyIGVycm9yIHdpdGggY29kZSAnJHtlcnIuY29kZX0nOiAke2Vyci5tZXNzYWdlfWApKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBkYXRhIHJlc3BvbnNlIGZyb20gc2VuZCAoaWQ6ICR7bXNnSWR9KTogJyR7Xy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeSh2YWx1ZSksIERBVEFfTE9HX0xFTkdUSCl9J2ApO1xuICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG5vdGhpbmcgZWxzZSBpcyBoYW5kbGluZyB0aGluZ3MsIHNvIGp1c3QgcmVzb2x2ZSB3aGVuIHRoZSBtZXNzYWdlIGlzIHNlbnRcbiAgICAgICAgbWVzc2FnZUhhbmRsZWQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbXNnID0gYFNlbmRpbmcgJyR7Y21kLl9fc2VsZWN0b3J9JyBtZXNzYWdlYCArXG4gICAgICAgIChmdWxsT3B0cy5hcHBJZEtleSA/IGAgdG8gYXBwICcke2Z1bGxPcHRzLmFwcElkS2V5fSdgIDogJycpICtcbiAgICAgICAgKGZ1bGxPcHRzLnBhZ2VJZEtleSA/IGAsIHBhZ2UgJyR7ZnVsbE9wdHMucGFnZUlkS2V5fSdgIDogJycpICtcbiAgICAgICAgKHRoaXMubmVlZHNUYXJnZXQgJiYgdGFyZ2V0SWQgPyBgLCB0YXJnZXQgJyR7dGFyZ2V0SWR9J2AgOiAnJykgK1xuICAgICAgICBgIChpZDogJHttc2dJZH0pOiAnJHtjb21tYW5kfSdgO1xuICAgICAgbG9nLmRlYnVnKG1zZyk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnNlbmRNZXNzYWdlKGNtZCk7XG4gICAgICAgIGlmICghbWVzc2FnZUhhbmRsZWQpIHtcbiAgICAgICAgICAvLyBUaGVyZSBhcmUgbm8gaGFuZGxlcnMgd2FpdGluZyBmb3IgYSByZXNwb25zZSBiZWZvcmUgcmVzb2x2aW5nLFxuICAgICAgICAgIC8vIGFuZCBubyBlcnJvcnMgc2VuZGluZyB0aGUgbWVzc2FnZSBvdmVyIHRoZSBzb2NrZXQsIHNvIHJlc29sdmVcbiAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBjb25uZWN0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTdWItY2xhc3NlcyBuZWVkIHRvIGltcGxlbWVudCBhICdjb25uZWN0JyBmdW5jdGlvbmApO1xuICB9XG5cbiAgYXN5bmMgZGlzY29ubmVjdCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRoaXMubWVzc2FnZUhhbmRsZXIucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gIH1cblxuICBhc3luYyBzZW5kTWVzc2FnZSAoLyogY29tbWFuZCAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ3NlbmRNZXNzYWdlJyBmdW5jdGlvbmApO1xuICB9XG5cbiAgYXN5bmMgcmVjZWl2ZSAoLyogZGF0YSAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ3JlY2VpdmUnIGZ1bmN0aW9uYCk7XG4gIH1cblxuICBhZGRUYXJnZXQgKGVyciwgYXBwLCB0YXJnZXRJbmZvKSB7XG4gICAgaWYgKF8uaXNOaWwodGFyZ2V0SW5mbz8udGFyZ2V0SWQpKSB7XG4gICAgICBsb2cud2FybihgUmVjZWl2ZWQgJ1RhcmdldC50YXJnZXRDcmVhdGVkJyBldmVudCBmb3IgYXBwICcke2FwcH0nIHdpdGggbm8gdGFyZ2V0LiBTa2lwcGluZ2ApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoXy5pc0VtcHR5KHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbikgJiYgIXRhcmdldEluZm8uaXNQcm92aXNpb25hbCkge1xuICAgICAgbG9nLndhcm4oYFJlY2VpdmVkICdUYXJnZXQudGFyZ2V0Q3JlYXRlZCcgZXZlbnQgZm9yIGFwcCAnJHthcHB9JyB3aXRoIG5vIHBlbmRpbmcgcmVxdWVzdDogJHtKU09OLnN0cmluZ2lmeSh0YXJnZXRJbmZvKX1gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGFyZ2V0SW5mby5pc1Byb3Zpc2lvbmFsKSB7XG4gICAgICBsb2cuZGVidWcoYFByb3Zpc2lvbmFsIHRhcmdldCBjcmVhdGVkIGZvciBhcHAgJyR7YXBwfScsICcke3RhcmdldEluZm8udGFyZ2V0SWR9Jy4gSWdub3JpbmcgdW50aWwgdGFyZ2V0IHVwZGF0ZSBldmVudGApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IFthcHBJZEtleSwgcGFnZUlkS2V5XSA9IHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbjtcblxuICAgIGxvZy5kZWJ1ZyhgVGFyZ2V0IGNyZWF0ZWQgZm9yIGFwcCAnJHthcHBJZEtleX0nIGFuZCBwYWdlICcke3BhZ2VJZEtleX0nOiAke0pTT04uc3RyaW5naWZ5KHRhcmdldEluZm8pfWApO1xuICAgIGlmIChfLmhhcyh0aGlzLnRhcmdldHNbYXBwSWRLZXldLCBwYWdlSWRLZXkpKSB7XG4gICAgICBsb2cuZGVidWcoYFRoZXJlIGlzIGFscmVhZHkgYSB0YXJnZXQgZm9yIHRoaXMgYXBwIGFuZCBwYWdlICgnJHt0aGlzLnRhcmdldHNbYXBwSWRLZXldW3BhZ2VJZEtleV19JykuIFRoaXMgbWlnaHQgY2F1c2UgcHJvYmxlbXNgKTtcbiAgICB9XG4gICAgdGhpcy50YXJnZXRzW2FwcF0gPSB0aGlzLnRhcmdldHNbYXBwXSB8fCB7fTtcbiAgICB0aGlzLnRhcmdldHNbYXBwSWRLZXldW3BhZ2VJZEtleV0gPSB0YXJnZXRJbmZvLnRhcmdldElkO1xuICB9XG5cbiAgdXBkYXRlVGFyZ2V0IChlcnIsIGFwcCwgb2xkVGFyZ2V0SWQsIG5ld1RhcmdldElkKSB7XG4gICAgbG9nLmRlYnVnKGBUYXJnZXQgdXBkYXRlZCBmb3IgYXBwICcke2FwcH0nLiBPbGQgdGFyZ2V0OiAnJHtvbGRUYXJnZXRJZH0nLCBuZXcgdGFyZ2V0OiAnJHtuZXdUYXJnZXRJZH0nYCk7XG4gICAgaWYgKCF0aGlzLnRhcmdldHNbYXBwXSkge1xuICAgICAgbG9nLndhcm4oYE5vIGV4aXN0aW5nIHRhcmdldCBmb3IgYXBwICcke2FwcH0nLiBOb3Qgc3VyZSB3aGF0IHRvIGRvYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIHNhdmUgdGhpcywgdG8gYmUgdXNlZCBpZi93aGVuIHRoZSBleGlzdGluZyB0YXJnZXQgaXMgZGVzdHJveWVkXG4gICAgdGhpcy50YXJnZXRzW2FwcF0ucHJvdmlzaW9uYWwgPSB7XG4gICAgICBvbGRUYXJnZXRJZCxcbiAgICAgIG5ld1RhcmdldElkLFxuICAgIH07XG4gIH1cblxuICByZW1vdmVUYXJnZXQgKGVyciwgYXBwLCB0YXJnZXRJbmZvKSB7XG4gICAgaWYgKF8uaXNOaWwodGFyZ2V0SW5mbz8udGFyZ2V0SWQpKSB7XG4gICAgICBsb2cuZGVidWcoYFJlY2VpdmVkICdUYXJnZXQudGFyZ2V0RGVzdHJveWVkJyBldmVudCB3aXRoIG5vIHRhcmdldC4gU2tpcHBpbmdgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYFRhcmdldCBkZXN0cm95ZWQgZm9yIGFwcCAnJHthcHB9JzogJHt0YXJnZXRJbmZvLnRhcmdldElkfWApO1xuXG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgdGFyZ2V0cyBhbmQgZmluZCB0aGUgb25lIHRoYXQgaGFzIGEgd2FpdGluZyBwcm92aXNpb25hbCB0YXJnZXRcbiAgICBpZiAodGhpcy50YXJnZXRzW2FwcF0/LnByb3Zpc2lvbmFsPy5vbGRUYXJnZXRJZCA9PT0gdGFyZ2V0SW5mby50YXJnZXRJZCkge1xuICAgICAgY29uc3Qge29sZFRhcmdldElkLCBuZXdUYXJnZXRJZH0gPSB0aGlzLnRhcmdldHNbYXBwXS5wcm92aXNpb25hbDtcbiAgICAgIGRlbGV0ZSB0aGlzLnRhcmdldHNbYXBwXS5wcm92aXNpb25hbDtcblxuICAgICAgLy8gd2UgZG8gbm90IGtub3cgdGhlIHBhZ2UsIHNvIGdvIHRocm91Z2ggYW5kIGZpbmQgdGhlIGV4aXN0aW5nIHRhcmdldFxuICAgICAgY29uc3QgdGFyZ2V0cyA9IHRoaXMudGFyZ2V0c1thcHBdO1xuICAgICAgZm9yIChjb25zdCBbcGFnZSwgdGFyZ2V0SWRdIG9mIF8udG9QYWlycyh0YXJnZXRzKSkge1xuICAgICAgICBpZiAodGFyZ2V0SWQgPT09IG9sZFRhcmdldElkKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGBGb3VuZCBwcm92aXNpb25hbCB0YXJnZXQgZm9yIGFwcCAnJHthcHB9Jy4gT2xkIHRhcmdldDogJyR7b2xkVGFyZ2V0SWR9JywgbmV3IHRhcmdldDogJyR7bmV3VGFyZ2V0SWR9Jy4gVXBkYXRpbmdgKTtcbiAgICAgICAgICB0YXJnZXRzW3BhZ2VdID0gbmV3VGFyZ2V0SWQ7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsb2cud2FybihgUHJvdmlzaW9uYWwgdGFyZ2V0IGZvciBhcHAgJyR7YXBwfScgZm91bmQsIGJ1dCBubyBzdWl0YWJsZSBleGlzdGluZyB0YXJnZXQgZm91bmQuIFRoaXMgbWF5IGNhdXNlIHByb2JsZW1zYCk7XG4gICAgICBsb2cud2FybihgT2xkIHRhcmdldDogJyR7b2xkVGFyZ2V0SWR9JywgbmV3IHRhcmdldDogJyR7bmV3VGFyZ2V0SWR9Jy4gRXhpc3RpbmcgdGFyZ2V0czogJHtKU09OLnN0cmluZ2lmeSh0YXJnZXRzKX1gKTtcbiAgICB9XG5cbiAgICAvLyBpZiB0aGVyZSBpcyBubyB3YWl0aW5nIHByb3Zpc2lvbmFsIHRhcmdldCwganVzdCBnZXQgcmlkIG9mIHRoZSBleGlzdGluZyBvbmVcbiAgICBjb25zdCB0YXJnZXRzID0gdGhpcy50YXJnZXRzW2FwcF07XG4gICAgZm9yIChjb25zdCBbcGFnZSwgdGFyZ2V0SWRdIG9mIF8udG9QYWlycyh0YXJnZXRzKSkge1xuICAgICAgaWYgKHRhcmdldElkID09PSB0YXJnZXRJbmZvLnRhcmdldElkKSB7XG4gICAgICAgIGRlbGV0ZSB0YXJnZXRzW3BhZ2VdO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgVGFyZ2V0ICcke3RhcmdldEluZm8udGFyZ2V0SWR9JyBkZWxldGVkIGZvciBhcHAgJyR7YXBwfScsIGJ1dCBubyBzdWNoIHRhcmdldCBleGlzdHNgKTtcbiAgfVxuXG4gIGdldFRhcmdldCAoYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIHJldHVybiAodGhpcy50YXJnZXRzW2FwcElkS2V5XSB8fCB7fSlbcGFnZUlkS2V5XTtcbiAgfVxuXG4gIGFzeW5jIHNlbGVjdFBhZ2UgKGFwcElkS2V5LCBwYWdlSWRLZXkpIHtcbiAgICB0aGlzLnBlbmRpbmdUYXJnZXROb3RpZmljYXRpb24gPSBbYXBwSWRLZXksIHBhZ2VJZEtleV07XG4gICAgdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCA9IGZhbHNlO1xuXG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgc3RlcHMgdGhhdCB0aGUgRGVza3RvcCBTYWZhcmkgc3lzdGVtXG4gICAgLy8gZ29lcyB0aHJvdWdoIHRvIGluaXRpYWxpemUgdGhlIFdlYiBJbnNwZWN0b3Igc2Vzc2lvblxuXG4gICAgY29uc3Qgc2VuZE9wdHMgPSB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICB9O1xuXG4gICAgLy8gaGlnaGxpZ2h0IGFuZCB0aGVuIHVuLWhpZ2hsaWdodCB0aGUgd2Vidmlld1xuICAgIGZvciAoY29uc3QgZW5hYmxlZCBvZiBbdHJ1ZSwgZmFsc2VdKSB7XG4gICAgICBhd2FpdCB0aGlzLnNlbmQoJ2luZGljYXRlV2ViVmlldycsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgICBlbmFibGVkLFxuICAgICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdzZXRTZW5kZXJLZXknLCBzZW5kT3B0cyk7XG4gICAgbG9nLmRlYnVnKCdTZW5kZXIga2V5IHNldCcpO1xuXG4gICAgaWYgKHRoaXMuaXNUYXJnZXRCYXNlZCAmJiB1dGlsLmNvbXBhcmVWZXJzaW9ucyh0aGlzLnBsYXRmb3JtVmVyc2lvbiwgJzwnLCBNSU5fUExBVEZPUk1fTk9fVEFSR0VUX0VYSVNUUykpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZCgnVGFyZ2V0LmV4aXN0cycsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCA9IHRydWU7XG5cbiAgICBpZiAodGhpcy5mdWxsUGFnZUluaXRpYWxpemF0aW9uKSB7XG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVQYWdlRnVsbChhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplUGFnZShhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiBQZXJmb3JtIHRoZSBtaW5pbWFsIGluaXRpYWxpemF0aW9uIHRvIGdldCB0aGUgV2ViIEluc3BlY3RvciB3b3JraW5nXG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplUGFnZSAoYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIGNvbnN0IHNlbmRPcHRzID0ge1xuICAgICAgYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXksXG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMuc2VuZCgnSW5zcGVjdG9yLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdQYWdlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG5cbiAgICAvLyBnbyB0aHJvdWdoIHRoZSB0YXNrcyB0byBpbml0aWFsaXplXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdOZXR3b3JrLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdSdW50aW1lLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdIZWFwLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnQ29uc29sZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnSW5zcGVjdG9yLmluaXRpYWxpemVkJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgfVxuXG4gIC8qXG4gICAqIE1pbWljIGV2ZXJ5IHN0ZXAgdGhhdCBEZXNrdG9wIFNhZmFyaSBEZXZlbG9wIHRvb2xzIHVzZXMgdG8gaW5pdGlhbGl6ZSBhXG4gICAqIFdlYiBJbnNwZWN0b3Igc2Vzc2lvblxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZVBhZ2VGdWxsIChhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgY29uc3Qgc2VuZE9wdHMgPSB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICB9O1xuXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdJbnNwZWN0b3IuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ1BhZ2UuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcblxuICAgIC8vIGdvIHRocm91Z2ggdGhlIHRhc2tzIHRvIGluaXRpYWxpemVcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ1BhZ2UuZ2V0UmVzb3VyY2VUcmVlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ05ldHdvcmsuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ05ldHdvcmsuc2V0UmVzb3VyY2VDYWNoaW5nRGlzYWJsZWQnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RPTVN0b3JhZ2UuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RhdGFiYXNlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdJbmRleGVkREIuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0NTUy5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnUnVudGltZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnSGVhcC5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnTWVtb3J5LmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdBcHBsaWNhdGlvbkNhY2hlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdBcHBsaWNhdGlvbkNhY2hlLmdldEZyYW1lc1dpdGhNYW5pZmVzdHMnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnVGltZWxpbmUuc2V0SW5zdHJ1bWVudHMnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnVGltZWxpbmUuc2V0QXV0b0NhcHR1cmVFbmFibGVkJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRCcmVha3BvaW50c0FjdGl2ZScsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgYWN0aXZlOiB0cnVlLFxuICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnRGVidWdnZXIuc2V0UGF1c2VPbkV4Y2VwdGlvbnMnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIHN0YXRlOiAnbm9uZScsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRQYXVzZU9uQXNzZXJ0aW9ucycsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRBc3luY1N0YWNrVHJhY2VEZXB0aCcsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgZGVwdGg6IDIwMCxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLnNldFBhdXNlRm9ySW50ZXJuYWxTY3JpcHRzJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBzaG91bGRQYXVzZTogZmFsc2UsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG5cbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0xheWVyVHJlZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnV29ya2VyLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdDYW52YXMuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0NvbnNvbGUuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RPTS5nZXREb2N1bWVudCcsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgY29uc3QgbG9nZ2luZ0NoYW5uZWxzID0gYXdhaXQgdGhpcy5zZW5kKCdDb25zb2xlLmdldExvZ2dpbmdDaGFubmVscycsIHNlbmRPcHRzKTtcbiAgICBmb3IgKGNvbnN0IHNvdXJjZSBvZiAobG9nZ2luZ0NoYW5uZWxzLmNoYW5uZWxzIHx8IFtdKS5tYXAoKGVudHJ5KSA9PiBlbnRyeS5zb3VyY2UpKSB7XG4gICAgICBhd2FpdCB0aGlzLnNlbmQoJ0NvbnNvbGUuc2V0TG9nZ2luZ0NoYW5uZWxMZXZlbCcsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgICBzb3VyY2UsXG4gICAgICAgIGxldmVsOiAndmVyYm9zZScsXG4gICAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0luc3BlY3Rvci5pbml0aWFsaXplZCcsIHNlbmRPcHRzLCBmYWxzZSk7XG4gIH1cblxuICBhc3luYyBzZWxlY3RBcHAgKGFwcElkS2V5KSB7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8vIGxvY2FsIGNhbGxiYWNrLCB0ZW1wb3JhcmlseSBhZGRlZCBhcyBjYWxsYmFjayB0b1xuICAgICAgLy8gYF9ycGNfYXBwbGljYXRpb25Db25uZWN0ZWQ6YCByZW1vdGUgZGVidWdnZXIgcmVzcG9uc2VcbiAgICAgIC8vIHRvIGhhbmRsZSB0aGUgaW5pdGlhbCBjb25uZWN0aW9uXG4gICAgICBjb25zdCBvbkFwcENoYW5nZSA9IChlcnIsIGRpY3QpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBmcm9tIHRoZSBkaWN0aW9uYXJ5IHJldHVybmVkLCBnZXQgdGhlIGlkc1xuICAgICAgICBjb25zdCBvbGRBcHBJZEtleSA9IGRpY3QuV0lSSG9zdEFwcGxpY2F0aW9uSWRlbnRpZmllcktleTtcbiAgICAgICAgY29uc3QgY29ycmVjdEFwcElkS2V5ID0gZGljdC5XSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk7XG5cbiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHJlcG9ydCBvZiBhIHByb3h5IHJlZGlyZWN0IGZyb20gdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgICAvLyB3ZSB3YW50IHRvIHVwZGF0ZSBvdXIgZGljdGlvbmFyeSBhbmQgZ2V0IGEgbmV3IGFwcCBpZFxuICAgICAgICBpZiAob2xkQXBwSWRLZXkgJiYgY29ycmVjdEFwcElkS2V5ICE9PSBvbGRBcHBJZEtleSkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgV2Ugd2VyZSBub3RpZmllZCB3ZSBtaWdodCBoYXZlIGNvbm5lY3RlZCB0byB0aGUgd3JvbmcgYXBwLiBgICtcbiAgICAgICAgICAgICAgICAgICAgYFVzaW5nIGlkICR7Y29ycmVjdEFwcElkS2V5fSBpbnN0ZWFkIG9mICR7b2xkQXBwSWRLZXl9YCk7XG4gICAgICAgIH1cblxuICAgICAgICByZWplY3QobmV3IEVycm9yKCdOZXcgYXBwbGljYXRpb24gaGFzIGNvbm5lY3RlZCcpKTtcbiAgICAgIH07XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLnByZXBlbmRPbmNlTGlzdGVuZXIoJ19ycGNfYXBwbGljYXRpb25Db25uZWN0ZWQ6Jywgb25BcHBDaGFuZ2UpO1xuXG4gICAgICAvLyBkbyB0aGUgYWN0dWFsIGNvbm5lY3RpbmcgdG8gdGhlIGFwcFxuICAgICAgcmV0dXJuIChhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBwYWdlRGljdCwgY29ubmVjdGVkQXBwSWRLZXk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgKFtjb25uZWN0ZWRBcHBJZEtleSwgcGFnZURpY3RdID0gYXdhaXQgdGhpcy5zZW5kKCdjb25uZWN0VG9BcHAnLCB7XG4gICAgICAgICAgICBhcHBJZEtleVxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgbG9nLndhcm4oYFVuYWJsZSB0byBjb25uZWN0IHRvIGFwcDogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNvbWV0aW1lcyB0aGUgY29ubmVjdCBsb2dpYyBoYXBwZW5zLCBidXQgd2l0aCBhbiBlbXB0eSBkaWN0aW9uYXJ5XG4gICAgICAgIC8vIHdoaWNoIGxlYWRzIHRvIHRoZSByZW1vdGUgZGVidWdnZXIgZ2V0dGluZyBkaXNjb25uZWN0ZWQsIGFuZCBpbnRvIGEgbG9vcFxuICAgICAgICBpZiAoXy5pc0VtcHR5KHBhZ2VEaWN0KSkge1xuICAgICAgICAgIGxldCBtc2cgPSAnRW1wdHkgcGFnZSBkaWN0aW9uYXJ5IHJlY2VpdmVkJztcbiAgICAgICAgICBsb2cuZGVidWcobXNnKTtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKG1zZykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUoW2Nvbm5lY3RlZEFwcElkS2V5LCBwYWdlRGljdF0pO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH0pO1xuICB9XG5cbiAgb25FeGVjdXRpb25Db250ZXh0Q3JlYXRlZCAoZXJyLCBjb250ZXh0KSB7XG4gICAgLy8geyBpZDogMiwgaXNQYWdlQ29udGV4dDogdHJ1ZSwgbmFtZTogJycsIGZyYW1lSWQ6ICcwLjEnIH1cbiAgICAvLyByaWdodCBub3cgd2UgaGF2ZSBubyB3YXkgdG8gbWFwIGNvbnRleHRzIHRvIGFwcHMvcGFnZXNcbiAgICAvLyBzbyBqdXN0IHN0b3JlXG4gICAgdGhpcy5jb250ZXh0cy5wdXNoKGNvbnRleHQuaWQpO1xuICB9XG5cbiAgb25HYXJiYWdlQ29sbGVjdGVkICgpIHtcbiAgICAvLyBqdXN0IHdhbnQgdG8gbG9nIHRoYXQgdGhpcyBpcyBoYXBwZW5pbmcsIGFzIGl0IGNhbiBhZmZlY3Qgb3BlcnRpb25cbiAgICBsb2cuZGVidWcoYFdlYiBJbnNwZWN0b3IgZ2FyYmFnZSBjb2xsZWN0ZWRgKTtcbiAgfVxuXG4gIG9uU2NyaXB0UGFyc2VkIChlcnIsIHNjcmlwdEluZm8pIHtcbiAgICAvLyB7IHNjcmlwdElkOiAnMTMnLCB1cmw6ICcnLCBzdGFydExpbmU6IDAsIHN0YXJ0Q29sdW1uOiAwLCBlbmRMaW5lOiA4MiwgZW5kQ29sdW1uOiAzIH1cbiAgICBsb2cuZGVidWcoYFNjcmlwdCBwYXJzZWQ6ICR7SlNPTi5zdHJpbmdpZnkoc2NyaXB0SW5mbyl9YCk7XG4gIH1cbn1cbiJdLCJmaWxlIjoibGliL3JwYy9ycGMtY2xpZW50LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
