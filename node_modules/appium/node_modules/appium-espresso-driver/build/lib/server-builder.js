"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.buildServerSigningConfig = buildServerSigningConfig;
exports.default = exports.GRADLE_DEPENDENCIES_PLACEHOLDER = exports.GRADLE_URL_TEMPLATE = exports.VERSION_KEYS = exports.ServerBuilder = void 0;

require("source-map-support/register");

var _teen_process = require("teen_process");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _path = _interopRequireDefault(require("path"));

var _os = require("os");

const GRADLE_VERSION_KEY = 'gradle';
const GRADLE_URL_PREFIX = 'distributionUrl=';
const GRADLE_URL_TEMPLATE = 'https\\://services.gradle.org/distributions/gradle-VERSION-all.zip';
exports.GRADLE_URL_TEMPLATE = GRADLE_URL_TEMPLATE;
const GRADLE_MAX_ERROR_LOG_LINES = 15;
const GRADLE_DEPENDENCIES_PLACEHOLDER = '// additionalAppDependencies placeholder (don\'t change or delete this line)';
exports.GRADLE_DEPENDENCIES_PLACEHOLDER = GRADLE_DEPENDENCIES_PLACEHOLDER;
const VERSION_KEYS = [GRADLE_VERSION_KEY, 'androidGradlePlugin', 'compileSdk', 'buildTools', 'minSdk', 'targetSdk', 'kotlin'];
exports.VERSION_KEYS = VERSION_KEYS;

const gradleLog = _appiumSupport.logger.getLogger('Gradle');

function buildServerSigningConfig(args) {
  return {
    zipAlign: true,
    keystoreFile: args.keystoreFile,
    keystorePassword: args.keystorePassword,
    keyAlias: args.keyAlias,
    keyPassword: args.keyPassword
  };
}

class ServerBuilder {
  constructor(args = {}) {
    this.serverPath = args.serverPath;
    this.showGradleLog = args.showGradleLog;
    const buildConfiguration = args.buildConfiguration || {};
    const versionConfiguration = buildConfiguration.toolsVersions || {};
    this.serverVersions = _lodash.default.reduce(versionConfiguration, (acc, value, key) => {
      if (VERSION_KEYS.includes(key)) {
        acc[key] = value;
      } else {
        _logger.default.warn(`Got unexpected '${key}' in toolsVersion block of the build configuration`);
      }

      return acc;
    }, {});
    this.testAppPackage = args.testAppPackage;
    this.signingConfig = args.signingConfig;
    this.additionalAppDependencies = buildConfiguration.additionalAppDependencies || [];
  }

  async build() {
    if (this.serverVersions[GRADLE_VERSION_KEY]) {
      await this.setGradleWrapperVersion(this.serverVersions[GRADLE_VERSION_KEY]);
    }

    if (!Array.isArray(this.additionalAppDependencies)) {
      throw new Error('additionalAppDependencies must be an array');
    }

    if (!_lodash.default.isEmpty(this.additionalAppDependencies)) {
      await this.insertAdditionalAppDependencies(this.additionalAppDependencies);
    }

    await this.runBuildProcess();
  }

  getCommand() {
    const cmd = _appiumSupport.system.isWindows() ? 'gradlew.bat' : './gradlew';

    const buildProperty = (key, value) => value ? `-P${key}=${value}` : null;

    let args = VERSION_KEYS.filter(key => key !== GRADLE_VERSION_KEY).map(key => {
      const serverVersion = this.serverVersions[key];
      const gradleProperty = `appium${key.charAt(0).toUpperCase()}${key.slice(1)}`;
      return buildProperty(gradleProperty, serverVersion);
    }).filter(Boolean);

    if (this.signingConfig) {
      args.push(..._lodash.default.keys(this.signingConfig).map(key => [`appium${_lodash.default.upperFirst(key)}`, this.signingConfig[key]]).map(([k, v]) => buildProperty(k, v)).filter(Boolean));
    }

    if (this.testAppPackage) {
      args.push(buildProperty('appiumTargetPackage', this.testAppPackage));
    }

    args.push('assembleAndroidTest');
    return {
      cmd,
      args
    };
  }

  async setGradleWrapperVersion(version) {
    const propertiesPath = _path.default.resolve(this.serverPath, 'gradle', 'wrapper', 'gradle-wrapper.properties');

    const originalProperties = await _appiumSupport.fs.readFile(propertiesPath, 'utf8');
    const newProperties = this.updateGradleDistUrl(originalProperties, version);
    await _appiumSupport.fs.writeFile(propertiesPath, newProperties, 'utf8');
  }

  updateGradleDistUrl(propertiesContent, version) {
    return propertiesContent.replace(new RegExp(`^(${_lodash.default.escapeRegExp(GRADLE_URL_PREFIX)}).+$`, 'gm'), `$1${GRADLE_URL_TEMPLATE.replace('VERSION', version)}`);
  }

  async insertAdditionalAppDependencies(additionalAppDependencies) {
    const buildPath = _path.default.resolve(this.serverPath, 'app', 'build.gradle');

    const originalConfiguration = await _appiumSupport.fs.readFile(buildPath, 'utf8');
    const newConfiguration = this.updateDependencyLines(originalConfiguration, additionalAppDependencies);
    await _appiumSupport.fs.writeFile(buildPath, newConfiguration, 'utf8');
  }

  updateDependencyLines(configurationContent, additionalAppDependencies) {
    const dependencyLines = additionalAppDependencies.map(function (dependency) {
      if (/[\s'\\$]/.test(dependency)) {
        throw new Error('Single quotes, dollar characters and whitespace characters' + ` are disallowed in additional dependencies: ${dependency}`);
      }

      return `implementation '${dependency}'`;
    }).join('$1');
    return configurationContent.replace(new RegExp(`(\\s*^\\s*)${_lodash.default.escapeRegExp(GRADLE_DEPENDENCIES_PLACEHOLDER)}\\s*$`, 'gm'), `$1${dependencyLines}`);
  }

  async runBuildProcess() {
    const {
      cmd,
      args
    } = this.getCommand();

    _logger.default.debug(`Beginning build with command '${cmd} ${args.join(' ')}' ` + `in directory '${this.serverPath}'`);

    const gradlebuild = new _teen_process.SubProcess(cmd, args, {
      cwd: this.serverPath,
      stdio: ['ignore', 'pipe', 'pipe']
    });
    let buildLastLines = [];
    const logMsg = `Output from Gradle ${this.showGradleLog ? 'will' : 'will not'} be logged`;

    _logger.default.debug(`${logMsg}. To change this, use 'showGradleLog' desired capability`);

    gradlebuild.on('stream-line', line => {
      if (this.showGradleLog) {
        if (line.startsWith('[STDERR]')) {
          gradleLog.warn(line);
        } else {
          gradleLog.info(line);
        }
      }

      buildLastLines.push(`${_os.EOL}${line}`);

      if (buildLastLines.length > GRADLE_MAX_ERROR_LOG_LINES) {
        buildLastLines = buildLastLines.slice(-GRADLE_MAX_ERROR_LOG_LINES);
      }
    });

    try {
      await gradlebuild.start();
      await gradlebuild.join();
    } catch (err) {
      let msg = `Unable to build Espresso server - ${err.message}\n` + `Gradle error message:${_os.EOL}${buildLastLines}`;

      _logger.default.errorAndThrow(msg);
    }
  }

}

exports.ServerBuilder = ServerBuilder;
var _default = ServerBuilder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zZXJ2ZXItYnVpbGRlci5qcyJdLCJuYW1lcyI6WyJHUkFETEVfVkVSU0lPTl9LRVkiLCJHUkFETEVfVVJMX1BSRUZJWCIsIkdSQURMRV9VUkxfVEVNUExBVEUiLCJHUkFETEVfTUFYX0VSUk9SX0xPR19MSU5FUyIsIkdSQURMRV9ERVBFTkRFTkNJRVNfUExBQ0VIT0xERVIiLCJWRVJTSU9OX0tFWVMiLCJncmFkbGVMb2ciLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJidWlsZFNlcnZlclNpZ25pbmdDb25maWciLCJhcmdzIiwiemlwQWxpZ24iLCJrZXlzdG9yZUZpbGUiLCJrZXlzdG9yZVBhc3N3b3JkIiwia2V5QWxpYXMiLCJrZXlQYXNzd29yZCIsIlNlcnZlckJ1aWxkZXIiLCJjb25zdHJ1Y3RvciIsInNlcnZlclBhdGgiLCJzaG93R3JhZGxlTG9nIiwiYnVpbGRDb25maWd1cmF0aW9uIiwidmVyc2lvbkNvbmZpZ3VyYXRpb24iLCJ0b29sc1ZlcnNpb25zIiwic2VydmVyVmVyc2lvbnMiLCJfIiwicmVkdWNlIiwiYWNjIiwidmFsdWUiLCJrZXkiLCJpbmNsdWRlcyIsImxvZyIsIndhcm4iLCJ0ZXN0QXBwUGFja2FnZSIsInNpZ25pbmdDb25maWciLCJhZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzIiwiYnVpbGQiLCJzZXRHcmFkbGVXcmFwcGVyVmVyc2lvbiIsIkFycmF5IiwiaXNBcnJheSIsIkVycm9yIiwiaXNFbXB0eSIsImluc2VydEFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMiLCJydW5CdWlsZFByb2Nlc3MiLCJnZXRDb21tYW5kIiwiY21kIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwiYnVpbGRQcm9wZXJ0eSIsImZpbHRlciIsIm1hcCIsInNlcnZlclZlcnNpb24iLCJncmFkbGVQcm9wZXJ0eSIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJCb29sZWFuIiwicHVzaCIsImtleXMiLCJ1cHBlckZpcnN0IiwiayIsInYiLCJ2ZXJzaW9uIiwicHJvcGVydGllc1BhdGgiLCJwYXRoIiwicmVzb2x2ZSIsIm9yaWdpbmFsUHJvcGVydGllcyIsImZzIiwicmVhZEZpbGUiLCJuZXdQcm9wZXJ0aWVzIiwidXBkYXRlR3JhZGxlRGlzdFVybCIsIndyaXRlRmlsZSIsInByb3BlcnRpZXNDb250ZW50IiwicmVwbGFjZSIsIlJlZ0V4cCIsImVzY2FwZVJlZ0V4cCIsImJ1aWxkUGF0aCIsIm9yaWdpbmFsQ29uZmlndXJhdGlvbiIsIm5ld0NvbmZpZ3VyYXRpb24iLCJ1cGRhdGVEZXBlbmRlbmN5TGluZXMiLCJjb25maWd1cmF0aW9uQ29udGVudCIsImRlcGVuZGVuY3lMaW5lcyIsImRlcGVuZGVuY3kiLCJ0ZXN0Iiwiam9pbiIsImRlYnVnIiwiZ3JhZGxlYnVpbGQiLCJTdWJQcm9jZXNzIiwiY3dkIiwic3RkaW8iLCJidWlsZExhc3RMaW5lcyIsImxvZ01zZyIsIm9uIiwibGluZSIsInN0YXJ0c1dpdGgiLCJpbmZvIiwiRU9MIiwibGVuZ3RoIiwic3RhcnQiLCJlcnIiLCJtc2ciLCJtZXNzYWdlIiwiZXJyb3JBbmRUaHJvdyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsa0JBQWtCLEdBQUcsUUFBM0I7QUFDQSxNQUFNQyxpQkFBaUIsR0FBRyxrQkFBMUI7QUFDQSxNQUFNQyxtQkFBbUIsR0FBRyxvRUFBNUI7O0FBQ0EsTUFBTUMsMEJBQTBCLEdBQUcsRUFBbkM7QUFFQSxNQUFNQywrQkFBK0IsR0FBRyw4RUFBeEM7O0FBRUEsTUFBTUMsWUFBWSxHQUFHLENBQ25CTCxrQkFEbUIsRUFFbkIscUJBRm1CLEVBR25CLFlBSG1CLEVBSW5CLFlBSm1CLEVBS25CLFFBTG1CLEVBTW5CLFdBTm1CLEVBT25CLFFBUG1CLENBQXJCOzs7QUFVQSxNQUFNTSxTQUFTLEdBQUdDLHNCQUFPQyxTQUFQLENBQWlCLFFBQWpCLENBQWxCOztBQUVBLFNBQVNDLHdCQUFULENBQW1DQyxJQUFu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U0FBUyxDQUFDd0YsSUFBVixDQUFlRixJQUFmO0FBQ0Q7QUFDRjs7QUFDREgsTUFBQUEsY0FBYyxDQUFDakMsSUFBZixDQUFxQixHQUFFdUMsT0FBSSxHQUFFSCxJQUFLLEVBQWxDOztBQUNBLFVBQUlILGNBQWMsQ0FBQ08sTUFBZixHQUF3QjdGLDBCQUE1QixFQUF3RDtBQUN0RHNGLFFBQUFBLGNBQWMsR0FBR0EsY0FBYyxDQUFDbkMsS0FBZixDQUFxQixDQUFDbkQsMEJBQXRCLENBQWpCO0FBQ0Q7QUFDRixLQVpEOztBQWNBLFFBQUk7QUFDRixZQUFNa0YsV0FBVyxDQUFDWSxLQUFaLEVBQU47QUFDQSxZQUFNWixXQUFXLENBQUNGLElBQVosRUFBTjtBQUNELEtBSEQsQ0FHRSxPQUFPZSxHQUFQLEVBQVk7QUFDWixVQUFJQyxHQUFHLEdBQUkscUNBQW9DRCxHQUFHLENBQUNFLE9BQVEsSUFBakQsR0FDUCx3QkFBdUJMLE9BQUksR0FBRU4sY0FBZSxFQUQvQzs7QUFFQTNELHNCQUFJdUUsYUFBSixDQUFrQkYsR0FBbEI7QUFDRDtBQUNGOztBQS9JaUI7OztlQW1KTG5GLGEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdWJQcm9jZXNzIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IGZzLCBsb2dnZXIsIHN5c3RlbSB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuXG5jb25zdCBHUkFETEVfVkVSU0lPTl9LRVkgPSAnZ3JhZGxlJztcbmNvbnN0IEdSQURMRV9VUkxfUFJFRklYID0gJ2Rpc3RyaWJ1dGlvblVybD0nO1xuY29uc3QgR1JBRExFX1VSTF9URU1QTEFURSA9ICdodHRwc1xcXFw6Ly9zZXJ2aWNlcy5ncmFkbGUub3JnL2Rpc3RyaWJ1dGlvbnMvZ3JhZGxlLVZFUlNJT04tYWxsLnppcCc7XG5jb25zdCBHUkFETEVfTUFYX0VSUk9SX0xPR19MSU5FUyA9IDE1O1xuXG5jb25zdCBHUkFETEVfREVQRU5ERU5DSUVTX1BMQUNFSE9MREVSID0gJy8vIGFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMgcGxhY2Vob2xkZXIgKGRvblxcJ3QgY2hhbmdlIG9yIGRlbGV0ZSB0aGlzIGxpbmUpJztcblxuY29uc3QgVkVSU0lPTl9LRVlTID0gW1xuICBHUkFETEVfVkVSU0lPTl9LRVksXG4gICdhbmRyb2lkR3JhZGxlUGx1Z2luJyxcbiAgJ2NvbXBpbGVTZGsnLFxuICAnYnVpbGRUb29scycsXG4gICdtaW5TZGsnLFxuICAndGFyZ2V0U2RrJyxcbiAgJ2tvdGxpbidcbl07XG5cbmNvbnN0IGdyYWRsZUxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0dyYWRsZScpO1xuXG5mdW5jdGlvbiBidWlsZFNlcnZlclNpZ25pbmdDb25maWcgKGFyZ3MpIHtcbiAgcmV0dXJuIHtcbiAgICB6aXBBbGlnbjogdHJ1ZSxcbiAgICBrZXlzdG9yZUZpbGU6IGFyZ3Mua2V5c3RvcmVGaWxlLFxuICAgIGtleXN0b3JlUGFzc3dvcmQ6IGFyZ3Mua2V5c3RvcmVQYXNzd29yZCxcbiAgICBrZXlBbGlhczogYXJncy5rZXlBbGlhcyxcbiAgICBrZXlQYXNzd29yZDogYXJncy5rZXlQYXNzd29yZFxuICB9O1xufVxuXG5jbGFzcyBTZXJ2ZXJCdWlsZGVyIHtcbiAgY29uc3RydWN0b3IgKGFyZ3MgPSB7fSkge1xuICAgIHRoaXMuc2VydmVyUGF0aCA9IGFyZ3Muc2VydmVyUGF0aDtcbiAgICB0aGlzLnNob3dHcmFkbGVMb2cgPSBhcmdzLnNob3dHcmFkbGVMb2c7XG5cbiAgICBjb25zdCBidWlsZENvbmZpZ3VyYXRpb24gPSBhcmdzLmJ1aWxkQ29uZmlndXJhdGlvbiB8fCB7fTtcblxuICAgIGNvbnN0IHZlcnNpb25Db25maWd1cmF0aW9uID0gYnVpbGRDb25maWd1cmF0aW9uLnRvb2xzVmVyc2lvbnMgfHwge307XG4gICAgdGhpcy5zZXJ2ZXJWZXJzaW9ucyA9IF8ucmVkdWNlKHZlcnNpb25Db25maWd1cmF0aW9uLCAoYWNjLCB2YWx1ZSwga2V5KSA9PiB7XG4gICAgICBpZiAoVkVSU0lPTl9LRVlTLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgYWNjW2tleV0gPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy53YXJuKGBHb3QgdW5leHBlY3RlZCAnJHtrZXl9JyBpbiB0b29sc1ZlcnNpb24gYmxvY2sgb2YgdGhlIGJ1aWxkIGNvbmZpZ3VyYXRpb25gKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuXG4gICAgdGhpcy50ZXN0QXBwUGFja2FnZSA9IGFyZ3MudGVzdEFwcFBhY2thZ2U7XG4gICAgdGhpcy5zaWduaW5nQ29uZmlnID0gYXJncy5zaWduaW5nQ29uZmlnO1xuXG4gICAgdGhpcy5hZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzID0gYnVpbGRDb25maWd1cmF0aW9uLmFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMgfHwgW107XG4gIH1cblxuICBhc3luYyBidWlsZCAoKSB7XG4gICAgaWYgKHRoaXMuc2VydmVyVmVyc2lvbnNbR1JBRExFX1ZFUlNJT05fS0VZXSkge1xuICAgICAgYXdhaXQgdGhpcy5zZXRHcmFkbGVXcmFwcGVyVmVyc2lvbih0aGlzLnNlcnZlclZlcnNpb25zW0dSQURMRV9WRVJTSU9OX0tFWV0pO1xuICAgIH1cblxuICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLmFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2FkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMgbXVzdCBiZSBhbiBhcnJheScpO1xuICAgIH1cbiAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMpKSB7XG4gICAgICBhd2FpdCB0aGlzLmluc2VydEFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXModGhpcy5hZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnJ1bkJ1aWxkUHJvY2VzcygpO1xuICB9XG5cbiAgZ2V0Q29tbWFuZCAoKSB7XG4gICAgY29uc3QgY21kID0gc3lzdGVtLmlzV2luZG93cygpID8gJ2dyYWRsZXcuYmF0JyA6ICcuL2dyYWRsZXcnO1xuICAgIGNvbnN0IGJ1aWxkUHJvcGVydHkgPSAoa2V5LCB2YWx1ZSkgPT4gdmFsdWUgPyBgLVAke2tleX09JHt2YWx1ZX1gIDogbnVsbDtcbiAgICBsZXQgYXJncyA9IFZFUlNJT05fS0VZU1xuICAgICAgLmZpbHRlcihrZXkgPT4ga2V5ICE9PSBHUkFETEVfVkVSU0lPTl9LRVkpXG4gICAgICAubWFwKGtleSA9PiB7XG4gICAgICAgIGNvbnN0IHNlcnZlclZlcnNpb24gPSB0aGlzLnNlcnZlclZlcnNpb25zW2tleV07XG4gICAgICAgIGNvbnN0IGdyYWRsZVByb3BlcnR5ID0gYGFwcGl1bSR7a2V5LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpfSR7a2V5LnNsaWNlKDEpfWA7XG4gICAgICAgIHJldHVybiBidWlsZFByb3BlcnR5KGdyYWRsZVByb3BlcnR5LCBzZXJ2ZXJWZXJzaW9uKTtcbiAgICAgIH0pXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuXG4gICAgaWYgKHRoaXMuc2lnbmluZ0NvbmZpZykge1xuICAgICAgYXJncy5wdXNoKC4uLihcbiAgICAgICAgXy5rZXlzKHRoaXMuc2lnbmluZ0NvbmZpZylcbiAgICAgICAgLm1hcCgoa2V5KSA9PiBbYGFwcGl1bSR7Xy51cHBlckZpcnN0KGtleSl9YCwgdGhpcy5zaWduaW5nQ29uZmlnW2tleV1dKVxuICAgICAgICAubWFwKChbaywgdl0pID0+IGJ1aWxkUHJvcGVydHkoaywgdikpXG4gICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICkpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRlc3RBcHBQYWNrYWdlKSB7XG4gICAgICBhcmdzLnB1c2goYnVpbGRQcm9wZXJ0eSgnYXBwaXVtVGFyZ2V0UGFja2FnZScsIHRoaXMudGVzdEFwcFBhY2thZ2UpKTtcbiAgICB9XG4gICAgYXJncy5wdXNoKCdhc3NlbWJsZUFuZHJvaWRUZXN0Jyk7XG5cbiAgICByZXR1cm4ge2NtZCwgYXJnc307XG4gIH1cblxuICBhc3luYyBzZXRHcmFkbGVXcmFwcGVyVmVyc2lvbiAodmVyc2lvbikge1xuICAgIGNvbnN0IHByb3BlcnRpZXNQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuc2VydmVyUGF0aCwgJ2dyYWRsZScsICd3cmFwcGVyJywgJ2dyYWRsZS13cmFwcGVyLnByb3BlcnRpZXMnKTtcbiAgICBjb25zdCBvcmlnaW5hbFByb3BlcnRpZXMgPSBhd2FpdCBmcy5yZWFkRmlsZShwcm9wZXJ0aWVzUGF0aCwgJ3V0ZjgnKTtcbiAgICBjb25zdCBuZXdQcm9wZXJ0aWVzID0gdGhpcy51cGRhdGVHcmFkbGVEaXN0VXJsKG9yaWdpbmFsUHJvcGVydGllcywgdmVyc2lvbik7XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKHByb3BlcnRpZXNQYXRoLCBuZXdQcm9wZXJ0aWVzLCAndXRmOCcpO1xuICB9XG5cbiAgdXBkYXRlR3JhZGxlRGlzdFVybCAocHJvcGVydGllc0NvbnRlbnQsIHZlcnNpb24pIHtcbiAgICByZXR1cm4gcHJvcGVydGllc0NvbnRlbnQucmVwbGFjZShcbiAgICAgIG5ldyBSZWdFeHAoYF4oJHtfLmVzY2FwZVJlZ0V4cChHUkFETEVfVVJMX1BSRUZJWCl9KS4rJGAsICdnbScpLFxuICAgICAgYCQxJHtHUkFETEVfVVJMX1RFTVBMQVRFLnJlcGxhY2UoJ1ZFUlNJT04nLCB2ZXJzaW9uKX1gXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIGluc2VydEFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMgKGFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMpIHtcbiAgICBjb25zdCBidWlsZFBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5zZXJ2ZXJQYXRoLCAnYXBwJywgJ2J1aWxkLmdyYWRsZScpO1xuICAgIGNvbnN0IG9yaWdpbmFsQ29uZmlndXJhdGlvbiA9IGF3YWl0IGZzLnJlYWRGaWxlKGJ1aWxkUGF0aCwgJ3V0ZjgnKTtcbiAgICBjb25zdCBuZXdDb25maWd1cmF0aW9uID0gdGhpcy51cGRhdGVEZXBlbmRlbmN5TGluZXMob3JpZ2luYWxDb25maWd1cmF0aW9uLCBhZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzKTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUoYnVpbGRQYXRoLCBuZXdDb25maWd1cmF0aW9uLCAndXRmOCcpO1xuICB9XG5cbiAgdXBkYXRlRGVwZW5kZW5jeUxpbmVzIChjb25maWd1cmF0aW9uQ29udGVudCwgYWRkaXRpb25hbEFwcERlcGVuZGVuY2llcykge1xuICAgIGNvbnN0IGRlcGVuZGVuY3lMaW5lcyA9IGFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXNcbiAgICAgIC5tYXAoZnVuY3Rpb24gKGRlcGVuZGVuY3kpIHtcbiAgICAgICAgLy8gRGlzYWxsb3cgd2hpdGVzcGFjZSBhbmQgcXVvdGUgY2hhcmFjdGVycyB0aGF0IGNhbiBicmVhayBzdHJpbmcgbGl0ZXJhbHMgaW4gYSBwYXRjaGVkIGJ1aWxkLmdyYWRsZVxuICAgICAgICAvLyBhbmQgZG9sbGFyIGNoYXJhY3RlcnMgdGhhdCBvdGhlcndpc2Ugd291bGQgYmUgaW50ZXJwcmV0ZWQgYnkgU3RyaW5nLnJlcGxhY2UgYmVsb3dcbiAgICAgICAgaWYgKC9bXFxzJ1xcXFwkXS8udGVzdChkZXBlbmRlbmN5KSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2luZ2xlIHF1b3RlcywgZG9sbGFyIGNoYXJhY3RlcnMgYW5kIHdoaXRlc3BhY2UgY2hhcmFjdGVycycgK1xuICAgICAgICAgICAgYCBhcmUgZGlzYWxsb3dlZCBpbiBhZGRpdGlvbmFsIGRlcGVuZGVuY2llczogJHtkZXBlbmRlbmN5fWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgaW1wbGVtZW50YXRpb24gJyR7ZGVwZW5kZW5jeX0nYDtcbiAgICAgIH0pXG4gICAgICAuam9pbignJDEnKTsgLy8gaW50ZXJwcmV0ZWQgYXMgR3JvdXAgMSBmcm9tIHRoZSBwYXR0ZXJuIGJlbG93XG5cbiAgICByZXR1cm4gY29uZmlndXJhdGlvbkNvbnRlbnQucmVwbGFjZShcbiAgICAgIC8vIEdyb3VwIDEgY2FwdHVyZXMgbmV3IGxpbmUgY2hhcmFjdGVycyBhbmQgaW5kZW50YXRpb24gKGVnLiAnXFxuXFx0JykgdXNlZCBpbiBidWlsZC5ncmFkbGUgZmlsZVxuICAgICAgLy8gVGhpcyBlbnN1cmVzIHRoYXQgYSBwYXRjaGVkIGJ1aWxkLmdyYWRsZSB3aWxsIGhhdmUgY29ycmVjdCBuZXcgbGluZXMgYW5kIGluZGVudGF0aW9uXG4gICAgICBuZXcgUmVnRXhwKGAoXFxcXHMqXlxcXFxzKikke18uZXNjYXBlUmVnRXhwKEdSQURMRV9ERVBFTkRFTkNJRVNfUExBQ0VIT0xERVIpfVxcXFxzKiRgLCAnZ20nKSxcbiAgICAgIGAkMSR7ZGVwZW5kZW5jeUxpbmVzfWBcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgcnVuQnVpbGRQcm9jZXNzICgpIHtcbiAgICBjb25zdCB7Y21kLCBhcmdzfSA9IHRoaXMuZ2V0Q29tbWFuZCgpO1xuICAgIGxvZy5kZWJ1ZyhgQmVnaW5uaW5nIGJ1aWxkIHdpdGggY29tbWFuZCAnJHtjbWR9ICR7YXJncy5qb2luKCcgJyl9JyBgICtcbiAgICAgIGBpbiBkaXJlY3RvcnkgJyR7dGhpcy5zZXJ2ZXJQYXRofSdgKTtcbiAgICBjb25zdCBncmFkbGVidWlsZCA9IG5ldyBTdWJQcm9jZXNzKGNtZCwgYXJncywge1xuICAgICAgY3dkOiB0aGlzLnNlcnZlclBhdGgsXG4gICAgICBzdGRpbzogWydpZ25vcmUnLCAncGlwZScsICdwaXBlJ10sXG4gICAgfSk7XG4gICAgbGV0IGJ1aWxkTGFzdExpbmVzID0gW107XG5cbiAgICBjb25zdCBsb2dNc2cgPSBgT3V0cHV0IGZyb20gR3JhZGxlICR7dGhpcy5zaG93R3JhZGxlTG9nID8gJ3dpbGwnIDogJ3dpbGwgbm90J30gYmUgbG9nZ2VkYDtcbiAgICBsb2cuZGVidWcoYCR7bG9nTXNnfS4gVG8gY2hhbmdlIHRoaXMsIHVzZSAnc2hvd0dyYWRsZUxvZycgZGVzaXJlZCBjYXBhYmlsaXR5YCk7XG4gICAgZ3JhZGxlYnVpbGQub24oJ3N0cmVhbS1saW5lJywgbGluZSA9PiB7XG4gICAgICBpZiAodGhpcy5zaG93R3JhZGxlTG9nKSB7XG4gICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ1tTVERFUlJdJykpIHtcbiAgICAgICAgICBncmFkbGVMb2cud2FybihsaW5lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBncmFkbGVMb2cuaW5mbyhsaW5lKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYnVpbGRMYXN0TGluZXMucHVzaChgJHtFT0x9JHtsaW5lfWApO1xuICAgICAgaWYgKGJ1aWxkTGFzdExpbmVzLmxlbmd0aCA+IEdSQURMRV9NQVhfRVJST1JfTE9HX0xJTkVTKSB7XG4gICAgICAgIGJ1aWxkTGFzdExpbmVzID0gYnVpbGRMYXN0TGluZXMuc2xpY2UoLUdSQURMRV9NQVhfRVJST1JfTE9HX0xJTkVTKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBncmFkbGVidWlsZC5zdGFydCgpO1xuICAgICAgYXdhaXQgZ3JhZGxlYnVpbGQuam9pbigpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbGV0IG1zZyA9IGBVbmFibGUgdG8gYnVpbGQgRXNwcmVzc28gc2VydmVyIC0gJHtlcnIubWVzc2FnZX1cXG5gICtcbiAgICAgICAgYEdyYWRsZSBlcnJvciBtZXNzYWdlOiR7RU9MfSR7YnVpbGRMYXN0TGluZXN9YDtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IFNlcnZlckJ1aWxkZXIsIFZFUlNJT05fS0VZUywgR1JBRExFX1VSTF9URU1QTEFURSwgR1JBRExFX0RFUEVOREVOQ0lFU19QTEFDRUhPTERFUiwgYnVpbGRTZXJ2ZXJTaWduaW5nQ29uZmlnIH07XG5leHBvcnQgZGVmYXVsdCBTZXJ2ZXJCdWlsZGVyO1xuIl0sImZpbGUiOiJsaWIvc2VydmVyLWJ1aWxkZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
